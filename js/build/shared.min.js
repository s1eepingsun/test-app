/*! 2015-09-18 */
function GameTimer(){var a,b,c;this.setElapsed=function(b){a=b,c=!0},this.unfreeze=function(){this.updateElapsed(!0),a>=-1&&(c=!1)},this.getTime=function(){var a=this.updateElapsed(!1);return-1>a?-a:-1==a?0:a},this.getElapsed=function(){return this.updateElapsed(!1)},this.updateElapsed=function(d){if(c)return b=now(),a;var e=now();b>e&&(b=e);var f=e-b;return f>=1e3*GameTimer.FREEZE_AFTER_SEC&&(f=1e3*GameTimer.FREEZE_AFTER_SEC,c=!0),a>=-1&&d||c?(a+=f+(-1==a?1:0),b=now(),a):a+f+(-1==a?1:0)},this.isFrozen=function(){return c},this.getTimeSec=function(){return iDiv(this.getTime(),1e3)},this.reset=function(){a=-1,c=!0},this.conserve=function(){a>-1&&(a=-this.getTime()),c=!0},this.reset()}function Attempt(a){var b,c=this;c.hash=hash();var d,e,f,g,h=-1,i=-1,j="";c.gameId=null,this.setGameId=function(a){c.gameId=a},this.getGameId=function(){return c.gameId},this.getGameTimer=function(){return e},this.getHistory=function(){return f},this.getRedo=function(){return g},this.setAttemptId=function(a){h=a},this.getAttemptId=function(){return h},this.clearRedo=function(){g=new Array},this.win=function(){e.conserve(),i=e.getElapsed(),f.length>0&&-1==i&&(i=-101,e.setElapsed(i)),this.encodeHistory(),d=nowTS()},this.encodeHistory=function(){j="";for(var a in f){var c=f[a];j+=b.encodeMove(c)}},this.getEncodedHistory=function(){return j},this._dev_getLiveEncodedHistory=function(){__encHistory="";for(var a in f){var c=f[a];__encHistory+=b.encodeMove(c)}return __encHistory},this.finish=function(){if(i>=-1){var a=f.length;return i=e.getElapsed(),this.encodeHistory(),d=nowTS(),this.reset(),a>=MIN_ACTUAL_ATTEMPT_LENGTH}return this.reset(),!0},this.reset=function(){e=new GameTimer,e.setElapsed(i),f=new Array,g=new Array},this.getGameTime=function(){return i>0?i:-1==i?0:-i},this.isFresh=function(){return-1==e.getElapsed()},this.isWon=function(){return e.getElapsed()<-1},this.getFreshData=function(){j="";for(var a in f){var d=f[a];j+=b.encodeMove(d)}return{gameId:c.gameId,attemptId:h,history:-1>i?c.getEncodedHistory():j,elapsed:isDef(e)?e.getElapsed():i,hash:c.hash}},this.getData=function(){return{gameId:c.gameId,attemptId:h,history:this.getEncodedHistory(),elapsed:i,hash:c.hash}},this.setData=function(a){isDef(a.attemptId)&&(h=a.attemptId),j=a.history,i=a.elapsed,isDef(a.timeStamp)&&(d=a.timeStamp),this.reset()},this.equals=function(a){return j==a.history&&i==a.elapsed},b=a,this.reset()}function AttemptLocalStorage(a){var b,c=this;this.load=function(){b=store.get("attemptDelayed_gVId"+c.cs.getGameVariationId()+"_uId"+c.cs.getUserId()),isDef(b)&&b||(b=[])},this.save=function(){store.set("attemptDelayed_gVId"+c.cs.getGameVariationId()+"_uId"+c.cs.getUserId(),b)},this.compareAttemptData=function(a,b){return a.gameId==b.gameId&&a.hash==b.hash||a.gameId==b.gameId&&a.history==b.history||a.gameId==b.gameId&&a.attemptId==b.attemptId},this.sync=function(a){if(!(a.isFresh()||a.isWon()&&-1==a.attemptId)){c.load();var d=!1;for(var e in b){var f=b[e];c.compareAttemptData(f,a.getFreshData())&&(b[e]=a.getFreshData(),d=!0)}d||b.push(a.getFreshData()),c.save()}},this.remove=function(a){c.load();var d=[];for(var e in b){var f=b[e];c.compareAttemptData(a,f)||d.push(f)}b=d,c.save()},this.reuploadAttempts=function(){c.load();for(var a in b){var d=b[a];isDef(d)&&c.cs.reuploadAttempt(d.gameId,null,d,{async:!1})}},c.cs=a}function BottomSubPanel(a){var b,c,d=this,e=null,f=null,g="",h=null;this.getId=function(){return c},this.render=function(){var a="<div class='bubblePanel bottomSubPanel bottomPanel _hackPaddingLayer' id='"+c+"'><img class='closeBottomSubPanelImg' id='closeBottomSubPanel"+b+"' alt='"+I18n.contextGet("ui","closeIconAltText")+"' src='/img/icons/icon_close.png' />"+g+"</div>";$("#bottomArea").append(a),$("#closeBottomSubPanel"+b).click(function(){ui.hidePanel(d)}),ui.showPanel(d)},this.renderContents=function(a){var d="<div id='"+c+"'><img class='closeBottomSubPanelImg' id='closeBottomSubPanel"+b+"' alt='"+I18n.contextGet("ui","closeIconAltText")+"' src='/img/icons/icon_close.png' />"+g+"</div>";$("#"+a).empty().append(d),$("#"+a).show(),$("#closeBottomSubPanel"+b).click(function(){null!=e&&e()})},this.generatePanelId=function(){b=BottomSubPanel.maxId,c="bottomSubPanel"+b,BottomSubPanel.maxId++,this.id=c},this.destroy=function(){$("#"+c).remove()},this.fillContents=function(a){g=a},this.onClose=function(a){isDef(a)&&(e=a)},this.onShow=function(a){f=a},this.fireOnShow=function(){null!=f&&f()},this.fireOnClose=function(a){null!=e&&e(a)},this.generatePanelId(),h=a}function Beacon(a,b){var c,d,e,f=this,g=0,h=!1,i=now(),j=new I18n;j.setContext("beacon"),this.setNetworkStatus=function(a){"offline"==a?($("#connOnline").hide(),$("#connProblem").hide(),$("#connOffline").show()):"problem"==a?($("#connOnline").hide(),$("#connOffline").hide(),$("#connProblem").show()):"online"==a&&($("#connOffline").hide(),$("#connProblem").hide(),$("#connOnline").show())},this.reportUserActivity=function(){i=now()},this.updateActivity=function(a,b,c){$("#activity").empty().append(j.format("activityString",a,b,c))},this.sendBeacon=function(){var a=60,b=5e3;g>0&&(b=15e3),e.sendBeacon(a,b,msToSec(i-now()),function(a,b){a?(f.updateActivity(b.guestCount,b.loggedCount,b.regCount),g=0,h=!1,b.unreadMsgCount>-1&&d.updateUnreadMsgCount(b.unreadMsgCount)):g++,0==g?(f.setNetworkStatus("online"),d.hideNotification()):3>g?f.setNetworkStatus("problem"):(f.setNetworkStatus("offline"),h||(h=!0,d.notifyUser(j.get("noConnectionNotice"),!0)))})},this.bindActivityTrackers=function(){$(window).mousemove(function(){f.reportUserActivity()}),$(window).click(function(){f.reportUserActivity()}),$(window).keydown(function(){f.reportUserActivity()}),$(window).bind("scroll",function(){f.reportUserActivity()})},c=a,d=b,e=c.getClientServer(),f.bindActivityTrackers()}function extendClass(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype}function multiExtendClass(a,b,c){var d=function(){};d.prototype=b.prototype,a.prototype=new d,a.prototype.constructor=a,a.superclass=b.prototype,a.superclass.constructor.apply(c),c.super=new Object;for(var e in c)c.super[e]=c[e]}function formatLargeGameTime(a){a=iDiv(a,1e3);var b=a%60,c=iDiv(a,60)%60,d=iDiv(a,3600)%24,e=iDiv(iDiv(a,3600),24),f="";return e>0&&(f=e+" "+I18n.contextGet("time","daysShortSuffix")+" "),f+d+" "+I18n.contextGet("time","hoursSuperShortSuffix")+" "+ext(c,2,"0")+" "+I18n.contextGet("time","minutesShortSuffix")+" "+ext(b,2,"0")+" "+I18n.contextGet("time","secondsShortSuffix")}function formatGameTimeMS(a,b){var b="undefined"==typeof b?!1:b;a=iDiv(a,1e3),a>86400&&(a=86400),0>a&&(a=-a),-1==a&&(a=0);var c=a%60,d=iDiv(a,60)%60,e=iDiv(a,3600);return b?0==d&&0==e?c+"&nbsp;"+I18n.contextGet("time","secondsShortSuffix"):(c>30&&d++,60==d&&(e++,d=0),0==e?d+"&nbsp;"+I18n.contextGet("time","minutesShortSuffix"):e+"&nbsp;"+I18n.contextGet("time","hoursSuperShortSuffix")+"&nbsp;"+d+"&nbsp;"+I18n.contextGet("time","minutesSuperShortSuffix")):0==e?d+":"+ext(""+c,2,"0"):e+":"+ext(""+d,2,"0")+":"+ext(""+c,2,"0")}function formatTime(a,b){var c=";",d=!1;isDef(b)&&isDef(b.separator)&&(c=b.separator),isDef(b)&&isDef(b.clarify)&&(d=b.clarify);var e=new Date(1e3*a),f=e.getHours(),g=e.getMinutes(),h=(e.getSeconds(),e.getDate()),i=e.getMonth()+1,j=(""+e.getFullYear()).substr(2,2),k=ext(h,2,"0")+"."+ext(i,2,"0")+"."+j,l=ext(""+f,2,"0")+":"+ext(""+g,2,"0");if(d&&e.toDateString()==(new Date).toDateString()&&(k=I18n.contextGet("time","today")),isDef(b)&&isDef(b.putTimeInBrackets))var m=k+" ("+l+")";else m=k+c+" "+l;return m}function formatDate(a){var b=new Date(1e3*a),c=b.getDate(),d=b.getMonth()+1,e=(""+b.getFullYear()).substr(2,2),f=ext(c,2,"0")+"."+ext(d,2,"0")+"."+e;return f}function formatDateRu2(a){var b=formatDateRu(a),c=formatDateRu(nowTS());return b==c?"сегодня":b}function formatDateRu(a){var b=new Date(1e3*a),c=b.getDate(),d=b.getMonth()+1,e=""+b.getFullYear(),f=c+" "+I18n.contextGet("monthsBeta",d)+" "+e;return f}function iDiv(a,b){var c=a%b,d=(a-c)/b;return d=d>=0?Math.floor(d):Math.ceil(d)}function isDef(a){return"undefined"!=typeof a}function ifDef(a,b){return isDef(a)?a:b}function trimLeadingZeros(a){for(;a.length>1&&"0"==a.charAt(0);)a=a.substring(1);return a}function boolToInt(a){return a?1:0}function bool2Int(a){return a?1:0}function parseJSON(a){try{return $.parseJSON(a)}catch(b){return null}}function ext(a,b,c){for(c="undefined"==typeof c?"&nbsp;":c,a=""+a;a.length<b;)a=c+a;return a}function genRnd(a,b){return"undefined"==typeof b?Math.floor(Math.random()*a):Math.floor(Math.random()*(b-a))+a}function now(){return(new Date).getTime()}function nowTS(){return iDiv((new Date).getTime(),1e3)}function msToSec(a){return iDiv(a,1e3)}function formatGame(a){return I18n.contextGet("games",a)}function arrayLast(a){return 0==a.length?null:a[a.length-1]}function Listener(){var a=this;a.listeners=new Array,this.addListener=function(b){a.listeners.push(b)},this.removeListener=function(b){for(var c in a.listeners)if(a.listeners[c]==b)return void a.listeners.splice(c,1)},this.notify=function(b){for(var c=0;c<a.listeners.length;c++){var d=a.listeners[c];isDef(d[b])&&d[b]()}}}function hasFunc(a){return"function"==typeof a}function last(a,b){return"undefined"==typeof b?a[a.length-1]:a[a.length-1+b]}function mergeObj(a,b){for(var c in b)a[c]=b[c]}function hash(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function sendMailInvite(){location.replace("mailto:?subject=Рекомендую сыграть&body="+location.href)}function vkAuthOpenAPI(){VK.init({apiId:3960668}),VK.Auth.getLoginStatus(function(a){a.session?location.reload():VK.Auth.login(function(a){a.session&&location.reload()})})}function setCookie(a,b,c,d,e,f){if(!a||!b)return!1;var g=a+"="+encodeURIComponent(b);return c&&(g+="; expires="+c.toGMTString()),d&&(g+="; path="+d),e&&(g+="; domain="+e),f&&(g+="; secure"),document.cookie=g,!0}function SafeSharedUI(){var a=new I18n;a.setContext("ui"),this.renderErrorReason=function(b,c){$(b).empty().append(c==NOT_LOGGED?"<p class='errorMsg'>"+a.get("notLoggedNotice")+"</p>":"<p class='errorMsg'>"+a.get("unknownLoadingErrorNotice")+"</p>")}}function SharedUI(){var a,b,c=this;c.activePanels=[],c.options={showHistoryLength:!1,showGameLabel:!1,showWinCount:!1},c.i18n=new I18n,c.i18n.setContext("ui"),this.setGameController=function(b){a=b},this.getGameController=function(){return a},this.getUserProfile=function(){return b},this.updateUnreadMsgCount=function(a){b.updateUnreadMsgCount(a)},this.hideNotification=function(){},this.notifyUser=function(){},this.alert=function(a){alert(a)},this.setupSharedUI=function(){b=new PlayerProfile(a,this),c.userProfile=b},this.setGuestUI=function(){$("#bbProfile").hide(),$("#bbLoginRegister").show(),c.historyRenderer.onLogout(),"undefined"!=typeof _hack_updateParametersUIOnLogout&&_hack_updateParametersUIOnLogout()},this.setUserUI=function(){$("#bbProfile").show(),$("#bbLoginRegister").hide(),c.historyRenderer.onLogin(),"undefined"!=typeof _hack_updateParametersUIOnLogin&&_hack_updateParametersUIOnLogin(),c.getUserProfile().show()},this.onRegistration=function(){c.hideAllActivePanels(),c.setUserUI()},this.setLoading=function(a){$(a).empty().append("<div style='padding-top: 10px; padding-left:5px; height:25px;'><span style='float: left; color:black;'>"+c.i18n.get("loadingNotice")+"&nbsp;</span><img style='float: left; margin-top: -12px;' src='/img/icons/loading.gif'></div>")},this.serverSortArrowsImg=function(a,b,c){var b=isDef(b)&&""!=b?" style='"+b+"' ":"",c=isDef(c)?" id='"+c+"' ":"";return a?" &nbsp;<img "+b+c+"src='/img/icons/sort-asc.png' alt=''/>":" &nbsp;<img "+b+c+"src='/img/icons/sort-desc.png' alt=''/>"},this.getOrderHint=function(a){return uiGetOrderHint(a)},this.hideHint=function(){$(".floatingHint").remove()},this.bindCloseIcon=function(a,b){$(a).click(function(){c.hidePanel(b)})},this.showHint=function(a,b){$("body").append("<p class='floatingHint' id='floatingHint'>"+b+"</p>"),$("#floatingHint").css("top",$(a).offset().top-53),$("#floatingHint").css("left",$(a).offset().left+25)},this.hasActiveInput=function(){return isDef($("*:focus").attr("id"))},this.updateGameStats=function(){var a=c.gc.getGameManager();if(a){var b=a.getGameId(),d="<span>"+b+"</span>",e=a.getGameInfo(),f="—";e.totalPlayed>0&&(f=(e.avgWinTime>0?formatGameTimeMS(e.avgWinTime):"—")+(c.options.showWinCount?" ("+e.totalWon+"/"+e.totalPlayed+")":"")),f="<span>"+c.i18n.get("ratingLabel")+" "+f+" </span>",c.options.showGameLabel&&(f="<span>"+e.label+"</span> / "+f);var g="";c.options.showHistoryLength&&(g="<span>"+c.i18n.get("historyLengthLabel")+" "+c.gc.getGameManager().getHistoryLength()+"</span>");var h=a.getGameTimer(),i=h.getTime(),j=formatGameTime(i),k=a.getTotalGameTime(),l=formatGameTime(k);if(h.isFrozen())var m="<span class='frozenTime'>"+c.i18n.get("attemptTimeLabel")+" "+j+"</span>",n="<span class='frozenTime'>"+c.i18n.get("gameTimeLabel")+" "+l+"</span>";else m="<span>"+c.i18n.get("attemptTimeLabel")+" "+j+"</span>",n="<span>"+c.i18n.get("gameTimeLabel")+" "+l+"</span>";$("#gameStatePanel").empty().append(d+" / "+f+" / "+(c.options.showHistoryLength?g+" / ":"")+m+" / "+n),$("#gameStatePanel").show()}else c.setGameLoading()},this.attemptsChanged=function(){c.refreshAttempts()},this.refreshAttempts=function(){var a=c.gc.getGameManager();if(a){var b=a.getAttempts(),d=a.getCurrentAttempt(),e=c.i18n.get("attemptsLabel")+": ";if(1==b.length&&b[0].isFresh())e+="—";else for(var f=b.length-1;f>=0;f--){var g=b[f],h="";g==d&&(h=" bigAttempt "),g.isWon()&&(h+=" wonAttempt "),e+="<span id='restoreAttempt"+f+"' class='restoreAttempt"+h+"'>"+(f+1)+"</span> "}$("#attemptsPanel").empty().append(e);for(var f=b.length-1;f>=0;f--)$("#restoreAttempt"+f).click(function(b){return function(){var d=c.gc.getGameManager().getCurrentAttempt();(b.isWon()||b!=d)&&a.restoreAttempt(b)}}(b[f]))}else c.setGameLoading()},this.setGameLoading=function(){$("#attemptsPanel").empty(),$("#gameStatePanel").empty().append("Загрузка игры...")},this.isGameAreaActive=function(){for(var a in c.activePanels){var b=c.activePanels[a];if(b.type==OVER_FIELD_PANEL)return!1}return!0},this.hideAllActivePanels=function(){var a=c.activePanels;c.activePanels=[];for(var b in a){var d=a[b];d.type==OVER_FIELD_PANEL&&$("#welcomeOverlay").hide(),isDef(d.onClose)&&d.onClose(),$("#"+d.id).hide(),d instanceof BottomSubPanel&&isDef(d.destroy)&&d.destroy()}},this.hidePanel=function(a){c.hideAllActivePanels(),a instanceof BottomSubPanel&&(a.fireOnClose(HIDE_SINGLE_PANEL),a.destroy())},this.showPanel=function(a){if(c.hideAllActivePanels(),isDef(a.type)&&a.type==OVER_FIELD_PANEL){var b=document.getElementById("game-field")?"#game-field":"#field";c.centerPanel("#"+a.id,b,"welcomePanel"==a.id),$("#welcomeOverlay").show()}c.activePanels.push(a),$("#"+a.id).show(),a instanceof BottomSubPanel&&a.fireOnShow()},this.centerPanel=function(a,b,c,d){isDef(d)&&d||$(a).css("position","absolute"),isDef(c)&&c||$(a).css("top",$(b).position().top+($(b).height()-$(a).height())/2),$(a).css("left",$(b).position().left+($(b).width()-$(a).width())/2)},multiExtendClass(SharedUI,SafeSharedUI,this),window._isFb||window._isVk?($(".profileLogoutPanel").hide(),$(".share42init").hide(),$("#welcomePanel").hide(),$("#inviteFriend").hide(),$("#showShared").hide(),$(".lg-workbaner").hide()):$(".lg-workbaner").show()}function uiShowHint(a,b){$("body").append("<p class='floatingHint' id='floatingHint'>"+b+"</p>"),$("#floatingHint").css("top",$(a).offset().top-53),$("#floatingHint").css("left",$(a).offset().left+25)}function uiHideHint(){$(".floatingHint").remove()}function uiGetOrderHint(a){return a?"<br /><span style='font-size: 6pt;'> ("+I18n.contextGet("ui","ascOrderHint")+")</span>":"<br /><span style='font-size: 6pt;'> ("+I18n.contextGet("ui","descOrderHint")+")</span>"}function uiSetLoading(a){$(a).empty().append("<div style='padding-top: 15px; padding-left:15px; height:30px;'><span style='float: left; color:#444; font-weight: normal;'>"+I18n.contextGet("ui","loadingNotice")+"...&nbsp;</span><img style='float: left; margin-top: -12px;' src='/img/icons/loading.gif'></div>")}function SharedGameManager(){var a=this;a.currentAttempt=null,a.silent=!1,this.getGameInfo=function(){return a.gameInfo},this.getGameId=function(){return a.gameId},this.getGame=function(){return a.g},this.getGameTimer=function(){return a.currentAttempt.getGameTimer()},this.getTotalGameTime=function(){var b=0;for(var c in a.attempts){var d=a.attempts[c];b+=d!=a.currentAttempt?d.getGameTime():d.getGameTimer().getTime()}return b},this.getHistory=function(){return a.currentAttempt.getHistory()},this.getEncodedHistory=function(){return a.currentAttempt.getEncodedHistory()},this.getAttempts=function(){return a.attempts},this.getCurrentAttempt=function(){return a.currentAttempt},this.getHistoryLength=function(){return a.currentAttempt.getHistory().length},this.applyEncodedHistory=function(b){a.g.notifyGoSilent(!0),a.serializer.applyEncodedHistory(a.g,b),null!=a.currentAttempt&&a.currentAttempt.isWon()&&a.rewind(),a.g.notifyGoSilent(!1)},this.removeAttempt=function(b){for(var c in a.attempts)if(a.attempts[c]==b)return a.attempts.splice(c,1),!0;return!1},this.canUndo=function(){return a.currentAttempt.getHistory().length>0},this.replay=function(){a.finishCurrentAttempt(),a.currentAttempt=new Attempt(a.serializer),a.currentAttempt.setGameId(a.gameId),a.attempts.push(a.currentAttempt),a.g.setupNewGame(),a.notifyAttemptsChange(),a.notifyGameStateUpdate()},this.isWon=function(){return null==a.currentAttempt?!0:a.currentAttempt.isWon()},this.hasUserActivity=function(){a.currentAttempt.getGameTimer().unfreeze()},this.finishCurrentAttempt=function(){var b=hasFunc(a.isGameValueless)?a.isGameValueless():!1;null==a.currentAttempt||a.currentAttempt.finish()&&(a.currentAttempt.isWon()||!b)?null==a.currentAttempt||a.currentAttempt.isWon()||this.notifyAttemptUpdated(a.currentAttempt):this.removeAttempt(a.currentAttempt),a.currentAttempt=null},this.restoreAttempt=function(b){a.finishCurrentAttempt(),a.currentAttempt=b,a.g.setupNewGame();var c=b.getEncodedHistory();a.applyEncodedHistory(c),a.notifyAttemptsChange(),a.notifyGameStateUpdate(),a.notifyAttemptRestored()},this.notifyGameStateUpdate=function(){for(var a=0;a<this.listeners.length;a++){var b=this.listeners[a];isDef(b.gameStateChanged)&&b.gameStateChanged()}this.notifyAttemptsChange()},this.notifyAttemptsChange=function(){for(var a=0;a<this.listeners.length;a++){var b=this.listeners[a];isDef(b.attemptsChanged)&&b.attemptsChanged()}},this.notifyAttemptUpdated=function(b){for(var c=0;c<this.listeners.length;c++){var d=this.listeners[c];isDef(d.attemptUpdated)&&d.attemptUpdated(a.gameId,b)}this.notifyAttemptsChange()},this.notifyAttemptRestored=function(){for(var a=0;a<this.listeners.length;a++){var b=this.listeners[a];isDef(b.attemptRestored)&&b.attemptRestored()}},this.addListener=function(a){this.listeners.push(a)},this.gameIsWon=function(){a.currentAttempt.isWon()||(a.currentAttempt.win(),this.notifyAttemptUpdated(a.currentAttempt),this.notifyAttemptsChange())},this.wentSilent=function(b){a.silent!=b&&(a.silent=b,a.silent||this.notifyGameStateUpdate())},this.setupSharedGameManager=function(){a.listeners=new Array}}function SharedGame(){var a=this;this.notifyWinState=function(){for(var b=0;b<a.listeners.length;b++){var c=a.listeners[b];isDef(c.gameIsWon)&&c.gameIsWon()}},this.notifyNewGameIsSet=function(){for(var b=0;b<a.listeners.length;b++){var c=a.listeners[b];isDef(c.newGameIsSet)&&c.newGameIsSet()}},this.notifyGoSilent=function(b){for(var c=0;c<a.listeners.length;c++){var d=a.listeners[c];isDef(d.wentSilent)&&d.wentSilent(b)}},this.notifyWinState=function(){for(var b=0;b<a.listeners.length;b++){var c=a.listeners[b];isDef(c.gameIsWon)&&c.gameIsWon()}}}function SharedController(){var a=this;a.i18n=new I18n,a.i18n.setContext("controller"),this.reloadPage=function(){window.location.href=a.gameURL},this.isGameLoaded=function(){return null!=a.gm},this.setupSharedController=function(){var b;$("#tbUndo").click(function(){a.isGameActive()&&a.gm.undo()}).mousedown(function(){clearInterval(b),b=setInterval(function(){clearInterval(b),b=setInterval(function(){a.isGameActive()?a.gm.undo():clearInterval(b)},50)},400)}).mouseup(function(){clearInterval(b)}).mouseout(function(){clearInterval(b)}),$("#tbRedo").click(function(){a.isGameActive()&&a.gm.redo()}).mousedown(function(){clearInterval(b),b=setInterval(function(){clearInterval(b),b=setInterval(function(){a.isGameActive()?a.gm.redo():clearInterval(b)},50)},400)}).mouseup(function(){clearInterval(b)}).mouseout(function(){clearInterval(b)}),$("#tbNewGame").click(function(){a.isGameActive()&&(a.isGameValueless()||confirm(a.i18n.get("startNewGamePrompt")))&&a.startNextGame()}),$("#tbReplay").click(function(){a.isGameActive()&&(a.isGameValueless()||confirm(a.i18n.get("replayGamePrompt")))&&a.replay()})},this.startNextGame=function(b){a.requestGame(-1,-1,b,BEGIN_NEW_ATTEMPT)},this.replay=function(){a.notifyNewAttemptStarted(),a.gm.replay()},this.attemptUpdated=function(b,c){isDef(a.__attemptUpdated)&&a.__attemptUpdated(b,c),c.isWon()?a.ui.showCongratulations(function(){a.cs.uploadAttempt(b,c,function(b,c){b&&isDef(c.bonus)&&a.ui.renderBonus(c.bonus)})}):a.cs.uploadAttempt(b,c)},this.notifyEsc=function(){for(var b=0;b<a.listeners.length;b++){var c=a.listeners[b];isDef(c.escKeyDown)&&c.escKeyDown()}},multiExtendClass(SharedController,Listener,this)}function ProfileClientServer(){var a=this;this.loadProfile=function(b,c){null==b&&(b=a.getUserId()),$.post("/gw/profile/loadProfile.php",{sessionId:a.getSessionId(),userId:a.getUserId(),playerId:b},function(b){a.setRecentData(b);var d=parseJSON(b);null!=d&&"ok"==d.status?c(!0,d.profile):c(!1)})},this.updateProfile=function(b){$("#profileForm").ajaxSubmit({data:{sessionId:a.getSessionId(),userId:a.getUserId(),preupload:0},success:function(c){a.setRecentData(c);var d=parseJSON(c);null!=d&&"ok"==d.status?b(!0,d):b(!1)}})},this.preuploadPhoto=function(b){$("#profileForm").ajaxSubmit({data:{sessionId:a.getSessionId(),userId:a.getUserId(),preupload:1},success:function(c){a.setRecentData(c);var d=parseJSON(c);null!=d&&"ok"==d.status?b(!0,d):b(!1)}})},this.loadConversations=function(b){$.post("/gw/profile/loadConversations.php",{sessionId:a.getSessionId(),userId:a.getUserId()},function(c){a.setRecentData(c);var d=parseJSON(c);null!=d&&"ok"==d.status?b(!0,d.conversations):b(!1)})},this.sendMessage=function(b,c,d,e,f){$.post("/gw/profile/sendMessage.php",{sessionId:a.getSessionId(),userId:a.getUserId(),gameVariationId:a.getGameVariationId(),recipient:b,msg:c,replyTo:d,fromAdmin:e},function(b){a.setRecentData(b);var c=parseJSON(b);null!=c&&"ok"==c.status?isDef(f)&&f(!0):isDef(f)&&f(!1)})},this.sendMassMsg=function(b,c,d){$.post("/gw/profile/sendMassMsg.php",{sessionId:a.getSessionId(),userId:a.getUserId(),gameVariationId:a.getGameVariationId(),text:b,recipientList:$.toJSON(c)},function(b){a.setRecentData(b);var c=parseJSON(b);null!=c&&"ok"==c.status?isDef(d)&&d(!0):isDef(d)&&d(!1)})},this.loadConversation=function(b,c){$.post("/gw/profile/loadConversation.php",{sessionId:a.getSessionId(),userId:a.getUserId(),opponent:b},function(b){a.setRecentData(b);var d=parseJSON(b);null!=d&&"ok"==d.status?isDef(c)&&c(!0,d):isDef(c)&&c(!1)})},this.loadRecipients=function(b){$.post("/gw/profile/loadRecipients.php",{sessionId:a.getSessionId(),userId:a.getUserId()},function(c){a.setRecentData(c);var d=parseJSON(c);null!=d&&"ok"==d.status?isDef(b)&&b(!0,d.recipients):isDef(b)&&b(!1)})},this.updateUserSettings=function(a,b){cs.sendRequest("/gw/profile/updateUserSettings.php",{isInvisible:boolToInt(a.isInvisible)},b)}}function SharedClientServer(){var a,b,c,d,e=this,f="",g=-2;this.setSessionId=function(b){a=b},this.getSessionId=function(){return a},this.setUser=function(a,e,f){b=a,c=e,d=f},this.getUserId=function(){return b},this.getUsername=function(){return c},this.isGuest=function(){return d},this.isLogged=function(){return!d},this.isSuperUser=function(){return 40==b||144==b||19729==b||18136==b||448039==b||80911==b||460981==b||708734==b||3172467==b||7123667==b||6720145==b},this.setRecentData=function(a){f=a},this.getRecentData=function(){return f},this.goSynchronous=function(){jQuery.ajaxSetup({async:!1})},this.sendRequest=function(a,b,c){isDef(b.sessionId)||(b.sessionId=e.getSessionId()),isDef(b.userId)||(b.userId=e.getUserId()),isDef(b.gameVariationId)||(b.gameVariationId=e.getGameVariationId()),$.post(a,b,function(a){e.setRecentData(a);var b=parseJSON(a);if(null!=b&&"ok"==b.status)isDef(c)&&(isDef(b.data)?c(!0,b.data):c(!0));else{var d=UNKNOWN_REASON;"notlogged"==b.status&&(d=NOT_LOGGED),isDef(c)&&c(!1,null,{reason:d})}})},this.logout=function(a){e.sendRequest(LOGOUT_GATEWAY,{},function(b,c){b?(e.setUser(c.userId,c.username,!0),isDef(a)&&a(!0)):isDef(a)&&a(!1)})},this.loadGameInfo=function(a,b){$.post("gw/loadGameInfo.php",{sessionId:e.getSessionId(),userId:e.getUserId(),gameId:a},function(a){e.setRecentData(a);var c=parseJSON(a);if("ok"==c.status){var d=parseInt(c.totalPlayed),f=parseInt(c.totalWon),g=parseInt(c.avgWinTime),h=c.bestAttemptTop,i=c.comment,j=c.fav;isDef(b)&&b(!0,d,f,g,h,i,j,c.playerList)}else isDef(b)&&b(!1)})},this.saveComment=function(a,b,c,d){e.isLogged()&&this.sendRequest("gw/saveComment.php",{gameId:a,comment:b,fav:c},d)},this.sendBeacon=function(a,b,c,d){g++,(g>=a||-1==g)&&(g=0,$.ajax({url:"/gw/beacon.php",type:"POST",data:{nocache:(new Date).getTime(),sessionId:e.getSessionId(),userId:e.getUserId(),gameVariationId:e.getGameVariationId(),lastActivityDelta:c},timeout:b,async:!0}).done(function(a){var b=parseJSON(a);null!=b&&"ok"==b.status&&isDef(d)&&d(!0,b)}).error(function(){isDef(d)&&d(!1)}))}}function GuestBookRenderer(a,b,c){var d,e,f,g=this,h={suppressScrollTop:!1,gameAreaHeight:null},i=new I18n;i.setContext("guestBook"),this.run=function(){$("#guestBookPanel").is(":visible")?e.hidePanel("guestBookPanel"):(f=d.getClientServer(),e.setLoading("#gbContents"),this.loadAndRender(!1),e.showPanel({id:"guestBookPanel",type:BOTTOM_PANEL}))},this.loadAndRender=function(a){a&&$("#gbLoadingImg").show(),f.sendRequest("/gw/guestbook/gbLoadBoard.php",{},function(b,c){$("#gbLoadingImg").hide(),b&&(g.render(c),a||g.scrollTop())})},this.scrollTop=function(){if(!g.options.suppressScrollTop){var a;a=g.options.gameAreaHeight?g.options.gameAreaHeight:$("#gameArea").height(),$("html, body").animate({scrollTop:$("#guestBookPanel").offset().top-iDiv(a,3)},"normal")}},this.render=function(a){var b=a.messages,c=[];if(b.length>0){var d="<table class='smartNoBordersTable' style='width: 100%; padding-top: 25px;'>";for(var e in b)b[e]._id=b.length-e,b[e].answerId?c.push(b[e]):d+=this.renderMessage(b[e],b.length-e);d+="</table>"}else d="<div class='gbNoMessagesAlert'>"+i.get("noMessagesAlert")+"</div>";var h="";f.isSuperUser()&&(h="<div style='margin-top: 3px; margin-right: 3px; float: left;'><input type='checkbox' id='gbIsAdminPost'>"+i.get("isAdminPostLabel")+"</a></div>");var j="<textarea id='gbPostText' class='gbPostTextArea' rows='3'></textarea><img src='/img/icons/loading.gif' id='gbPostLoadingIcon' alt='"+i.get("postLoadingAltText")+"'/>"+h+"<div id='gbPostBtn' class='constantWidthBtn'>"+i.get("postButtonLabel")+"</div><div class='clear'></div>",k="<h4>"+i.get("header")+"</h4>"+j+d;$("#gbContents").empty().append(k),g.renderAnswerMessages(c),g.bind(),f.isSuperUser()&&g.bindAdminEditables(b)},this.renderAnswerMessages=function(a){for(var b,c,d,e,f=a.length-1;f>=0;f--)b=a[f],d=$($(".smartNoBordersTable tr[data-id="+b.answerId+"] td")[0]),e=b.text.replace(/\n/gi,"<br />"),e="<span class='gbUsername'>"+b.username+"</span>&nbsp;&nbsp;&nbsp;&nbsp;<div class='gbAnswerText ' id='gbMsgTextTd"+b.msgId+"'><div>"+b.text.replace(/\n/gi,"<br />")+"</div></div>",c=$("<div>").html(e).addClass("gbAnswerMessage "+(b.byAdmin?"gbAdminMsg":"")),d.append(c),$(".gbAnswerButton[data-id="+b.answerId+"]").hide()},this.addAnswerBlock=function(a){var b=$(a.target).attr("data-id");$(".gbPostAnswer").remove();var c="";f.isSuperUser()&&(c="<div style='margin-top: 3px; margin-right: 3px; float: left;'><input type='checkbox' id='gbIsAdminAnswer' checked>"+i.get("isAdminPostLabel")+"</a></div>");var d="<textarea id='gbPostAnswerText' class='gbPostTextArea' rows='3'></textarea><img src='/img/icons/loading.gif' id='gbPostLoadingIcon' alt='"+i.get("postLoadingAltText")+"'/>"+c+"<div id='gbPostAnswerBtn' class='constantWidthBtn'>"+i.get("postButtonLabel")+"</div><div class='clear'></div>",e=$("<div>");e.addClass("gbPostAnswer"),e.html(d);var h=$($(".smartNoBordersTable tr[data-id="+b+"] td")[0]);h.append(e),$("#gbPostAnswerBtn").click(function(){var a=$.trim($("#gbPostAnswerText").val());0!=a.length&&(f.sendRequest("/gw/guestbook/gbPostMessage.php",{text:a,answerId:b,isAdminPost:bool2Int($("#gbIsAdminAnswer").is(":checked"))},function(a,b){$("#gbPostLoadingIcon").hide(),a&&g.render(b)}),$(".gbPostAnswer").remove(),$("#gbPostLoadingIcon").show())}),console.log($(a.target).attr("data-id"))},this.bindAdminEditables=function(a){for(var b in a){var c=a[b],d=c.msgId;$("#gbMsgTextTd"+d).dblclick(function(a){return function(){g.makeMessageEditable(a)}}(c))}},this.makeMessageEditable=function(a){var b="<textarea style='width: 100%' rows='5' id='gbEditAreaText"+a.msgId+"'>"+a.text+"</textarea><br/><input type='submit' value='"+i.get("saveChangesButtonLabel")+"' id='gbEditAreaSave"+a.msgId+"'></input><input type='submit' value='Удалить' id='gbEditAreaDelete"+a.msgId+"'></input><input type='submit' style='float: right;' value='Отмена' id='gbEditAreaCancel"+a.msgId+"'></input>";$("#gbMsgTextTd"+a.msgId).empty().append(b),$("#gbEditAreaSave"+a.msgId).click(function(){var b=$("#gbEditAreaText"+a.msgId).val();f.sendRequest("/gw/guestbook/gbEditMessage.php",{msgId:a.msgId,newText:b},function(a,b){a&&g.render(b)})}),$("#gbEditAreaDelete"+a.msgId).click(function(){confirm("Удалить сообщение =="+a.text+"== от "+a.username+"?")&&f.sendRequest("/gw/guestbook/gbDeleteMessage.php",{msgId:a.msgId},function(a,b){a&&g.render(b)})}),$("#gbEditAreaCancel"+a.msgId).click(function(){g.loadAndRender(!0)})},this.bind=function(){$("#gbPostBtn").click(function(){g.postMessage()}),$(".gbAnswerButton").click(g.addAnswerBlock)},g.postMessage=function(){var a=$.trim($("#gbPostText").val());0==a.length?alert(i.get("emptyMsgAlert")):($("#gbPostLoadingIcon").show(),f.sendRequest("/gw/guestbook/gbPostMessage.php",{text:a,isAdminPost:bool2Int($("#gbIsAdminPost").is(":checked"))},function(a,b){$("#gbPostLoadingIcon").hide(),a&&(g.render(b),g.scrollTop())}))},this.renderMessage=function(a){var b=(a.msgId,"");a.replyTS>0&&(b="<div class='gbReplyText gbAdminMsg'><b>"+i.get("adminUsername")+": </b>"+a.replyText+"</div>");var c=a.text.replace(/\n/gi,"<br />");c="<div class='gbMessageText "+(a.byAdmin?"gbAdminMsg":"")+"' id='gbMsgTextTd"+a.msgId+"'> <div>"+c+"</div>"+(f.isSuperUser()?"<span class='gbAnswerButton' data-id='"+a.msgId+"'>Ответить</span>":"")+"</div>";var d="<tr><td class='gbUsernameDateTd'><span class='gbUsername'>"+a.username+"</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class='gbDate'>"+formatDateRu(a.timestamp)+'</span><span class="gbMessageNumber">#'+a._id+"</span></td></tr><tr data-id='"+a.msgId+"'><td class='gbMsgTextTd' >"+c+b+"</td><td style='position: relative'></td></tr>";return d},this.bindAll=function(){$("#gbShow").click(function(){g.run()}),e.bindCloseIcon("#gbCloseIcon","guestBookPanel")},d=a,e=b,isDef(c)&&null!=c&&mergeObj(h,c),g.options=h,this.bindAll()}function ParametersManager(a,b,c){var d,e,f,g,h,i,j=this,k={},l=new I18n;l.setContext("parameters"),this.resetSettings=function(){g=isDef(k.defaultPlayMode)?k.defaultPlayMode:PM_PLAY_RANDOM,h=GT_ALL,i=PF_ALL},this.run=function(){$("#gpThemeList").val(j.currentTheme),f=d.getClientServer(),$("#parametersPanel").is(":visible")?e.hidePanel("parametersPanel"):this.setAndShow()},this.setAndShow=function(){g==PM_PLAY_RANDOM?$("#playRandomOption").attr("checked",!0):g==PM_PLAY_SUCC&&$("#playSuccOption").attr("checked",!0),h==GT_ALL?$("#playAll").attr("checked",!0):h==GT_EASY?$("#playEasy").attr("checked",!0):h==GT_NORMAL?$("#playNormal").attr("checked",!0):h==GT_HARD?$("#playHard").attr("checked",!0):h==GT_UNSOLVED?$("#playUnsolved").attr("checked",!0):h==GT_UNPLAYED&&$("#playUnplayed").attr("checked",!0),$("#dontServePlayedOption").attr("checked",i==PF_NOTPLAYED),$("#dontServeWonGamesOption").attr("checked",i==PF_NOTWON),$("#gameIdTextField").val(""),null!=k&&isDef(k.allowToChooseGameType)&&!k.allowToChooseGameType&&($("#chooseGameTypeSection").hide(),isDef(k.allowToChooseCardTheme)&&k.allowToChooseCardTheme||$("#gpCommitCancelSection").css("margin-top","30px")),e.showPanel({id:"parametersPanel",type:OVER_FIELD_PANEL})
},this.bindAll=function(){$("#dontServePlayedOption").change(function(){$("#dontServePlayedOption").attr("checked")&&$("#dontServeWonGamesOption").attr("checked",!1)}),$("#dontServeWonGamesOption").change(function(){$("#dontServeWonGamesOption").attr("checked")&&$("#dontServePlayedOption").attr("checked",!1)}),$("#gpCommit").bind("click",function(){if(e.hidePanel("parametersPanel"),j.updateUserSettings(),""!=$("#gameIdTextField").val()){var a=parseInt(trimLeadingZeros($("#gameIdTextField").val()));a>=d.getLowerGameIdBound()&&a<=d.getHigherGameIdBound()||f.isSuperUser()&&d.isValidGameId(a)?d.requestGame(a):e.alert(l.format("gameIdRangeAlert",d.getLowerGameIdBound(),d.getHigherGameIdBound()))}$("#gpThemeList option:selected").val()!=j.currentTheme&&j.gc.redirectRelative("?theme="+$("#gpThemeList option:selected").val())}),$("#gpCloseIcon").bind("click",function(){e.hidePanel("parametersPanel"),j.updateUserSettings()}),$("#gpCancel").bind("click",function(){e.hidePanel("parametersPanel")}),$("#gpThemeList").change(function(){})},this.updateUserSettings=function(){i=$("#dontServePlayedOption").is(":checked")?PF_NOTPLAYED:$("#dontServeWonGamesOption").is(":checked")?PF_NOTWON:PF_ALL,$("#playRandomOption").is(":checked")?g=PM_PLAY_RANDOM:$("#playSuccOption").is(":checked")&&(g=PM_PLAY_SUCC),$("#playAll").is(":checked")?h=GT_ALL:$("#playHard").is(":checked")?h=GT_HARD:$("#playNormal").is(":checked")?h=GT_NORMAL:$("#playEasy").is(":checked")?h=GT_EASY:$("#playUnsolved").is(":checked")?h=GT_UNSOLVED:$("#playUnplayed").is(":checked")&&(h=GT_UNPLAYED),isDef(j.gc.resetNewGameLister)&&j.gc.resetNewGameLister(),j.uploadUserSettings()},this.uploadUserSettings=function(){var a=new Object;a.playMode=g,a.gameType=j.getGameType(),a.playFilter=i;var b=$.toJSON(a);f.sendRequest(GTW_UPDATE_USER_SETTINGS,{settings:b})},this.applySettings=function(a){var b=parseJSON(a);null!=b&&(isDef(b.playMode)&&(g=b.playMode),isDef(b.gameType)&&(h=b.gameType,h==GT_UNPLAYED&&(h=GT_UNSOLVED)),isDef(b.playFilter)&&(i=b.playFilter,i==PF_NOTPLAYED&&(i=PF_ALL)))},this.getPlayMode=function(){return g},this.getGameType=function(){return null!=k&&isDef(k.allowToChooseGameType)&&!k.allowToChooseGameType?GT_ALL:h},this.getPlayFilter=function(){return i},d=a,e=b,j.gc=d,j.ui=e,isDef(c)&&null!=c&&(k=c),j.options=k,j.currentTheme="windows",isDef(j.options.allowToChooseCardTheme)&&j.options.allowToChooseCardTheme&&$("#chooseCardThemeSection").show(),isDef(j.options.currentTheme)&&(j.currentTheme=j.options.currentTheme),this.bindAll(),this.resetSettings()}function LoginRegisterManager(a,b,c,d){var e,f,g,h=this,i={showWelcomePanel:!1},j=null,k=null,l=new I18n;l.setContext("loginRegister"),this.cleanUp=function(){$("#loginResult").empty(),$("#usernameAlert").empty(),$("#passwdAlert").empty(),$("#regUsername").val(""),$("#regPasswd").val(""),$("#regPasswdVerification").val("")},this.showRegMePanel=function(){$("#lrRegisterSection").show(),$("#lrLoginSection").hide(),$("#lrGuestSection").hide(),$("#restorePassPanel").hide(),$(".constantWidthTd").removeClass("rowWon"),$("#wpReg").addClass("rowWon"),$("#regUsername").focus()},this.showLoginBubblePanel=function(){$("#lrRegisterSection").hide(),$("#lrGuestSection").hide(),$("#restorePassPanel").hide(),$("#lrLoginSection").show(),$(".constantWidthTd").removeClass("rowWon"),$("#wpLogin").addClass("rowWon"),$("#loginUsername").focus()},this.showGuestAttentionPanel=function(){$("#lrRegisterSection").hide(),$("#lrLoginSection").hide(),$("#restorePassPanel").hide(),$("#lrGuestSection").show(),$(".constantWidthTd").removeClass("rowWon"),$("#wpClose").addClass("rowWon"),$("#loginUsername").focus()},this.doLogin=function(){var a=$("#loginUsername").val(),b=$("#loginPasswd").val();g.getClientServer().sendRequest(LOGIN_GATEWAY,{username:a,passwd:b},function(a,b){a?(g.getClientServer().setUser(b.userId,b.username,!1),g.setAboutToLogin(!0),$("#loginForm").trigger("submit")):h.showNoLoginPasswdMatch()})},this.showNoLoginPasswdMatch=function(){$("#loginResult").empty().append("<div class='lrRedAlert'>"+l.get("loginPasswdNoMatchNotice")+"</div>"),setTimeout(function(){$("#loginResult").empty()},2e3)},this.switchToRegister=function(){$("#usernameAlert").empty(),$("#passwdAlert").empty(),$("#regUsername").val(""),$("#regPasswd").val(""),$("#regPasswdVerification").val(""),$("#regUsername").focus(),h.showRegMePanel()},this.switchToLogin=function(){h.showLoginBubblePanel()},this.regValidateUsername=function(){var a=$("#regUsername").val();a.length>0&&a.length<3?h.setRegUsernameAlert(l.get("minUsernameLengthNotice"),!1):a.length>25?h.setRegUsernameAlert(l.get("maxUsernameLengthNotice"),!1):h.regHotVerifyUsername()},this.regValidatePasswd=function(){var a=$("#regPasswd").val(),b=$("#regPasswdVerification").val();a.length>0&&a.length<5?h.setRegPasswdAlert(l.get("minPasswdLengthNotice"),!1):a.length>25?h.setRegPasswdAlert(l.get("maxPasswdLengthNotice"),!1):""!=b?a!=b?h.setRegPasswdAlert(l.get("passwdsDontMatchNotice"),!1):h.setRegPasswdAlert(l.get("passwdsDoMatchNotice"),!0):h.setRegPasswdAlert("")},this.setRegPasswdAlert=function(a,b){if(""!=a){var c=b?"lrGreenAlert":"lrRedAlert";$("#passwdAlert").empty().append("<div class='"+c+"'>"+a+"</div>"),k=b}else $("#passwdAlert").empty(),k=!1},this.regHotVerifyUsername=function(){var a=$("#regUsername").val();a.length>=3&&a.length<=25&&g.getClientServer().sendRequest(CHECK_USERNAME_GATEWAY,{username:a},function(a,b){a&&(b.isAvailable?h.setRegUsernameAlert(l.get("usernameAvailableNotice"),!0):h.setRegUsernameAlert(l.get("usernameTakenNotice"),!1))})},this.setRegUsernameAlert=function(a,b){var c=b?"lrGreenAlert":"lrRedAlert";$("#usernameAlert").empty().append("<div id='usernameAlertInt' style='position: relative;' class='"+c+"'>"+a+"</div>"),j=b},this.doRegister=function(){var a=g.getClientServer(),b=$.trim($("#regUsername").val()),c=$("#regPasswd").val();h.regValidateUsername(),h.regValidatePasswd(),""==b&&h.setRegUsernameAlert(l.get("usernameRequiredNotice"),!1),""==c&&h.setRegPasswdAlert(l.get("passwdRequiredNotice"),!1),j&&k&&a.sendRequest(REG_GATEWAY,{username:b,passwd:c},function(b,c){b?(a.setUser(c.userId,c.username,!1),g.reloadPage?g.reloadPage():f.onRegistration()):($("#regResult").show(),$("#regResult").empty().append("<div class='lrRedAlert'>"+l.get("usernameTakenNotice")+"</div>"),$("#regResult").delay(2e3).fadeOut("fast"))})},this.doRestorePass=function(){var a=g.getClientServer(),b=$.trim($("#rpUsername").val()),c=$.trim($("#rpMail").val());return b&&c?void a.sendRequest(RES_GATEWAY,{username:b,mail:c},function(a,b){"ok"==b.result?(alert("Новый пароль отправлен на указанный адрес электронной почты."),h.showLoginBubblePanel()):($("#rpResult").show(),$("#rpResult").empty().append("<div class='lrRedAlert'>Введённая пара имя пользователя/электронная почта не найдена.</div>"),$("#rpResult").delay(2e3).fadeOut("fast"))}):($("#rpResult").show(),$("#rpResult").empty().append("<div class='lrRedAlert'>Введённая пара имя пользователя/электронная почта не найдена.</div>"),void $("#rpResult").delay(2e3).fadeOut("fast"))},this.bindLoginRegisterButton=function(){$("#bbLoginRegister").bind("click",function(){$("#welcomePanel").is(":visible")?f.hidePanel("welcomePanel"):h.showWelcomePanel()})},this.bindAll=function(){this.bindLoginRegisterButton(),$("#loginCommit").click(function(){h.doLogin()}),$("#loginCancel").click(function(){f.hidePanel("loginRegisterPanel")}),$("#loginForm").bind("keypress",function(a){var b=a.which?a.which:a.keyCode;b==KEY_ENTER&&h.doLogin()}),$("#regForm").bind("keypress",function(a){var b=a.which?a.which:a.keyCode;b==KEY_ENTER&&h.doRegister()}),$("#switchToRegister").click(function(){h.switchToRegister()}),$("#regUsername").keyup(function(){h.regHotVerifyUsername()}),$("#regUsername").blur(function(){h.regValidateUsername()}),$("#regPasswdVerification").blur(function(){h.regValidatePasswd()}),$("#regPasswd").blur(function(){h.regValidatePasswd()}),$("#regForm").submit(function(){return h.doRegister(),!1}),$("#regMeBtn").click(function(){h.doRegister()}),$("#rpCommit").click(function(){h.doRestorePass()}),$("#restorePass").click(function(){$("#restorePassPanel").show(),$("#lrLoginSection").hide(),$("#lrGuestSection").hide(),$("#lrRegisterSection").hide()}),$("#rpCancel").click(function(){h.showLoginBubblePanel()}),$("#switchToLogin").click(function(){h.switchToLogin()}),$("#wpReg").click(function(){h.showRegMePanel()}),$("#wpLogin").click(function(){h.showLoginBubblePanel()}),$("#wpClose").click(function(){h.showGuestAttentionPanel()}),$("#wpVK").click(function(){vkAuthOpenAPI()}),$("#guestContinue").click(function(){f.hidePanel("welcomePanel")}),$("#closeRegMePanel, #lrCloseIcon").click(function(){f.hidePanel("loginRegisterPanel")}),$("#loginForm").submit(function(){var a=g.getClientServer();return a.isGuest()?!1:($("#hfSessionId").val(a.getSessionId()),$("#hfUserId").val(a.getUserId()),!0)})},this.showWelcomePanel=function(){var a=g.getClientServer();a.isGuest()&&($("#guestName").empty().append(l.transliterate(a.getUsername())),f.showPanel({id:"welcomePanel",type:OVER_FIELD_PANEL}),$("#lrLoginSection").hide(),$("#lrRegisterSection").hide(),$("#lrGuestSection").hide(),$("#restorePassPanel").hide(),$(".constantWidthTd").removeClass("rowWon"))},e=a,f=b,g=c,isDef(d)&&null!=d&&(i=d),this.bindAll(),isDef(i.showWelcomePanel)&&i.showWelcomePanel&&this.showWelcomePanel()}function HistoryRenderer(a,b,c){var d,e,f,g,h=this,i=GH_SHOW_ALL_FILTER,j=GH_SORT_BY_DATE,k=DESC,l="#historyContents",m={bindCPButton:!1,showLabels:!1,showDays:!0,showBestAttemptRank:!0,gameIdLabel:"hand",gameIdWidth:"12%"},n=new I18n;n.setContext("history"),this.run=function(){$("#historyPanel").is(":visible")?f.hidePanel("historyPanel"):(g=e.getClientServer(),f.setLoading("#historyContents"),h.paginator=new Paginator(0,HISTORY_PAGINATOR_COUNT,0),h.paginator.addListener(h),this.loadAndRender(!1),f.showPanel({id:"historyPanel",type:BOTTOM_PANEL,onClose:function(){null!=d&&h.saveComment(d)}}))},this.currentPositionChanged=function(){h.loadAndRender(!0,!0)},this.loadAndRender=function(a,b){b=ifDef(b,!1),a&&$("#ghLoadingImg").show(),b||h.paginator.reset(),g.sendRequest(GTW_HISTORY,{sortBy:j,order:boolToInt(k),filter:i,currentPosition:h.paginator.currentPosition,currentCount:h.paginator.currentCount},function(c,d,e){$("#ghLoadingImg").hide(),c?(h.render(d),(!a||b)&&$("html, body").animate({scrollTop:$("#historyPanel").offset().top-1*iDiv($("#gameArea").width(),5)},"normal")):h.ui.renderErrorReason(l,e.reason)})},this.generateHeader=function(a,b,c){return"<span"+(j==c?" class='activeSortHeader actionText4'":" class='actionText4'")+" id='"+a+"'>"+b+(j==c?f.getOrderHint(k):"")+"</span>"},this.bindHeaderAction=function(a,b,c){$(a).click(function(){j!=b?(j=b,k=c):k=!k,h.loadAndRender(!0)})},this.generateSortImg=function(a,b){return j==b?f.serverSortArrowsImg(k,"",a):" &nbsp;<img src='/img/icons/sort-both.png' id='"+a+"' alt=''/>"},this.render=function(a){var b=a.history,c=(a.userRankBySolvedCount,a.total);h.paginator.setTotal(c),d=null;var e=this.generateHeader("ghSortByGameId",n.get("gameIdLabel",h.options.gameIdLabel),GH_SORT_BY_GAME_ID),g=this.generateHeader("ghSortByWinTimeRank",n.get("wtLabel"),GH_SORT_BY_WIN_TIME_RANK),j=this.generateHeader("ghSortByBestAttemptRank",n.get("baLabel"),GH_SORT_BY_BEST_ATTEMPT_RANK),k=this.generateHeader("ghSortByDate",n.get(m.showDays?"dateDaysLabel":"dateLabel"),GH_SORT_BY_DATE),l="<table class='standartTable' style='clear:both;'  width='100%' border='0' vspace='0' cellspacing='0' hspace='0'><tr style='height: 42px;'><th colspan='"+(h.options.showLabels?3:2)+"' class='secondLevelRow nonSelectable' width='"+h.options.gameIdWidth+"'>"+e+"</th><th class='secondLevelRow'>"+n.get("commentLabel")+"</th><th class='secondLevelRow nonSelectable' colspan='3' width='15%'>"+g+"</th>"+(m.showBestAttemptRank?"<th class='secondLevelRow nonSelectable' colspan='3' width='15%' >"+j+"</th>":"")+"<th class='secondLevelRow nonSelectable' width='1%'>"+k+"</th></tr>";l+="<tr class='auxRow'><td class='ghArrows' colspan='"+(h.options.showLabels?3:2)+"'>"+h.generateSortImg("ghSortByGameIdImg",GH_SORT_BY_GAME_ID)+"</td><td class='ghNoArrows'>&nbsp;</td><td class='ghArrows' colspan='3'>"+h.generateSortImg("ghSortByWinTimeRankImg",GH_SORT_BY_WIN_TIME_RANK)+"</td>"+(m.showBestAttemptRank?"<td class='ghArrows' colspan='3'>"+h.generateSortImg("ghSortByBestAttemptRankImg",GH_SORT_BY_BEST_ATTEMPT_RANK)+"</td>":"")+"<td class='ghArrows'>"+h.generateSortImg("ghSortByDateImg",GH_SORT_BY_DATE)+"</td></tr>";for(var o=0,p=0,q=0,r=0,s=0;s<b.length;s++){var t=b[s],u=formatDate(t.timestamp);t.status==WIN_STATUS&&1!=t.peek&&(q++,r+=t.winTime),p++;var v="";v=t.status==NOT_WON_STATUS?" rowPlayed ":" rowWon ";var w;if(!(i==GH_SHOW_ONLY_FAV_FILTER&&0==t.fav||i==GH_SHOW_ONLY_UNSOLVED_FILTER&&t.status==WIN_STATUS)){o++,w="<span "+(t.gameId>=GH_GAME_LIMIT?"style='color: #C42E21;'":"")+" class='linkAlike nonSelectable' id='ghPlay"+t.gameId+"'>"+t.gameId+"</span>";var x="—",y="—";t.status==WIN_STATUS&&1!=t.peek&&(x=t.wtRank,y=t.baRank);var z=" style='text-align: right;'";0==t.winTime&&(z=" style='text-align: right; color: #777;'");var A=" style='text-align: right;'";if((t.status!=WIN_STATUS||t.peek)&&(A=" style='text-align: center;'"),h.options.showLabels)var B="<p style='display: inline; color: #777;'>"+t.label+"&nbsp;</p>";l=l+"<tr class='ghRow"+v+"' id='ghRow"+t.gameId+"' ><td class='noRightBorder'><img id='ghFav"+t.gameId+"' "+(0==t.fav?"style='display: none;'":"")+" class='ghFavImg' src='/img/icons/fav-2.png' alt=''/></td><td id='ghGameIdTd"+t.gameId+"' style='cursor: pointer; white-space: nowrap; padding-left: 5px;'"+(h.options.showLabels?" class='noRightBorder'":"")+"><p class='ghGameId nonSelectable' style='inline;'>&nbsp;"+w+"</p></td>"+(h.options.showLabels?"<td id='ghLabelTd"+t.gameId+"' style='white-space: nowrap; cursor: pointer;'>"+B+"</td>":"")+"<td id='ghCommentTd"+t.gameId+"'><p>"+h.generateFullComment(t)+"</p></td><td class='noRightBorder' "+z+">"+(0==t.winTime?"<span>"+formatGameTimeMS(t.totalGameTime)+"</span>":formatGameTimeMS(t.winTime))+"</td><td class='noRightBorder'>/</td>"+(0==x?'<td title="ваше место будет вычислено позднее">—</td>':"<td>"+x+"</td>")+(m.showBestAttemptRank?"<td class='noRightBorder' "+A+">"+(0==t.bestAttemptTime?"—":formatGameTimeMS(t.bestAttemptTime))+"</td><td class='noRightBorder'>/</td>"+(0==y?'<td title="ваше место будет вычислено позднее">—</td>':"<td>"+y+"</td>"):"")+"<td><p>"+u+(m.showDays?"&nbsp;/&nbsp;"+(t.playDays+1):"")+"</p></td></tr>"}}0==b.length&&(l+="<tr><td colspan='10'><div class='ghNoDataAlert'>"+n.get("noGamesByFilterAlert")+"</div></td></tr>"),l+="</table>",$("#historyContents").empty(),0==b.length&&i==GH_SHOW_ALL_FILTER?$("#historyContents").append("<div class='ghNoDataAlert'>"+n.get("noGamesAlert")+"</div>"):($("#historyContents").append("<p class='ghFilterPanel'><span class='auxText'>"+n.get("filtersLabel")+":&nbsp;&nbsp;&nbsp;</span><span class="+(i!=GH_SHOW_ALL_FILTER?"'linkAlike'":"'linkAlikeDisabled'")+" id='ghShowAll'>"+n.get("allFilterLabel")+"</span>&nbsp;&nbsp;&nbsp;<span class="+(i!=GH_SHOW_ONLY_FAV_FILTER?"'linkAlike'":"'linkAlikeDisabled'")+" id='ghShowOnlyFav'>"+n.get("favoritesFilterLabel")+"</span>&nbsp;&nbsp;&nbsp;<span class="+(i!=GH_SHOW_ONLY_UNSOLVED_FILTER?"'linkAlike'":"'linkAlikeDisabled'")+" id='ghShowOnlyUnsolved'>"+n.get("unsolvedFilterLabel")+"</span><img id='ghLoadingImg' alt='"+n.get("loadingAltText")+"' src='/img/icons/loading.gif'></p>"),$("#historyContents").append(l));var C=new PaginatorRenderer(h.paginator,"userHistory");$("#historyContents").append(C.render()),C.bindEvents();var D;if(D=q>0?Math.round(r/q):0,b.length>HISTORY_SHOW_SHORTCUTS_AFTER){var E="<div style='padding-top: 10px; margin-top: 20px; background-color: white;  border-top: 1px dashed #CCC;'>";E+="<div class='bspAuxBtn' style='float: left;' id='historyScroll'>["+n.get("auxScrollTop")+"]</div>",E+="<div class='bspAuxBtn' style='float: right;' id='historyClose'>["+n.get("auxClose")+"]</div>",E+="<div class='clear'></div>",E+="</div>",$("#historyContents").append(E),$("#historyScroll").click(function(){$("html, body").animate({scrollTop:$("#historyPanel").offset().top-iDiv($("#gameArea").width(),3)})}),$("#historyClose").click(function(){f.hidePanel("historyPanel")})}$("#ghShowAll").click(function(){i!=GH_SHOW_ALL_FILTER&&(i=GH_SHOW_ALL_FILTER,h.loadAndRender(!0))}),$("#ghShowOnlyFav").click(function(){i!=GH_SHOW_ONLY_FAV_FILTER&&(i=GH_SHOW_ONLY_FAV_FILTER,h.loadAndRender(!0))}),$("#ghShowOnlyUnsolved").click(function(){i!=GH_SHOW_ONLY_UNSOLVED_FILTER&&(i=GH_SHOW_ONLY_UNSOLVED_FILTER,h.loadAndRender(!0))}),h.bindActions(b)},this.bindActions=function(a){for(var b=0;b<a.length;b++){var c=a[b];$("#ghGameIdTd"+c.gameId+(h.options.showLabels?", #ghLabelTd"+c.gameId:"")).click(function(a){return function(){e.requestGame(a.gameId,null,function(){f.showGameInfo(a.gameId,!1)})}}(c)),$("#ghCommentTd"+c.gameId).dblclick(function(a){return function(){h.addCommentEditor(a)}}(c))}h.bindHeaderAction("#ghSortByGameId, #ghSortByGameIdImg",GH_SORT_BY_GAME_ID,!0),h.bindHeaderAction("#ghSortByWinTimeRank, #ghSortByWinTimeRankImg",GH_SORT_BY_WIN_TIME_RANK,!0),h.bindHeaderAction("#ghSortByBestAttemptRank, #ghSortByBestAttemptRankImg",GH_SORT_BY_BEST_ATTEMPT_RANK,!0),h.bindHeaderAction("#ghSortByDate, #ghSortByDateImg",GH_SORT_BY_DATE,!1)},this.addCommentEditor=function(a){if(-1==$("#ghCommentTd"+a.gameId).html().indexOf("textarea")){var b=1==a.fav?"checked":0;null!=d&&h.saveComment(d),d=a,$("#ghCommentTd"+a.gameId).empty().append("<div class='ghCommentEditArea'><textarea id='ghGameComment"+a.gameId+"' rows='10' style='width:98%'></textarea><br /><input type='checkbox' id='ghInFavorites"+a.gameId+"'"+b+"/>"+n.get("addToFavoritesCheckBoxLabel")+"<br /> <br /><div id='ghSaveCommentBtn"+a.gameId+"' class='button nonSelectable'>"+n.get("saveButtonLabel")+"</div><div id='ghDiscardCommentBtn"+a.gameId+"' class='button nonSelectable'>"+n.get("dismissButtonLabel")+"</div><div class='clear'></div></div>"),$("#ghGameComment"+a.gameId).focus().val("").val(a.comment),$("#ghSaveCommentBtn"+a.gameId).click(function(){h.saveComment(a)}),$("#ghDiscardCommentBtn"+a.gameId).click(function(){$("#ghCommentTd"+a.gameId).empty().append(h.generateFullComment(a)),d=null})}},this.generateFullComment=function(a){var b="";return 0!=a.peek&&(b+=" ["+n.get("pokeSolutionShortLabel")+"] "),b+=h.formatComment(a.comment)},this.formatComment=function(a){var b=a.replace(/\n/gi,"<br />");if(0==b.length)return"";for(var c=a.split(" "),d=0,e=0;e<c.length&&d+c[e].length<=22;)d+=c[e].length,e<c.length-1&&d++,e++;for(d=0;e<c.length&&d+c[e].length<=35;)d+=c[e].length,e<c.length-1&&d++,e++;if(e>0){for(var f=0;f<c.length;f++)c[f]=c[f].substr(0,27);return h.join(c,e)}return 0==e&&c.length>0?c[0].substr(0,25)+"...":void 0},this.join=function(a,b){for(var c="",d=0;d<Math.min(b,a.length);d++)""!=c&&(c+=" "),c+=a[d];return b<a.length&&(c+="..."),c},h.saveComment=function(a){var b=$("#ghGameComment"+a.gameId).val(),c=$("#ghInFavorites"+a.gameId).is(":checked")?1:0;e.getClientServer().sendRequest(GTW_SAVE_COMMENT,{gameId:a.gameId,comment:b,fav:c},function(a){}),h.gsUpdateRow(a,b,c),d=null},h.gsUpdateRow=function(a,b,c){a.comment=b,a.fav=c,a.fav?$("#ghFav"+a.gameId).show():$("#ghFav"+a.gameId).hide(),$("#ghCommentTd"+a.gameId).empty().append(h.generateFullComment(a))},this.bindAll=function(){$("#closeHistoryPanel").click(function(){f.hidePanel("historyPanel")}),isDef(h.options.bindCPButton)&&h.options.bindCPButton&&$("#bbHistory").click(function(){h.run()})},e=a,f=b,h.gc=e,h.ui=f,isDef(c)&&null!=c&&mergeObj(m,c),h.options=m,h.bindAll()}function BonusRenderer(a,b,c){var d,e,f=null,g=new I18n;g.setContext("bonus"),this.render=function(a){if($("#winBox").is(":visible")){if($("#bonusNotice").empty(),"fastest"==a.winBonus?$("#bonusNotice").append("<p>"+g.get("fastestBonus")+"</p>"):"first"==a.winBonus&&$("#bonusNotice").append("<p>"+g.get("firstBonus")+"</p>"),""!=a.winBonus){var b;b="first"!=a.winBonus&&a.oldGameInfo.avgWinTime>0?a.newUserRanks.winTime<a.oldGameInfo.avgWinTime?"<br/>("+g.get("lessThanAveragePrefix")+" "+formatGameTimeMS(a.oldGameInfo.avgWinTime-a.newUserRanks.winTime)+")":"<br/>("+g.get("greaterThanAveragePrefix")+" "+formatGameTimeMS(a.newUserRanks.winTime-a.oldGameInfo.avgWinTime)+")":"",$("#bonusNotice").append("<p>"+g.get("winTimeRankLabel")+": "+(0!=a.newUserRanks.wtRank?a.newUserRanks.wtRank+" / ":"")+formatGameTimeMS(a.newUserRanks.winTime)+b+"</p>")}if("first"!=a.winBonus&&"best_attempt"==a.attemptBonus&&$("#bonusNotice").append("<p style='margin-top: 15px;'>"+g.get("bestAttemptBonus")+"</p>"),"first"!=a.winBonus&&"better_attempt"==a.attemptBonus&&$("#bonusNotice").append("<p style='margin-top: 15px;'>"+g.get("betterAttemptBonus")+"</p>"),0!=a.newUserRanks.baRank&&""!=a.attemptBonus&&$("#bonusNotice").append("<p>"+g.get("bestAttemptRankLabel")+": "+a.newUserRanks.baRank+" / "+formatGameTimeMS(a.newUserRanks.bestAttemptTime)+"</p>"),""==a.winBonus&&""!=a.attemptBonus)if(a.oldBestAttemptRank<=a.newUserRanks.baRank)$("#bonusNotice").append("<p>"+g.get("bestAttemptRankNoChangeNotice")+"</p>");else{var c=g.get("rangeFromPrepositionAlpha");2==a.oldBestAttemptRank&&(c=g.get("rangeFromPrepositionBeta")),$("#bonusNotice").append(g.format("bestAttemptRankChangeNotice",a.oldBestAttemptRank,a.newUserRanks.baRank,c))}if(a.newRankBySolvedCount<a.oldRankBySolvedCount){var c=g.get("rangeFromPrepositionAlpha");2==a.oldRankBySolvedCount&&(c=g.get("rangeFromPrepositionBeta")),$("#bonusNotice").append(g.format("ratingRankChangeNotice",a.oldRankBySolvedCount,a.newRankBySolvedCount,c))}var d=($("#bonusNotice").height(),iDiv(345-$("#bonusNotice").height()-$("#winBox").height(),3)),e="undefined"!=typeof WINBOX_DELTA_MARGIN?WINBOX_DELTA_MARGIN:0;$("#winBox").animate({top:125+d+e},function(){$("#bonusNotice").css("top",125+d+$("#winBox").height()+d+e),$("#bonusNotice").fadeIn("fast")})}},this.bindAll=function(){},d=a,e=b,f=c,this.bindAll()}function trimMsg(a){return a=a.replace(/\n/gi," "),a.length>55?a.substr(0,50)+"...":a}function PlayerProfile(a,b){var c,d,e,f=this,g=0,h=!1,i=null,j=!1,k=new I18n;k.setContext("profile"),this.setUnreadMsgCount=function(a){g=a},this.getUnreadMsgCount=function(){return g},this.run=function(){c.getClientServer().isGuest()||($("#profilePanel").is(":visible")?d.hidePanel("profilePanel"):0==f.getUnreadMsgCount()?f.show():f.showInbox())},this.show=function(){f.setLoading(SHOW_MAIN_TAB),e.loadProfile(null,function(a,b){if($("#profilePIStatic").empty().append(PlayerProfile.renderProfilePI(b,!1)),$("#profilePIStaticLayout").show(),$("#profileEditBtn").show(),$("#profilePIEditable").hide(),j=!1,$("#profileSubTab").hide(),$("#profileSubTab").empty(),$("#profileMainTab").show(),h=!0,i=$("#profileLoadingIcon"),$("#profileLoadingIcon").hide(),a&&null!=b){$("#profileWhere").val(b.fromwhere),$("#profileLink").val(b.link),$("#profileMail").val(b.mail),$("#profileAbout").val(b.about),$("#profileBirthDay").val(b.birthDay),$("#profileBirthMonth").val(b.birthMonth),$("#profileBirthYear").val(b.birthYear),null!=b.photoThumb?($("#profilePhotoFrame").css("border","none"),$("#profilePhotoFrame").empty().append("<img class='profilePhoto'src='"+b.photoThumb+"'/>")):($("#profilePhotoFrame").css("border","1px solid #CCC"),$("#profilePhotoFrame").empty().append("<img class='profilePhoto'src='/images/nophoto-"+I18n.get("locale")+".png'/>")),$("#profileSideActivity").empty();var c;$("#profileSideActivity").append(c)}else $("#profileWhere").val(""),$("#profileLink").val(""),$("#profileMail").val(""),$("#profileAbout").val(""),$("#profileBirthDay").val(0),$("#profileBirthMonth").val(0),$("#profileBirthYear").val(0),$("#profilePhotoFrame").css("border","1px solid #CCC"),$("#profilePhotoFrame").empty().append("<img class='profilePhotoFrame'src='/images/nophoto-"+I18n.get("locale")+".png'/>"),$("#profileSideActivity").empty();$("#profileGoInvisible").attr("checked",!!b.isInvisible),$("#profileLoading").hide(),b.unreadMsgCount>0&&f.updateUnreadMsgCount(b.unreadMsgCount),$("#profileContents").show(),$("html, body").scrollTop($("#profilePanel").offset().top)})},this.save=function(){return $("#profileMail").val($.trim($("#profileMail").val())),""!=!$("#profileMail").val()||validateMail($("#profileMail").val())?($("#profileLoadingImg").show(),void e.updateProfile(function(a,b){$("#profileLoadingImg").hide(),a&&(j||null==b.thumbFilename||($("#profilePhotoFrame").css("border","none"),$("#profilePhotoFrame").empty().append("<img class='profilePhoto'src='"+b.thumbFilename+"'/>")),$("#profilePhotoField").val(""),isDef(b.profile)&&$("#profilePIStatic").empty().append(PlayerProfile.renderProfilePI(b.profile,!1)),$("#profilePIEditable").hide(),$("#profilePIStaticLayout").show(),$("#profileEditBtn").show())})):void alert("Адрес почты не содержит точку или @")},this.setLoading=function(){$("#profilePanel").is(":visible")?null!=i&&i.show():($("#profileUsername").empty().append(e.getUsername()),$("#profileLoading").show(),$("#profileContents").hide(),$("#profileUnreadMsgAlert").hide(),d.showPanel({id:"profilePanel"}),$("html, body").scrollTop($("#profilePanel").offset().top))},this.showInbox=function(){f.setLoading(SHOW_SUBTAB),e.loadConversations(function(a,b){var c="<div class='pmCP'>";if(c+="<h4 class='pmShowInbox nonSelectable' id='pmShowInbox'>"+k.get("inboxHeader")+"</h4>",c+="<h4 class='pmShowOutbox activeOption nonSelectable' id='pmSendMsg'>"+k.get("sendMsgMenuAction")+"</h4>",c+="</div>",c+="<img src='/img/icons/loading.gif' class='profileLoadingIcon' id='pmInboxLoadingIcon' />",c+="<div class='clear'></div>",0==b.length)c+="<p style='padding-left: 10px;'>"+k.get("noDialogsAlert")+"</p>";else{c+="<table class='standartTable' width='100%' style='margin-top: 12px;'>",c+="<tr><th width='10%'>"+k.get("opponentLabel")+"</th><th>"+k.get("msgTextLabel")+"</th><th width='10%'>"+k.get("sentDateTimeLabel")+"</th></tr>";for(var d in b){var g=b[d],h=g.hasNewMessages?"font-weight: bold;":"",j=g.ownMessage?" ownMessage":"";c+="<tr id='conversation"+g.opponent+"' style='"+h+"'><td style='text-align: center;' class='pmSenderNameTd'><p class='pmSenderName'>"+g.opponentName+"</p></td><td><p class='msgShort"+j+"'>"+trimMsg(g.msg)+"</p></td><td style='text-align: center; white-space: nowrap;'>"+formatTime(g.timestamp,{putTimeInBrackets:!0})+"</td></tr>"}c+="</table>"}var l=new BottomSubPanel;if(l.fillContents(c),l.onClose(function(){f.show()}),l.renderContents("profileSubTab"),$("#profileMainTab").hide(),$("html, body").scrollTop($("#profilePanel").offset().top-iDiv($("#gameArea").width(),3)),i=$("#pmInboxLoadingIcon"),$("#pmSendMsg").click(function(){f.showSendMsg()}),b.length>0)for(var d in b){var m=b[d];$("#conversation"+m.opponent).click(function(a){return function(){f.setLoading(SHOW_SUBTAB),e.loadConversation(a.opponent,function(b,c){f.updateUnreadMsgCount(c.unreadMsgCount),f.renderConversation(a.opponent,a.opponentName,c.conversation,function(){f.showInbox()})})}}(m))}})},this.openAdminDialog=function(){e.loadConversation(-1,function(a,b){f.updateUnreadMsgCount(b.unreadMsgCount),f.renderConversation(-1,"Админ",b.conversation,function(){f.showInbox()},!0)})},this.renderConversation=function(a,b,c,d,f){var g;g="<table class='pmDlgLayout'>";for(var h=c.length-1;h>=0;h--){var j=c[h];g+="<tr><td><p class='pmDlgSender'>"+j.senderName+"</p><p class='pmDlgText'>"+j.msg.replace(/\n/gi,"<br />")+"</p></td><td class='pmDlgSendDate'>"+formatDate(j.sentTS)+"</td></tr>"}g+="</table>";var l=new BottomSubPanel,m="<h4 style='float: left;'>"+k.get("conversationWithPrefix")+" "+b+"</h4>";m+="<img src='/img/icons/loading.gif' class='profileLoadingIcon' id='pmMsgLoadingIcon' />",m+="<div class='clear'></div>",m+="<div class='msgText' id='msgText'><div class='msgPadding'>"+g+"</div></div>",m+="<div class='clear'></div>",m+="<div class='pdSendMsgPanel' id='replyToPanel'><div class='pdSendMsgPanelPadding'><h4>"+k.get("msgRecipientPrefix")+" &laquo;"+b+"&raquo;</h4><textarea id='replyText' style='width: 100%'></textarea><div class='constantWidthBtn nonSelectable pdSendMsgBtn' id='sendReplyBtn'>"+k.get("sendReplyButtonLabel")+"</div><div class='clear'></div></div></div>",l.fillContents(m),l.onClose(d),l.renderContents("profileSubTab"),$("#profileMainTab").hide(),i=$("#pmMsgLoadingIcon"),$("html, body").scrollTop($("#profileSubTab").offset().top+$("#profileSubTab").height()),$("#replyToBtn").click(function(){$("#replyToBtn").hide(),$("#replyToPanel").show(),$("html, body").scrollTop($("#replyToPanel").offset().top),$("#replyText").focus()}),$("#sendReplyBtn").click(function(){var b=$("#replyText").val();b.length>0?e.sendMessage(a,b,0,0,function(){d()}):alert(k.get("emptyMsgAlert"))}),f&&($("#replyToBtn").hide(),$("#replyToPanel").show(),$("html, body").scrollTop($("#replyToPanel").offset().top),$("#replyText").focus())},this.showSendMsg=function(){f.setLoading(SHOW_SUBTAB);var a=new BottomSubPanel,b="<h4 style='float: left;'>"+k.get("sendPMHeader")+"</h4>";b+="<img src='/img/icons/loading.gif' class='profileLoadingIcon' id='pmSubPanelLoadingIcon' />",b+="<div class='clear'></div>",b+="<div style='margin-right: 4px;'>",b+="<textarea id='msgText' style='width: 100%; margin-top: 10px;'></textarea>",b+="</div>",b+="<div class='constantWidthBtn nonSelectable profileActionBtn' id='chooseRecipientsBtn'>"+k.get("selectRecipientsButtonLabel")+"</div>",b+="<div style='border: 1px dashed #CCC' id='pmRecipientList'></div>",b+="<div class='constantWidthBtn nonSelectable profileActionBtn' id='pmSendMsgBtn'>"+k.get("sendMsgButtonLabel")+"</div>",b+="<div class='clear'></div>",a.fillContents(b),a.onClose(function(){f.showInbox()}),a.renderContents("profileSubTab"),$("#profileMainTab").hide(),i=$("#pmSubPanelLoadingIcon"),$("#chooseRecipientsBtn").click(function(){$("#pmSubPanelLoadingIcon").show(),e.loadRecipients(function(a,b){if(a){$("#pmSubPanelLoadingIcon").hide(),$("#chooseRecipientsBtn").hide();for(var c in b){var d=b[c];$("#pmRecipientList").append("<div style='width: 25%; display: inline-block;'><input class='pmRcpCheckBox' type='checkbox' value='"+d.playerId+"'>"+d.username+"</div>")}$("#pmRecipientList").show(),$("#pmSendMsgBtn").show(),$("html, body").scrollTop($("#pmRecipientList").offset().top)}})}),$("#pmSendMsgBtn").click(function(){var a=[];$(".pmRcpCheckBox").each(function(){this.checked&&a.push(parseInt(this.value))});var b=$("#msgText").val();0==$.trim(b).length?alert(k.get("emptyMsgAlert")):0==a.length?alert(k.get("noRecipientAlert")):($("#pmSubPanelLoadingIcon").show(),e.sendMassMsg(b,a,function(){f.showInbox()}))})},this.bindAll=function(){$("#bbProfile").click(function(){f.run()}),$("#profileLogoutBtn").click(function(){setCookie("vk_app_3960668"," ",new Date(0),"/",".logic-games.spb.ru"),c.logout()}),$("#profileCloseImg").click(function(){d.hidePanel("profilePanel")}),$("#profileEditBtn").click(function(){$("#profilePIStaticLayout").hide(),$("#profilePIEditable").show()}),$("#profilePhotoField").change(function(){f.preuploadPhoto()}),$("#profileSaveBtn").click(function(){f.save()}),$("#profileDiscardChangesBtn").click(function(){f.show()}),$("#profileReadMsgBtn, #profileGoToInbox").click(function(){f.showInbox()}),$("#sendToAdmin").click(function(){f.openAdminDialog()}),$("#changePassword").click(function(){$("#cpOldPassword").val(""),$("#cpNewPassword1").val(""),$("#cpNewPassword2").val(""),d.showPanel({id:"changePassPanel",type:OVER_FIELD_PANEL})}),$("#cpCancel, #cpCloseIcon").click(function(){f.run()}),$("#cpCommit").click(function(){f.changePassword()}),$("#profileGoInvisible").click(function(){var a=$("#profileGoInvisible").is(":checked");$("#profileGoInvisible").attr("disabled","disabled"),$("#profileGoInvisibleLoadingImg").show(),e.updateUserSettings({isInvisible:a},function(){$("#profileGoInvisible").removeAttr("disabled"),$("#profileGoInvisibleLoadingImg").hide()})}),$("#shareBtn").click(function(){"block"==$(".share42init").css("display")?$(".share42init").hide():$(".share42init").show()
})},this.preuploadPhoto=function(){$("#profileLoadingImg").show(),e.preuploadPhoto(function(a,b){$("#profileLoadingImg").hide(),a&&($("#profilePhotoFrame").css("border","none"),$("#profilePhotoFrame").empty().append("<img class='profilePhoto'src='"+b.thumbFilename+"'/>"),j=!0)})},this.bindActions=function(a){$("#sendMsg"+a.playerId).click(function(){$("#pdSendMsgResult"+a.playerId).hide(),$("#pdSendMsgPanel"+a.playerId).toggle("fast")}),$("#pdSendMsgBtn"+a.playerId).click(function(){var b=$("#pdMsg"+a.playerId).val();if(""!=b){var c=e.isSuperUser()&&$("#pdFromAdmin").is(":checked")?1:0;e.sendMessage(a.playerId,b,0,c,function(b){$("#pdSendMsgResult"+a.playerId).empty().append(k.get("msgSentSuccessfullyAlert")),$("#pdSendMsgResult"+a.playerId).show(),$("#pdSendMsgResult"+a.playerId).delay(2e3).fadeOut(),$("#pdSendMsgPanel"+a.playerId).hide(),$("#pdMsg"+a.playerId).val(""),$("#sendMsg"+a.playerId).show()})}$("#pdMsg"+a.playerId).val("")})},this.updateUnreadMsgCount=function(a){f.setUnreadMsgCount(a),e.isLogged()&&a>0?($("#bbProfileLabel").hide(),$("#bbUnreadMsgCount").empty().append(k.get("newMessagesLabel")+": "+a),$("#profileReadMsgBtn").empty().append(k.get("newMessagesLabel")+": "+a),$("#profileGoToInbox").hide(),$("#profileUnreadMsgAlert").show(),a>=10?$("#bbUnreadMsgCount").css("font-size","7pt"):$("#bbUnreadMsgCount").css("font-size","8pt")):($("#profileGoToInbox").show(),$("#bbProfileLabel").show(),$("#bbUnreadMsgCount").empty(),$("#profileUnreadMsgAlert").hide())},this.renderProfile=function(a){return PlayerProfile.renderProfile(a,c.getClientServer().isGuest())},this.changePassword=function(){var a=c.getClientServer(),b=$.trim($("#cpOldPassword").val()),d=$.trim($("#cpNewPassword1").val()),e=$.trim($("#cpNewPassword2").val()),g=null;return b&&d&&e?(d==b&&(g="Старый и новый пароль совпадают!"),d.length>0&&d.length<5?g="Минимальная длина 5 символов.":d.length>25?g="Максимальная длина 25 символов.":d!=e&&(g="Введённые пароли не совпадают")):g="Заполните все поля",g?($("#cpResult").show(),$("#cpResult").empty().append("<div class='lrRedAlert'>"+g+"</div>"),void $("#cpResult").delay(2e3).fadeOut("fast")):void a.sendRequest(CNP_GATEWAY,{old:b,"new":d},function(a,b){"ok"==b.result?(alert("Пароль успешно изменен"),f.run()):($("#cpResult").show(),$("#cpResult").empty().append("<div class='lrRedAlert'>"+b.result+"</div>"),$("#cpResult").delay(2e3).fadeOut("fast"))})},c=a,d=b,e=c.getClientServer(),f.cs=e,PlayerProfile.BOUND||(f.bindAll(),PlayerProfile.BOUND=!0)}function filterField(a){return""==a?"<span class='profileAbsentField'>"+I18n.contextGet("profile","emptyFieldStub")+"</span>":a}function filterLink(a,b){if(""==a)return filterField(b);if(a.length>32)var c=a.substr(0,32)+"...";else c=a;return"<a href='"+a+"' target=_blank>"+c+"</a>"}function validateMail(a){var b=/\S+@\S+\.\S+/;return a&&a.length>3&&b.test(a)}function RatingsRenderer(a,b,c){var d,e,f,g=this,h="#ratingsContents",j={showLabels:!1,showBestAttemptCount:!1,canFilter:!1,filterLabel:"",noFilterLabel:"",showTimeRatings:!1},k=RL_SHOW_ALL_RATINGS,l=RL_SORT_BY_SOLVED_COUNT,m=ASC,n="";g.activeSubFilter=null,g.timeFilter=null,g.activeSegmentFilter=0;var o=new I18n;o.setContext("rating"),this.resetSettings=function(){k=RL_SHOW_ALL_RATINGS,l=RL_SORT_BY_SOLVED_COUNT,m=ASC,n="",g.activeSegmentFilter=0,g.activeSubFilter=null,g.timeFilter=null},this.run=function(){$("#ratingsPanel").is(":visible")?e.hidePanel("ratingsPanel"):(g.resetSettings(),f=d.getClientServer(),g.loader=new Loader(0,RL_DEFAULT_LOAD_COUNT),g.loader.addListener(g),e.setLoading("#ratingsContents"),this.loadAndRender(!1),e.showPanel({id:"ratingsPanel",contentsId:h,type:BOTTOM_PANEL}))},this.countChanged=function(){g.loadAndRender(!0,!1)},this.loadAndRender=function(a,b){a&&$("#rlLoadingImg").show(),b=ifDef(b,!0),b&&g.loader.reset(),(g.timeFilter||k!=RL_SHOW_ALL_RATINGS)&&(g.activeSegmentFilter=0),f.sendRequest(GTW_RATINGS,{sortBy:l,order:bool2Int(m),filter:k,usernamePrefixFilter:n,count:g.loader.count,subFilter:g.activeSubFilter?g.activeSubFilter.value:0,timeFilter:g.timeFilter?g.timeFilter.year+"-"+g.timeFilter.month:0,segmentFilter:g.activeSegmentFilter},function(b,c,d){$("#rlLoadingImg").hide(),b?(g.render(c),a||$("html, body").animate({scrollTop:$("#ratingsPanel").offset().top-iDiv($("#gameArea").width(),3)},"normal")):g.ui.renderErrorReason(h,d.reason)})},this.bindHeaderAction=function(a,b,c,d){d=ifDef(d,!1),$(a).click(function(){l!=b||d?(l=b,m=c):m=!m,g.loadAndRender(!0)})},this.generateHeader=function(a,b,c,d){return"<span"+(l==c?" class='activeSortHeader actionText3'":" class='actionText3'")+" id='"+a+"'>"+b+(d&&l==c?e.getOrderHint(m):"")+"</span>"},this.generateSortImg=function(a,b){return l==b?e.serverSortArrowsImg(m,"",a):" &nbsp;<img src='/img/icons/sort-both.png' id='"+a+"' alt=''/>"},this.applyTimeFilter=function(a,b){g.timeFilter={year:a,month:b},g.loadAndRender(!0)},this.applySubFilter=function(a){g.activeSubFilter=a,g.loadAndRender(!0)},this.renderSubFilters=function(a){if(a){var b="";for(i in a){var c=a[i],d=g.activeSubFilter&&c.id==g.activeSubFilter.id?"disabledText":"actionText2";b+="<span class='"+d+"' id='"+c.id+"'>"+c.name+"</span>&nbsp;&nbsp;&nbsp;&nbsp;"}return b}return""},g.locateActiveSubFilter=function(a,b){for(i in a)a[i].id==b&&(g.activeSubFilter=a[i])},this.setSort=function(a,b){l=a,m=b},this.renderFilter=function(a){$("#rlFilterSection").empty();var b="<option value='nofilter'>"+g.options.noFilterLabel+"</option>";for(var c in a){var d=a[c];b+="<option value='"+d.val+"'>"+d.text+"</option>"}$("#rlFilterSection").append("<table style='margin-bottom: 5px;'><tr><td style='vertical-align: middle !important;'><span style='color: #777;'>"+g.options.filterLabel+": </span></td><td>&nbsp;&nbsp;</td><td><select style='width: 220px' id='rlFilter'>"+b+"</select></td></tr></table>"),g.activeSegmentFilter&&$("#rlFilter").val(g.activeSegmentFilter),$("#rlFilter").change(function(){g.onFilterChange()}),$("#rlFilter").chosen({disable_search:!0})},this.onFilterChange=function(){var a=$("#rlFilter option:selected").val();g.activeSegmentFilter="nofilter"==a?0:a,g.loadAndRender(!0)},this.render=function(a){if(g.loader.setTotal(a.total),g.locateActiveSubFilter(a.subFilters,a.activeSubFilterId),g.options.canFilter&&!g.timeFilter&&k==RL_SHOW_ALL_RATINGS){var b=a.filterData;g.renderFilter(b)}else $("#rlFilterSection").empty();var c=a.ratings;e.hideHint();var d=null==g.timeFilter&&0==g.activeSegmentFilter,h=new TableDataRenderer(l,m,{thClass:"rlHeader"});h.addColumn({title:o.get("placeLabel"),hint:o.get("sortByPlaceHint"),headerId:"rlSortByPlace",enableSort:!0,sortBy:RL_SORT_BY_SOLVED_COUNT,defaultOrder:!0,onlyDefaultOrder:!0,showOrderHint:!1,hasRightBorder:!1}),h.addColumn({title:o.get("usernameLabel"),enableSort:!1,hasRightBorder:!1,colspan:2,customSortImgTdFunc:function(){return"<td class='noRightBorder rlArrows' colspan='2' style='text-align: left !important;'><table width='100%' class='noBordersTable' style='border-collapse: collapse;' cellpadding='0' cellspacing='0'><tr><td style='padding-left: 0; padding-right: 10px; color: #777;'>"+o.get("searchByUsernameLabel")+": </td><td width='50%' style='padding: 0 0 0 0;'><input id='rlUsernameFilter' style='width:100% !important; min-width: 75px; display: inline;' value='"+n+"'/></td><td width='50%' id='rlClearUsernamePrefixFilterTd'><img src='/img/icons/cross_12_12_a64.png' style='padding-left: 10px;' alt='' /></td><td width='50%' id='rlFilterUsernamePrefixTd'><img src='/img/icons/accept_12_12_a64.png' style='padding-left: 10px;' alt='' /></td></tr></table></td>"}}),h.addColumn({title:o.get("regDateLabel"),hint:o.get("sortByDateHint"),headerId:"rlSortByRegDate",enableSort:!0,sortBy:RL_SORT_BY_REG_DATE,defaultOrder:!1,onlyDefaultOrder:!1,showOrderHint:!0,hasRightBorder:!1}),h.addColumn({title:o.get("solvedCountLabel"),enableSort:!1,hasRightBorder:!1,insertSeparatorAfter:!0}),h.addColumn({title:o.get("playedCountLabel"),enableSort:!1,hasRightBorder:!1}),h.addColumn({title:"%",hint:o.get("sortBySolvedRatio"),headerId:"rlSortBySolvedRatio",enableSort:!0,sortBy:RL_SORT_BY_SOLVED_RATIO,defaultOrder:!1,onlyDefaultOrder:!1,showOrderHint:!0,hasRightBorder:!0}),d&&(h.addColumn({title:o.get(g.options.showBestAttemptCount?"bestWinTimeCountLabel":"bestWinTimeCountShortLabel"),headerId:"rlSortByWinTimeRank",sortBy:RL_SORT_BY_BEST_COUNT,enableSort:!0,defaultOrder:!1,showOrderHint:!0,hasRightBorder:!0}),f.isSuperUser()&&!g.activeSegmentFilter&&(h.addColumn({title:o.get("totalGameTimeShortLabel"),headerId:"rlSortByTotalGameTime",enableSort:!0,sortBy:RL_SORT_BY_TOTAL_GAME_TIME,defaultOrder:!1,showOrderHint:!0,hasRightBorder:!1}),h.addColumn({title:o.get("averageWinTimeShortLabel"),headerId:"rlSortByAverageWinTime",enableSort:!0,sortBy:RL_SORT_BY_AVERAGE_WIN_TIME,defaultOrder:!0,showOrderHint:!0,hasRightBorder:!1}),h.addColumn({title:o.get("totalGameRatingShortLabel"),headerId:"rlSortByTotalGameRating",enableSort:!0,sortBy:RL_SORT_BY_TOTAL_GAME_RATING,defaultOrder:!1,showOrderHint:!0,hasRightBorder:!0})));var i="<table class='standartTable' style='clear:both; border-collapse: collapse;'  width='100%' border='0' vspace='0' cellspacing='0' hspace='0'><tr>"+h.renderTableHeader()+"</tr>";i+="<tr class='rlArrowsRow'>"+h.renderTableSortTrContents()+"</tr>";for(var j=-1,p="",q=null,r=null,s="",t=0;t<c.length;t++){var u=c[t];if((k!=RL_SHOW_ALL_RATINGS||!u.isGuest)&&(k!=RL_SHOW_ONLINE_RATINGS||u.isOnline&&(!u.isGuest||f.isSuperUser()))&&(k!=RL_SHOW_GUEST_RATINGS||u.isGuest&&f.isSuperUser())){var v=u.playerId==f.getUserId(),w=g.rlGenerateTableData(u,!1,d),x=OFFLINE_COLOR;u.isOnline&&(x=ONLINE_COLOR),u.isOnline&&!u.isActive&&(x=INACTIVE_COLOR),v&&(x=ONLINE_COLOR);var y="background-color: "+x+";";v&&(y+=" font-weight:bold;",j=u.place,t>=SHOW_DUP_USER_ROW_AFTER&&(s="background-color: #F7F7F7;",q=u)),p+="<tr style='"+y+";' id='rlRow"+t+"'>"+w+"</tr>"}}if(null!=a.userRatingRow){var r=g.rlGenerateTableData(a.userRatingRow,!0,d);i+="<tr style='"+s+" border-bottom:2px solid #AAA; height: 30px;'>"+r+"</tr>"+p+"</table>"}else i+=p+"</table>";$("#ratingsContents").empty();var z="";if(f.isSuperUser()&&(z=renderMenu([{id:"showCommonRating",text:"все игроки",isActive:k==RL_SHOW_COMMON_RATING},{id:"showAllRatings",text:"зарег.",isActive:k==RL_SHOW_ALL_RATINGS},{id:"showGuestRatings",text:"гости",isActive:k==RL_SHOW_GUEST_RATINGS},{id:"showOnlineRatings",text:"сейчас на сайте",isActive:k==RL_SHOW_ONLINE_RATINGS}])+"&nbsp;&nbsp;&nbsp;&nbsp;<a style='color: #006699;' target='_blank' href='/admin/'>Админка</a>&nbsp;&nbsp;&nbsp;&nbsp;<a style='color: #006699;' target='_blank' href='/kosynka/_stats/_profiles.php'>профили</a>&nbsp;&nbsp;&nbsp;&nbsp;<a style='color: #006699;' target='_blank' href='https://docs.google.com/spreadsheet/ccc?key=0AqEgIQ1K8gzAdHB2dEJGRUlJb2xya2JCdUM2WFZwd0E#gid=5'>план р-ты</a><br /><br />"),g.options.showTimeRatings||f.isSuperUser())var A="";else A="";var B="",C=g.renderSubFilters(a.subFilters);if(f.isSuperUser()&&(B="&nbsp;&nbsp;&nbsp;&nbsp;<span class="+(k!=RL_SHOW_ONLINE_RATINGS?"'actionText2'":"'disabledText'")+" id='showOnlineRatings'>сейчас на сайте</span>"),$("#ratingsContents").append(f.isSuperUser()?"<p style='margin-top:3px; margin-bottom:10px; margin-left: 1px; float: left;'>"+z+A+C+"<img src='/img/icons/loading.gif' id='rlLoadingImg' /></p>":"<p style='margin-top:3px; margin-bottom:10px; margin-left: 1px; float: left;'>"+A+C+"&nbsp;<img src='/img/icons/loading.gif' id='rlLoadingImg' /></p>"),$("#showAllRatings").click(function(){k=RL_SHOW_ALL_RATINGS,g.loadAndRender(!0)}),$("#showOnlineRatings").click(function(){k=RL_SHOW_ONLINE_RATINGS,g.loadAndRender(!0)}),$("#showGuestRatings").click(function(){k=RL_SHOW_GUEST_RATINGS,g.loadAndRender(!0)}),$("#showCommonRating").click(function(){k=RL_SHOW_COMMON_RATING,g.loadAndRender(!0)}),$("#ratingsContents").append(i),f.isSuperUser()&&k==RL_SHOW_ALL_RATINGS&&""==n&&!g.timeFilter&&!g.activeSegmentFilter){var D=new LoaderRenderer(g.loader,"players");$("#ratingsContents").append(D.render()),D.bindEvents()}if(""==n?($("#rlClearUsernamePrefixFilterTd").hide(),$("#rlFilterUsernamePrefixTd").show()):($("#rlFilterUsernamePrefixTd").hide(),$("#rlClearUsernamePrefixFilterTd").show()),$("#rlFilterUsernamePrefixTd").click(function(){n=$("#rlUsernameFilter").val(),g.loadAndRender(!0)}),$("#rlClearUsernamePrefixFilterTd").click(function(){n="",g.loadAndRender(!0)}),f.isLogged()||($("#ratingsContents").append("<p class='ratingsRegPrompt'>"+o.get("regForRatingAlert")+"</p>"),$("#rlReg").click(function(){e.showRegPanel()})),c.length>SHOW_SHORTCUTS_AFTER){var E="<div style='padding-top: 10px; background-color: white;'>";E+="<div class='bspAuxBtn' style='float: left;' id='ratingsScroll'>["+o.get("auxScrollTop")+"]</div>",E+="<div class='bspAuxBtn' style='float: right;' id='ratingsClose'>["+o.get("auxClose")+"]</div>",E+="<div class='clear'></div>",E+="</div>",$("#ratingsContents").append(E),$("#ratingsScroll").click(function(){$("html, body").animate({scrollTop:$("#ratingsPanel").offset().top-iDiv($("#gameArea").width(),3)})}),$("#ratingsClose").click(function(){e.hidePanel("ratingsPanel")})}for(var F=0;F<c.length;F++){var G=c[F].playerId,H=o.transliterate(c[F].username);(k!=RL_SHOW_ONLINE_RATINGS||u.isOnline)&&($("#rlShowPlayerDetail"+G).click(function(a,b){return function(){g.fillPlayerDetail(a,b,!1)}}(G,H)),G==f.getUserId()&&$("#rlShowPlayerDetail"+G+"u").click(function(a,b){return function(){g.fillPlayerDetail(a,b,!0)}}(G,H)))}if(a.subFilters)for(F in a.subFilters){var I=a.subFilters[F];$("#"+I.id).click(function(a){return function(){g.applySubFilter(a)}}(I))}(g.options.showTimeRatings||f.isSuperUser())&&($("#rlAbsolute").click(function(){g.timeFilter=null,g.loadAndRender(!0)}),$("#rlPast2012").click(function(){g.applyTimeFilter(2012,0)}),$("#rlPast2013").click(function(){g.applyTimeFilter(2013,0)}),$("#rl2013_1").click(function(){g.applyTimeFilter(2013,1)}),$("#rl2013_2").click(function(){g.applyTimeFilter(2013,2)}),$("#rl2013_3").click(function(){g.applyTimeFilter(2013,3)}),$("#rl2013_4").click(function(){g.applyTimeFilter(2013,4)})),h.bindHeaderActions(g),$("#rlUsernameFilter").autocomplete({source:function(a,b){f.sendRequest(GTW_USERNAME_FILTER,{usernamePrefix:a.term,subFilter:g.activeSubFilter?g.activeSubFilter.value:null},function(a,c){b(c)})},minLength:1,select:function(a,b){n=b.item?b.item.value:this.value,g.loadAndRender(!0)}}),$("#rlUsernameFilter").keydown(function(a){a.which==KEY_ENTER?(n=e.item?e.item.value:this.value,g.loadAndRender(!0),a.preventDefault()):a.which==KEY_ESC?(n="",g.loadAndRender(!0),a.preventDefault()):($("#rlClearUsernamePrefixFilterTd").hide(),$("#rlFilterUsernamePrefixTd").show())})},this.rlGenerateTableData=function(a,b,c){var b=isDef(b)?b:!1,d=b?"u":"";a.username=o.transliterate(a.username);var e=Math.abs(a.appearanceTS-nowTS())<=86400,h="";f.isSuperUser()&&!g.activeSegmentFilter&&(h="<td nowrap='true' style='color: #AAA; vertical-align: top !important; text-align: right;' class='noRightBorder'><span>"+suFormatTotalGameTime(a.totalGameTime)+"</span><sup>&nbsp;</sup></td><td nowrap='true' style='color: #AAA; vertical-align: top !important; text-align: right;' class='noRightBorder'><span>"+(a.averageWinTime?formatGameTimeMS(a.averageWinTime):"—")+"</span><sup>&nbsp;</sup></td><td nowrap='true' style='color: #AAA; vertical-align: top !important; text-align: right;'><span>"+suFormatTotalGameTime(a.totalGameRating)+"</span><sup>&nbsp;</sup></td>");var i="<sup>&nbsp;</sup>";if(g.timeFilter&&g.timeFilter.year&&!g.timeFilter.month)var j=" "+g.timeFilter.year+" "+o.get("yearChampionMarkAppx");else j=g.timeFilter&&g.timeFilter.year&&g.timeFilter.month?" "+o.getMonthBeta(g.timeFilter.month):"";if(0!=g.activeSegmentFilter&&(j=" "+o.get("segmentChampionMarkAppx")),g.timeFilter||0!=g.activeSegmentFilter)k="";else var k=o.get("absoluteChampionMarkPrefix")+" ";if(!a.isGuest)if(1==a.place)var i="<sup style='color: #C42E21;'> "+k+o.get("championMark")+j+"</sup>";else(a.wasChampion&&a.place>1||a.championship)&&(i="<sup style='color: #C42E21;'> "+o.get("exChampionMark")+"</sup>",a.championship&&(i="<sup style='color: #C42E21;'> "+a.championship+"</sup>"));var l=a.place+".";if(0==a.place&&(l=""),f.isSuperUser(),b)var m=0!=a.place?" ("+a.place+" "+o.get("placeSuffix")+")":"",n="<td class='noRightBorder' style='white-space: nowrap; vertical-align: top !important; text-align: right;'><span><b> </b></span><sup>&nbsp;</sup></td><td colspan='2' class='noRightBorder' style='white-space: nowrap; vertical-align: top !important;'><span><b>"+o.get("userRowPrefix")+":</b></span><sup>&nbsp;</sup><span>"+formatUsername(a.username)+m+"</span><sup>&nbsp;</sup></td>";else var n="<td class='noRightBorder' style='white-space: nowrap; vertical-align: top !important; text-align: right;'><span>"+l+"</span><sup>&nbsp;</sup></td><td class='noRightBorder' style='white-space: nowrap; vertical-align: top !important;' width='30%'><span class='activeText' id='rlShowPlayerDetail"+a.playerId+d+"'>"+formatUsername(a.username)+"</span>"+i+"</td><td class='noRightBorder' style='width: 1%; padding-right: 10px; vertical-align: middle !important;'>"+(null!=a.photo?"<a href='"+a.photo+"' rel='lightbox'><img src='/img/icons/camera.png' alt=''/></a>":"")+"</td>";var p=n+"<td style='color: #AAA; vertical-align: top !important; text-align: center;' class='noRightBorder'>"+(e?"<span style='color: #C42E21 !important;'>"+o.get("noviceMark")+"</span>":"<span>"+formatDate(a.appearanceTS)+"</span>")+"<sup>&nbsp;</sup></td><td style='vertical-align: top !important;' class='noRightBorder'><p><span id='rlShowSolved"+a.playerId+d+"'>"+a.solvedCount+"</span><sup class='greenSup'>"+(a.todayWonTotal>0?"+"+a.todayWonTotal:"&nbsp;")+"</sup></p></td><td style='vertical-align: top !important;' class='noRightBorder'><span>/</span><sup>&nbsp;</sup></td><td style='vertical-align: top !important;' class='noRightBorder'><p><span id='rlShowPlayed"+a.playerId+d+"'>"+a.playedCount+"</span><sup class='greenSup'>"+(a.todayPlayedTotal>0?"+"+a.todayPlayedTotal:"&nbsp;")+"</sup></p></td><td style='vertical-align: top !important; text-align: center;'><p class='rlWonPercentage'>"+calcPercent(a.solvedCount,a.playedCount)+"<sup>&nbsp;</sup></p></td>"+(c?"<td style='vertical-align: top !important; text-align: center;' width='25%'><p>"+(a.isGuest||!a.firstPlacesByRank2?"—":a.firstPlacesByRank2)+"<sup>&nbsp;</sup></p></td>"+h:"");return p},this.fillPlayerDetail=function(a,b,c){var c=isDef(c)?c:!1;$("#rlLoadingImg").show(),f.sendRequest(GTW_PLAYER_DETAIL,{playerId:a,subFilter:g.activeSubFilter?g.activeSubFilter.value:null},function(c,h){var i=h.playerDetail,j=h.totalGameTime,k=h.averageWinTime,l=h.profile,m=a==f.getUserId();$("#rlLoadingImg").hide();var n="<h4 style='padding-left: 5px; text-align: center;'>"+b+"</h4>";n+=PlayerProfile.renderProfile(l,f.isGuest());for(var p="<table width='93%' class='noBordersTable' style='margin-bottom: 10px; margin-left: 10px;' cellpadding='0' cellspacing='0'>",q="<table width='93%' class='noBordersTable' style='margin-bottom: 10px; margin-left: 10px;' cellpadding='0' cellspacing='0'>",r=0,s=0,t=0;t<i.length;t++){var u=i[t].gameId,v=i[t],w="";if(v.playerWinTime>0){var w=" class='pdRow rowWon'",x=formatGameTimeMS(v.playerWinTime);r+=v.playerWinTime,s++}else w=" class='pdRow rowPlayed'",x="<span class='pdTotalGameTime'>"+formatGameTimeMS(v.playerTotalGameTime)+"</span>";if(p+="<tr"+w+"><td style='float: right;'><span class='actionText' id='pdPlayGame"+u+"B'>"+u+"</span></td>"+(g.options.showLabels?"<td style='color: #777;'>/</td><td style='white-space: nowrap; color: #777;'>"+v.label+"</td>":"")+"<td>/</td><td class='gameTime'>"+x+"</td><td width='99%' style='text-align: right !important; padding-right: 20px;'>"+formatDate(i[t].time)+"</td></tr><tr class='pdSpacingRow'><td colspan='4'></td></tr>",v.userWinTime>0)var y=" class='pdRow rowWon'",z=formatGameTimeMS(v.userWinTime);else v.userTotalGameTime>0?(y=" class='pdRow rowPlayed'",z="<span class='pdTotalGameTime'>"+formatGameTimeMS(v.userTotalGameTime)+"</span>"):y=" class='pdRow rowUnplayed'";q+=v.userTotalGameTime>0?"<tr"+y+"><td style='float: right;'><span class='actionText' id='pdPlayGame"+u+"'>"+u+"</span></td>"+(g.options.showLabels?"<td style='color: #777;'>/</td><td style='white-space: nowrap; color: #777;'>"+v.label+"</td>":"")+"<td>/</td><td class='gameTime'>"+z+"</td><td width='99%'>&nbsp;</td></tr><tr class='pdSpacingRow'><td colspan='4'></td></tr>":"<tr"+y+"><td colspan='4'>—</td></tr><tr class='pdSpacingRow'><td colspan='4'></td></tr>"}p+="</table>",q+="</table>";var A="<td style='text-align: center' width='50%'>"+o.get("averageWinTimeLabel")+": "+formatGameTimeMS(k)+"</td>";f.isSuperUser()&&(A+="<td style='text-align: center'>"+o.get("totalGameTimeLabel")+": "+formatLargeGameTime(j)),A+="</td>",n+="<table style='width: 100%; border: 1px #CCC solid; padding-bottom: 10px; padding-top: 10px;'><tr>"+A+"</tr></table>",m?n+="<div class='pdSelfHint'>"+o.get("selfHistoryHint")+"</div>":(n+="<table class='standartTable' style='margin-top:10px;' width='100%' border='0' vspace='0' cellspacing='0' hspace='0'><tr><th width='50%'>"+o.format("playerResultHeader",b)+"</th><th width='50%'>"+o.get("userResultHeader")+"</th></tr>",n+="<tr><td>"+p+"</td><td>"+q+"</td></tr>",n+="</table>"),i.length>SHOW_SHORTCUTS_AFTER&&!m&&(n+="<div style='margin-top: 5px;'>",n+="<div class='bspAuxBtn' style='float: left;' id='pdScroll"+a+"'>["+o.get("auxScrollTop")+"]</div>",n+="<div class='bspAuxBtn' style='float: right;' id='pdClose"+a+"'>["+o.get("auxClose")+"]</div>",n+="<div class='clear'></div>",n+="</div>");var B=new BottomSubPanel;B.fillContents(n),B.onClose(function(a){a==HIDE_SINGLE_PANEL&&(e.showPanel({id:"ratingsPanel"}),$("html, body").scrollTop($("#ratingsPanel").offset().top-iDiv($("#gameArea").width(),3)))}),B.onShow(function(){$("html, body").animate({scrollTop:$("#"+B.getId()).offset().top-iDiv($("#gameArea").width(),3)})}),B.render(),m&&$("#pdShowHistory").click(function(){e.showHistoryPanel()}),i.length>SHOW_SHORTCUTS_AFTER&&($("#pdScroll"+a).click(function(){$("html, body").animate({scrollTop:$("#"+B.getId()).offset().top-iDiv($("#gameArea").width(),3)})}),$("#pdClose"+a).click(function(){e.hidePanel(B)}));for(var t=0;t<i.length;t++){var C=i[t].gameId;$("#pdPlayGame"+C+", #pdPlayGame"+C+"B").click(function(a){return function(){h.canPlayGames?d.requestGame(a,null,function(){e.showGameInfo(a,!1)}):alert(o.get("wrongGameVariationAlert"))}}(C))}e.getUserProfile().bindActions(l)})},this.bindAll=function(){$("#closeRatingsPanel").click(function(){e.hidePanel("ratingsPanel")})},d=a,e=b,g.gc=d,g.ui=e,isDef(c)&&null!=c&&mergeObj(j,c),g.gc.getClientServer().isSuperUser()||(j.canFilter=!1),g.options=j,this.bindAll()}function suFormatTotalGameTime(a){if(0==a)return"—";a=iDiv(a,1e3);var b=a%60,c=iDiv(a,60)%60,d=iDiv(a,3600),e=iDiv(d,24);return e>0?e+" "+I18n.get("daysShortSuffix"):d>0?d+" "+I18n.get("hoursShortSuffix"):c>0?c+" "+I18n.get("minutesShortSuffix"):b+" "+I18n.get("secondsShortSuffix")}function calcPercent(a,b){var c=iDiv(100*a,b);return 99==c&&a%b>0&&(c=parseFloat(c+"."+(iDiv(1e3*a,b)-10*c))),c}function formatUsername(a){return a.length<=MAX_VISIBLE_USERNAME_LENGTH?a:a.substr(0,MAX_VISIBLE_USERNAME_LENGTH-3)+"..."}function renderMenu(a,b){for(var c="",b=ifDef(b,"&nbsp;&nbsp;&nbsp;&nbsp;"),d=0;d<a.length;d++){var e=a[d];itemClass=e.isActive?"disabledText boldText":"actionText2",c+="<span class='"+itemClass+"' id='"+e.id+"'>"+e.text+"</span>"+(d<a.length-1?b:"")}return c}function GameListRenderer(a,b,c){var d,e,f,g,h,i=this,j="#gameListContents",k={bindCPButton:!1,showLabels:!1,moreLabel:"hands",defaultSortBy:GL_SORT_BY_GAME_ID,defaultOrder:ASC,canFilter:!1,filterLabel:"",noFilterLabel:"",showDifficult:!1},l=-1,m=GL_DEFAULT_LOAD_COUNT;i.activeSegmentFilter=0;var n=new I18n;n.setContext("gameList"),this.run=function(){$("#gameListPanel").is(":visible")?e.hidePanel("gameListPanel"):(f=d.getClientServer(),e.setLoading("#gameListContents"),i.loader=new Loader(0,GL_DEFAULT_LOAD_COUNT),i.loader.addListener(i),this.loadAndRender(!1),$("#glAuxPanel").hide(),$("#glFilterSection").empty(),e.showPanel({id:"gameListPanel",type:BOTTOM_PANEL}))},this.countChanged=function(){i.loadAndRender(!0,!1)},this.loadAndRender=function(a,b){b=ifDef(b,!0),b&&i.loader.reset(),a&&$("#glLoadingImg").show(),f.sendRequest(GWT_GAMELIST,{sortBy:g,order:boolToInt(h),count:i.loader.count,filter:i.activeSegmentFilter},function(b,c,d){$("#glLoadingImg").hide(),b?(i.render(c),a||$("html, body").animate({scrollTop:$("#gameListContents").offset().top-1*iDiv($("#gameArea").width(),5)},"normal")):i.ui.renderErrorReason(j,d.reason)})},this.bindHeaderAction=function(a,b,c){$(a).click(function(){g!=b?(g=b,h=c):h=!h,m=GL_DEFAULT_LOAD_COUNT,i.loadAndRender(!0)})},this.renderFilter=function(a){$("#glFilterSection").empty();var b="<option value='nofilter'>"+i.options.noFilterLabel+"</option>";for(var c in a){var d=a[c];b+="<option value='"+d.val+"'>"+d.text+"</option>"}$("#glFilterSection").append("<table style='margin-bottom: 5px;'><tr><td><span style='color: #777;'>"+i.options.filterLabel+": </span></td><td>&nbsp;&nbsp;</td><td><select style='width: 220px' id='glFilter'>"+b+"</select></td></tr></table>"),i.activeSegmentFilter&&$("#glFilter").val(i.activeSegmentFilter),$("#glFilter").change(function(){i.onFilterChange()}),$("#glFilter").chosen({disable_search:!0})},this.onFilterChange=function(){var a=$("#glFilter option:selected").val();i.activeSegmentFilter="nofilter"==a?0:a,i.loadAndRender(!0)},this.render=function(a){{var b=a.gameList;a.total}if(i.options.canFilter){var c=a.filterData;i.renderFilter(c)}i.loader.setTotal(a.total),e.hideHint();var j=20,m="<table id='gameListTable' class='standartTable' style='clear:both; border-collapse: collapse;' "+' width="100%" border="0" vspace="0" cellspacing="0" hspace="0"><tr><th colspan=\''+(i.options.showLabels?3:2)+"' width='"+j+"%' "+(g==GL_SORT_BY_GAME_ID?" style='background-color: rgb(255, 255, 224);'":"")+"><span"+(g==GL_SORT_BY_GAME_ID?" class='actionText4 activeSortHeader'":" class='actionText4'")+" id='glSortByGameId'><div class='glHeader'>"+n.get("gameIdLabel")+"</div>"+(g==GL_SORT_BY_GAME_ID?e.serverSortArrowsImg(h)+e.getOrderHint(h):" &nbsp;<img src='/img/icons/sort-both.png' alt=''/>")+"</span></th><th width='"+j+"%' "+(g==GL_SORT_BY_GAME_RATING?" style='background-color: rgb(255, 255, 224);'":"")+"><span"+(g==GL_SORT_BY_GAME_RATING?" class='actionText4 activeSortHeader'":" class='actionText4'")+" id='glSortByGameRating'><div class='glHeader'>"+n.get("gameRatingLabel")+"</div><div class='glHeaderDescr'>"+n.get("gameRatingDescription")+"</div>"+(g==GL_SORT_BY_GAME_RATING?e.serverSortArrowsImg(h)+e.getOrderHint(h):" &nbsp;<img src='/img/icons/sort-both.png' alt=''/>")+"</span></th>"+(k.showDifficult?"<th width='"+j+"%' "+(g==GL_SORT_BY_DIFFICULT?" style='background-color: rgb(255, 255, 224);'":"")+"><span"+(g==GL_SORT_BY_DIFFICULT?" class='actionText4 activeSortHeader'":" class='actionText4'")+" id='glSortByDifficult'><div class='glHeader' title='Количество начальных цифр'>Цифр</div><div class='glHeaderDescr'></div>"+(g==GL_SORT_BY_DIFFICULT?e.serverSortArrowsImg(h)+e.getOrderHint(h):" &nbsp;<img src='/img/icons/sort-both.png' alt=''/>")+"</span></th>":"")+"<th colspan='4' width='"+j+"%'"+(g==GL_SORT_BY_PLAYER_RATING?" style='background-color: rgb(255, 255, 224);'":"")+"><span"+(g==GL_SORT_BY_PLAYER_RATING?" class='actionText4 activeSortHeader'":" class='actionText4'")+" id='glSortByPlayerRating'><div class='glHeader'>"+n.get("winTimeAndRankLabel")+"</div><div class='glHeaderDescr'>"+n.get("winTimeAndRankDescription")+"</div>"+(g==GL_SORT_BY_PLAYER_RATING?e.serverSortArrowsImg(h)+e.getOrderHint(h):" &nbsp;<img src='/img/icons/sort-both.png' alt=''/>")+"</span></th><th width='"+j+"%' "+(g==GL_SORT_BY_TOTAL_WON?" style='background-color: rgb(255, 255, 224);'":"")+"><span"+(g==GL_SORT_BY_TOTAL_WON?" class='actionText4 activeSortHeader'":" class='actionText4'")+" id='glSortByGameTotalWon'><div class='glHeader'>"+n.get("solvedLabel")+"</div>"+(g==GL_SORT_BY_TOTAL_WON?e.serverSortArrowsImg(h)+e.getOrderHint(h):" &nbsp;<img src='/img/icons/sort-both.png' alt=''/>")+"</span></th><th width='"+j+"%' "+(g==GL_SORT_BY_TOTAL_PLAYED?" style='background-color: rgb(255, 255, 224);'":"")+"><span"+(g==GL_SORT_BY_TOTAL_PLAYED?" class='actionText4 activeSortHeader'":" class='actionText4'")+" id='glSortByGameTotalPlayed'><div class='glHeader'>"+n.get("playedLabel")+"</div>"+(g==GL_SORT_BY_TOTAL_PLAYED?e.serverSortArrowsImg(h)+e.getOrderHint(h):" &nbsp;<img src='/img/icons/sort-both.png' alt=''/>")+"</span></th></tr>";b.length>15?$("#glAuxPanel").show():$("#glAuxPanel").hide();for(var o="",p="<img src='/img/icons/infinity.png' alt='"+n.get("noRatingAltText")+"'/>",q=0;q<b.length;q++){var r,s=b[q],t=s.playerWinTime,u=s.playerTotalGameTime;r=0==s.gameRating?p:"<p>"+formatGameTimeMS(s.gameRating)+"</p>";var v;v=t>0?"<p>"+formatGameTimeMS(t)+"</p>":"—";var w;if(t>0)var x=formatGameTimeMS(t);else x="<span class='pdTotalGameTime'>"+formatGameTimeMS(u)+"</span>";w=u>0?f.isLogged()?"<td class='noRightBorder' style='text-align: right;'><p>"+x+"</p></td>"+(t>0?"<td class='noRightBorder' >/</td><td class='noRightBorder' >"+s.playerWinTimeRank+"</td><td>&nbsp;</td>":"<td colspan='3'>&nbsp;</td>"):"<td class='noRightBorder' style='text-align: right;'><p>"+x+"</p></td><td colspan='3'>&nbsp;</td>":"<td class='noRightBorder' style='text-align: right;'>—</td><td colspan='3'>&nbsp;</td>";var y="<p style='display: inline; "+(s.gameId>d.getHigherGameIdBound()?"color: #C42E21 !important;":"")+"' id='glPlay"+s.gameId+"' class='actionText'>"+s.gameId+"</p>";if(i.options.showLabels)var z="<p style='display: inline; color: #777;'>"+s.label+"&nbsp;</p>";var A=6;f.isSuperUser()&&(A=4);var B="<td class='noRightBorder noLeftRightPadding' style='white-space: nowrap;'>"+(1==s.fav?" &nbsp;<img src='/img/icons/fav-2.png' alt=''/>":"")+"</td><td id='glGameIdTd"+s.gameId+"' "+(i.options.showLabels?"class='noRightBorder'":"")+" style='text-align: right; white-space: nowrap; cursor: pointer; "+(i.options.showLabels?"":"padding-right: "+A+"%;")+"'>"+y+"</td>"+(i.options.showLabels?"<td id='glLabelTd"+s.gameId+"' style='cursor: pointer; white-space: nowrap;'>"+z+"</td>":"")+"<td style='text-align: right; padding-right: "+A+"%;'>"+r+"</td>"+(k.showDifficult?"<td style='text-align: center;'>"+s.difficult+"</td>":"")+w+"<td style='text-align: center;'><p id='glShowGameDetail"+s.gameId+"'"+(s.totalWon>0?" class='activeText'":"")+">"+s.totalWon+"</p><div class='glGameDetailContent' id='glGameDetailContent"+s.gameId+"'></div></td><td style='text-align: center;'><p id='glShowGameDetail"+s.gameId+"_2'"+(s.totalPlayed>0?" class='activeText'":"")+">"+s.totalPlayed+"</p><div class='glGameDetailContent' id='glGameDetailContent"+s.gameId+"_2'></div></td>",C="white";0==s.status?C=PLAYED_GAME_COLOR:s.status==WIN_STATUS&&(C=WON_GAME_COLOR),o+="<tr class='glRow' id='glRow"+s.gameId+"' style='background-color: "+C+";'>"+B+"</tr>"}m+=o+"</table>",$("#gameListContents").empty(),$("#gameListContents").append(m);var D=new LoaderRenderer(i.loader,i.options.moreLabel);$("#gameListContents").append(D.render()),D.bindEvents();for(var q=0;q<b.length;q++){var E=b[q].gameId;$("#glGameIdTd"+E+(i.options.showLabels?", #glLabelTd"+E:"")).click(function(a){return function(){d.requestGame(a,null,function(){l=a,e.showGameInfo(a,!1)})}}(E)),b[q].totalWon>0&&$("#glShowGameDetail"+E).click(function(a){return function(){$("#glGameDetailContent"+a).is(":visible")?($("#glGameDetailContent"+a).hide(),$("#glGameDetailContent"+a).removeClass("glActiveGameDetailContent")):($(".glActiveGameDetailContent").hide(),$("#glGameDetailContent"+a).empty().append('<div style="padding-top: 20px; padding-left:20px; height:35px;"><span style="float: left; color:black;">'+n.get("loadingAlert")+'&nbsp;</span><img style="float: left; margin-top: -10px;" src="/img/icons/loading_transparent.gif"></div>'),$("#glGameDetailContent"+a).show(),f.sendRequest(GWT_PLAYERLIST,{gameId:a},function(b,c){if(b){for(var d=c.playerList,e="<table class='noBordersTable' style='padding-bottom: 0px; margin-bottom:7px; padding-right: 20px;'>",f=1,g=0;g<d.length;g++){var h=n.transliterate(d[g].username),i=d[g].winTime;
i>0&&(e+="<tr><td style='float: right;'>"+f+".</td><td>"+h.replace(/\s+/g,"&nbsp;")+"</td><td>/</td><td class='gameTime'>"+formatGameTimeMS(i)+"</td></tr>",f++)}$("#glGameDetailContent"+a).empty().append(e),$("#glGameDetailContent"+a).addClass("glActiveGameDetailContent")}}))}}(E)),b[q].totalPlayed>0&&$("#glShowGameDetail"+E+"_2").click(function(a){return function(){$("#glGameDetailContent"+a+"_2").is(":visible")?($("#glGameDetailContent"+a+"_2").hide(),$("#glGameDetailContent"+a+"_2").removeClass("glActiveGameDetailContent")):($(".glActiveGameDetailContent").hide(),$("#glGameDetailContent"+a+"_2").empty().append('<div style="padding-top: 20px; padding-left:20px; height:35px;"><span style="float: left; color:black;">'+n.get("loadingAlert")+'&nbsp;</span><img style="float: left; margin-top: -10px;" src="/img/icons/loading_transparent.gif"></div>'),$("#glGameDetailContent"+a+"_2").show(),f.sendRequest(GWT_PLAYERLIST,{gameId:a},function(b,c){if(b){for(var d=c.playerList,e="<table class='noBordersTable' style='padding-bottom: 0px; margin-bottom:7px; padding-right: 20px;'>",f=0;f<d.length;f++){var g=n.transliterate(d[f].username),h=d[f].winTime;e+="<tr><td style='float: right;'>"+(f+1)+".</td><td>"+g.replace(/\s+/g,"&nbsp;")+"</td>"+(h>0?"<td>/</td><td class='gameTime'>"+formatGameTimeMS(h)+"</td>":"")+"</tr>"}$("#glGameDetailContent"+a+"_2").empty().append(e),$("#glGameDetailContent"+a+"_2").addClass("glActiveGameDetailContent")}}))}}(E))}i.bindHeaderAction("#glSortByGameId",GL_SORT_BY_GAME_ID,!0),i.bindHeaderAction("#glSortByGameRating",GL_SORT_BY_GAME_RATING,!1),i.bindHeaderAction("#glSortByPlayerRating",GL_SORT_BY_PLAYER_RATING,!1),i.bindHeaderAction("#glSortByGameTotalWon",GL_SORT_BY_TOTAL_WON,!1),i.bindHeaderAction("#glSortByGameTotalPlayed",GL_SORT_BY_TOTAL_PLAYED,!1),k.showDifficult&&i.bindHeaderAction("#glSortByDifficult",GL_SORT_BY_DIFFICULT,!1),$("#glSortByGameId").mouseenter(function(){e.showHint("#glSortByGameId",n.get("sortByGameIdHint"))}),$("#glSortByGameRating").mouseenter(function(){e.showHint("#glSortByGameRating",n.get("sortByGameRatingHint"))}),$("#glSortByPlayerRating").mouseenter(function(){e.showHint("#glSortByPlayerRating",n.get("sortByWinTimeHint"))}),$("#glSortByGameTotalWon").mouseenter(function(){e.showHint("#glSortByGameTotalWon",n.get("sortByWonCountHint"))}),$("#glSortByGameTotalPlayed").mouseenter(function(){e.showHint("#glSortByGameTotalPlayed",n.get("sortByPlayedCountHint"))}),$("#glSortByGameId, #glSortByGameRating, #glSortByPlayerRating, #glSortByGameTotalWon, #glSortByGameTotalPlayed").mouseleave(function(){e.hideHint()}),$("#glLoadingImg").hide()},this.bindAll=function(){$("#closeGameListPanel").click(function(){e.hidePanel("gameListPanel")}),$("#glAuxClose").click(function(){e.hidePanel("gameListPanel")}),$("#glAuxRewind").click(function(){$("html, body").animate({scrollTop:$("#gameListContents").offset().top-1*iDiv($("#gameArea").width(),5)},"normal")}),isDef(i.options.bindCPButton)&&i.options.bindCPButton&&$("#bbGameList").click(function(){i.run()})},d=a,e=b,i.gc=d,i.ui=e,isDef(c)&&null!=c&&mergeObj(k,c),i.options=k,g=i.options.defaultSortBy,h=i.options.defaultOrder,i.bindAll()}function GameInfoRenderer(a,b,c){var d,e,f,g,h,i=this,j="#gameInfoContents",k={bindCPButton:!1,showBestAttemptRating:!1,showLabels:!1,gameIdLabel:"hand"},l=-1,m=new I18n;m.setContext("gameInfo"),this.run=function(a,b){var b=ifDef(b,!0);!$("#gameInfoPanel").is(":visible")&&d.isGameLoaded()?(f=d.getClientServer(),g=!0,h=!1,l=a,$("#giEditable").hide(),b?$("#giCommentFavArea").show():$("#giCommentFavArea").hide(),e.setLoading("#gameInfoContents"),this.loadAndRender(a),k.showSolution?$("#showSolution").show():$("#showSolution").hide(),e.showPanel({id:"gameInfoPanel",type:BOTTOM_PANEL,onClose:function(){i.onClose()}})):e.hidePanel("gameInfoPanel")},this.loadAndRender=function(a,b){f.sendRequest(GTW_GAMEINFO,{gameId:a,showPlayersResults:b||0},function(a,b,c){a?(i.render(b),$("html, body").animate({scrollTop:$("#gameInfoContents").offset().top-1*iDiv($("#gameArea").width(),5)},"normal")):i.ui.renderErrorReason(j,c.reason)})},this.render=function(a){var b=a.gameId,c=a.totalPlayed,d=a.totalWon,e=a.averageWinTime,g=a.bestAttemptTop||[],h=a.comment,j=a.fav,k=a.playerList||[],l="<table class='gameInfoContentsTable standartTable' width='100%' border='0' vspace='0' cellspacing='0' hspace='0'><tr><th width='33%'>"+m.get("byWinTimeLabel")+"</th>"+(i.options.showBestAttemptRating?"<th width='33%'>"+m.get("byBestAttemptTimeLabel")+"</th>":"")+"<th width='34%'>"+m.get("unsolvedListLabel")+"</th></tr>",n="";if(g.length>0){n="<table class='noBordersTable' style='padding-left: 5px; padding-right: 5px; margin-bottom: 0; width: 100%'>";for(var o=0;o<g.length;o++){var p="";g[o].username==f.getUsername()&&(p=" font-weight: bold;"),n+="<tr style='font-size:10pt !important; height: 25px;"+p+"'><td>"+(o+1)+".</td><td>"+m.transliterate(g[o].username.replace(/\s+/g,"&nbsp;"))+"</td><td>/</td><td class='gameTime'>"+formatGameTimeMS(g[o].minElapsed)+"</td></tr>"}n+="</table>"}for(var q="<table class='noBordersTable' style='padding-left: 5px; padding-right: 5px; margin-bottom: 0; width: 100%'>",r="<table class='noBordersTable' style='padding-left: 5px; padding-right: 5px; margin-bottom: 0; width: 100%'>",d=0,s=1,t=0,o=0;o<k.length;o++){var p="",u=-1!=k[o].username.indexOf("Гость");if(k[o].username==f.getUsername()&&(p=" font-weight: bold;"),k[o].winTime>0){if(u)v="",p+=" color: #777";else{var v=s+".";s++}q+="<tr style='font-size:10pt !important; height: 25px;"+p+"'><td>"+v+"</td><td>"+m.transliterate(k[o].username.replace(/\s+/g,"&nbsp;"))+"</td><td>/</td><td class='gameTime'>"+formatGameTimeMS(k[o].winTime)+"</td></tr>",d++}else r+="<tr style='font-size:10pt !important; height: 25px;"+p+"'><td>"+(t+1)+".</td><td>"+m.transliterate(k[o].username.replace(/\s+/g,"&nbsp;"))+"</td>"+(f.isSuperUser()?"<td class='faded'>/</td><td class='faded gameTime'>"+formatGameTimeMS(k[o].totalGameTime)+"</td>":"")+"</tr>",t++}if(q+="</table>",r+="</table>",0==d&&(q="<p class='giNoResult'>—</p>",n="<p class='giNoResult'>—</p>"),0==t&&(r="<p class='giNoResult'>—</p>"),l+="<tr><td"+(0==a.showPlayersResults&&a.totalPlayed>5?' style="border-bottom:none;" ':"")+"><div class='giResults'>"+q+(0==a.showPlayersResults&&a.totalPlayed>5&&d>4?"<div style='text-align: center;'>...</div>":"")+"</div></td>"+(i.options.showBestAttemptRating?"<td"+(0==a.showPlayersResults&&a.totalPlayed>5?' style="border-bottom:none;" ':"")+"><div class='giResults'>"+n+(0==a.showPlayersResults&&a.totalPlayed>5&&d>4?"<div style='text-align: center;'>...</div>":"")+"</div></td>":"")+"<td"+(0==a.showPlayersResults&&a.totalPlayed>5?' style="border-bottom:none;" ':"")+"><div class='giResults'>"+r+(0==a.showPlayersResults&&a.totalPlayed>5&&t>4?"<div style='text-align: center;'>...</div>":"")+"</div></td></tr>",0==a.showPlayersResults&&a.totalPlayed>5?(l+="<tr><td style='border:none;'><br><br></td>"+(i.options.showBestAttemptRating?"<td style='border:none;'><br></td>":"")+"<td style='border-bottom-style:none; border-left-style: none;'><br></td></tr>",l+="</table>",l+='<div style="margin: 0 auto; width: 180px; float: none !important; margin-top: -26px;" class="constantWidthBtn" id="giShowPlayersResults">'+m.get("allResults")+"</div>"):l+="</table>",d=a.totalWon,10==i.gc.getClientServer().getGameVariationId())w=" (по одной карте)";else if(1==i.gc.getClientServer().getGameVariationId())w=" (по три карты)";else var w="";var x="<p style='margin-top:5px; margin-left:5px; font-size:8pt;'>"+m.get("gameIdLabel",i.options.gameIdLabel)+b+(i.options.showLabels?" / "+a.label:"")+w+"</p>";$("#gameStatusContents").empty().append(x),$("#gameInfoContents").empty().append("<h4 style='text-align: center; padding-bottom: 5px; padding-top: 20px;'>"+m.get("playerResultsHeader")+"</h4>"),$("#gameInfoContents").append("<p style='padding-left: 5px; font-size:8pt;'>"+m.get("gameRatingLabel")+": "+(0==e?"—":formatGameTimeMS(e))+"&nbsp;&nbsp;&nbsp;"+m.get("wonCountLabel")+": "+d+"&nbsp;&nbsp;&nbsp;"+m.get("playedCountLabel")+": "+c+"</p>"+(a.userName?"<p style='padding-left: 5px; font-size:8pt;'>"+m.get("bestAttempt")+formatGameTimeMS(a.bestWinTime)+" ("+a.userName+") ":"")+(a.userWinTime>0?"<p style='padding-left: 5px; font-size:8pt;'>"+m.get("YourAttempt")+formatGameTimeMS(a.userWinTime):"")),k.length>0&&$("#gameInfoContents").append(l),f.isLogged()?(""!=h?($("#giComment").val("").val(h),$("#giComment").removeClass("greyComment")):($("#giComment").val("").val(m.get("commentLabel")),$("#giComment").addClass("greyComment"),$("#giComment").focus(function(){return $(this).hasClass("greyComment")?($(this).removeClass("greyComment"),this.value="",!1):void 0})),$("#giComment").blur(function(){return""==this.value?($("#giComment").val("").val(m.get("commentLabel")),$("#giComment").addClass("greyComment"),!1):void 0}),j?$("#giFav").attr("checked",!0):$("#giFav").attr("checked",!1)):($("#giComment").val("").val(m.get("onlyForSignedUsersAlert")),$("#giComment").addClass("greyComment"),$("#giComment").attr("disabled",!0),$("#giFav").attr("disabled",!0)),$("#giShowPlayersResults").click(function(){i.loadAndRender(b,1)}),$("#giEditable").show()},this.saveComment=function(){if(f.isLogged()){var a=$("#giComment").val(),b=$("#giFav").is(":checked");$("#giComment").hasClass("greyComment")&&(a="");var c=bool2Int(b);f.sendRequest(GTW_SAVE_COMMENT,{gameId:l,comment:a,fav:c},function(a){})}else h&&(g=!1,e.showRegPanel())},this.onClose=function(){g&&i.saveComment()},this.bindAll=function(){$("#giCommit, #giCancel").click(function(){var a="giCommit"==$(this).attr("id"),b="giCancel"==$(this).attr("id");a&&(h=!0),b&&(g=!1),e.hidePanel("gameInfoPanel")}),e.bindCloseIcon("#giCloseIcon","gameInfoPanel"),isDef(i.options.bindCPButton)&&i.options.bindCPButton&&$("#bbGameInfo").click(function(){i.run(d.getGameManager().getGameId())})},d=a,e=b,i.gc=d,i.ui=e,isDef(c)&&null!=c&&mergeObj(k,c),i.options=k,this.bindAll()}function InformationReneder(a,b,c){var d=this;d.options={widthElement:"gameArea"},this.run=function(){$("#informationMain").width($("#"+d.options.widthElement).width()+X_MARGINS),$("#fullShadow").css("height",$(document).height()),$("#fullShadow").show(),$("#informationBubble").fadeIn("fast",function(){$("#fullShadow").css("height",$(document).height())}),$("html, body").animate({scrollTop:0},"fast")},this.hide=function(){$("#informationBubble").hide(),$("#fullShadow").hide()},this.escKeyDown=function(){d.hide()},this.bindAll=function(){$("#title").click(function(){d.run()}),$("#showDescription").click(function(){d.run()}),$("#closeInformationBubble").click(function(){d.hide()}),d.gc.addListener(d)},d.gc=a,d.ui=b,isDef(c)&&null!=c&&mergeObj(d.options,c),d.bindAll()}function TableDataRenderer(a,b,c){var d=this;d.columns=[],d.sortBy=a,d.order=b,d.options={},isDef(c)&&null!=c&&mergeObj(d.options,c),this.fillDefault=function(a,b,c){isDef(a[b])||(a[b]=c)},this.addColumn=function(a){d.fillDefault(a,"enableSort",!1),d.fillDefault(a,"onlyDefaultOrder",!1),d.fillDefault(a,"showOrderHint",!0),d.fillDefault(a,"hasRightBorder",!0),d.fillDefault(a,"insertSeparatorAfter",!1),d.fillDefault(a,"colspan",1),d.fillDefault(a,"customSortImgTdFunc",null),d.fillDefault(a,"hint",null),d.columns.push(a)},this.bindHeaderAction=function(a,b){if(!(!b.enableSort||b.enableSort&&b.onlyDefaultOrder&&b.sortBy==d.sortBy)){var c="#"+b.headerId+", #"+b.headerId+"Img";$(c).click(function(){d.sortBy!=b.sortBy||b.onlyDefaultOrder?a.setSort(b.sortBy,b.defaultOrder):a.setSort(d.sortBy,!d.order),a.loadAndRender(!0)}),b.hint&&($("#"+b.headerId).mouseenter(function(){uiShowHint("#"+b.headerId,b.hint)}),$("#"+b.headerId+"Img").mouseenter(function(){uiShowHint("#"+b.headerId+"Img",b.hint)}),$(c).mouseleave(function(){uiHideHint()}))}},this.bindHeaderActions=function(a){for(var b in d.columns){var c=d.columns[b];d.bindHeaderAction(a,c)}},this.renderOrderHint=function(a){return uiGetOrderHint(a)},this.renderColumnHeader=function(a){var b=a.colspan>1?"colspan='"+a.colspan+"' ":"",c=a.enableSort&&d.sortBy==a.sortBy?'style="background-color: rgb(252, 252, 216);"':"";if(a.hasRightBorder)e="<th "+b+" class='"+d.options.thClass;else var e="<th "+b+"class='"+d.options.thClass+" noRightBorder";if(e+="' "+c+" >",a.enableSort&&d.sortBy==a.sortBy)var f="activeSortHeader ";else f="";return f+=!a.onlyDefaultOrder||a.onlyDefaultOrder&&d.sortBy!=a.sortBy?"actionText3":"simpleText",e+=a.enableSort?"<span class='"+f+"' id='"+a.headerId+"'>"+a.title+(a.showOrderHint&&d.sortBy==a.sortBy?d.renderOrderHint(d.order):"")+"</span>":"<span class='simpleText'>"+a.title+"</span>",e+="</th>",a.insertSeparatorAfter&&(e+="<th class='"+d.options.thClass+" noRightBorder'>&nbsp;</th>"),e},this.serverSortArrowsImg=function(a,b,c){var b=isDef(b)&&""!=b?" style='"+b+"' ":"",c=isDef(c)?" id='"+c+"' ":"";return a?" &nbsp;<img "+b+c+"src='/img/icons/sort-asc.png' alt=''/>":" &nbsp;<img "+b+c+"src='/img/icons/sort-desc.png' alt=''/>"},this.generateSortImg=function(a,b){return d.sortBy==b?d.serverSortArrowsImg(d.order,"",a):" &nbsp;<img src='/img/icons/sort-both.png' id='"+a+"' alt=''/>"},this.renderColumnSortImgTd=function(a){if(a.customSortImgTdFunc)return a.customSortImgTdFunc(a);var b=a.colspan>1?"colspan='"+a.colspan+"' ":"",c=a.enableSort&&(!a.onlyDefaultOrder||a.onlyDefaultOrder&&d.sortBy!=a.sortBy),e=c?"rlArrows":"noArrows",f=a.enableSort&&d.sortBy==a.sortBy?" background-color: rgb(252, 252, 216); ":"";if(a.hasRightBorder)g="<td "+b+" class='"+e+"' style='text-align: center; ";else var g="<td "+b+"class='"+e+" noRightBorder' style='text-align: center; ";return g+=f+"'>",g+=c?d.generateSortImg(a.headerId+"Img",a.sortBy):"&nbsp;",g+="</td>",a.insertSeparatorAfter&&(g+="<td class='noArrows noRightBorder'>&nbsp;</td>"),g},this.renderTableHeader=function(){var a="";for(var b in d.columns){var c=d.columns[b];a+=d.renderColumnHeader(c)}return a},this.renderTableSortTrContents=function(){var a="";for(var b in d.columns){var c=d.columns[b];a+=d.renderColumnSortImgTd(c,b)}return a}}function NewGameLister(){var a=this;a.currentPosition=null,a.gameIdList=[],this.resetNewGameLister=function(){a.currentPosition=null,a.gameIdList=[],__w_clear(),__w_arr(a.gameIdList,a.currentPosition)},this.contains=function(b){for(var c in a.gameIdList)if(a.gameIdList[c]==b)return!0;return!1},this.addGameId=function(b){a.contains(b)||(a.gameIdList.push(b),a.currentPosition=a.gameIdList.length-1,__w_clear(),__w_arr(a.gameIdList,a.currentPosition))},this.hasNext=function(){return null!=a.currentPosition&&a.currentPosition<a.gameIdList.length-1},this.next=function(){return a.currentPosition++,__w_clear(),__w_arr(a.gameIdList,a.currentPosition),a.gameIdList[a.currentPosition]},this.hasPrevious=function(){return a.currentPosition&&a.currentPosition>0},this.previous=function(){return a.currentPosition--,__w_clear(),__w_arr(a.gameIdList,a.currentPosition),a.gameIdList[a.currentPosition]},a.resetNewGameLister()}function Paginator(a,b,c){var d=this;this.hasNext=function(){return d.currentPosition+d.count-1<d.total-1},this.next=function(){d.hasNext()&&(d.currentPosition+=d.count,d.computeCount(),d.notify("currentPositionChanged"))},this.hasPrevious=function(){return d.currentPosition>0},this.previous=function(){d.hasPrevious()&&(d.currentPosition-=d.count,d.currentPosition<0&&(d.currentPosition=0),d.computeCount(),d.notify("currentPositionChanged"))},this.showAll=function(){d.currentPosition=0,d.currentCount=0,d.notify("currentPositionChanged")},this.computeCount=function(){d.currentCount=0==d.total?d.count:Math.min(d.count,d.total-d.currentPosition)},this.setTotal=function(a){d.total=a,d.computeCount()},this.getPreviousCount=function(){return Math.min(d.currentPosition,d.count)},this.getNextCount=function(){return Math.min(d.total-d.currentPosition,d.count)},this.reset=function(){d.total=0,d.currentPosition=0,d.computeCount()},multiExtendClass(Paginator,Listener,this),d.total=a,d.count=b,d.currentPosition=c,d.computeCount()}function PaginatorRenderer(a,b){var c=this;c.paginator=a,c.prefix=b,c.prevLinkId=c.prefix+"ShowPrevious",c.nextLinkId=c.prefix+"ShowNext",c.paginatorId=c.prefix+"Paginator",c.paginatorStatsId=c.prefix+"PaginatorStats";var d=new I18n;d.setContext("paginator"),this.render=function(){if(!c.paginator.hasNext()&&!c.paginator.hasPrevious())return"";var a=c.paginator.currentPosition+1+" &ndash; "+(c.paginator.currentPosition+c.paginator.currentCount);return"<table border='1' style='margin-top: 10px;' width='100%' class='noBordersTable' id='"+c.paginatorId+"'><tr><td width='50%'>"+(c.paginator.hasPrevious()?"<p class='paginatorNavigation paginatorActiveNavigation' id='"+c.prevLinkId+"'>"+d.get("previousPrefix")+" "+c.paginator.getPreviousCount()+"</p>":"<p class='paginatorNavigation paginatorInactiveNavigation'>—</p>")+"</td><td width='50%'>"+(c.paginator.hasNext()?"<p class='paginatorNavigation paginatorActiveNavigation' id='"+c.nextLinkId+"'>"+d.get("nextPrefix")+" "+c.paginator.getNextCount()+"</p>":"<p class='paginatorNavigation paginatorInactiveNavigation'>—</p>")+"</td></tr><tr><td colspan='2' class='paginatorStats' id='"+c.paginatorStatsId+"' style='text-align: center !important;'>"+a+" "+d.get("rangeOf")+" "+c.paginator.total+"</td></tr></table>"},this.setLoading=function(){$("#"+c.paginatorStatsId).empty().append("<img style='width: 32px;' src='/img/icons/loading.gif' />")},this.bindEvents=function(){$("#"+c.prevLinkId).click(function(){c.paginator.previous(),c.setLoading()}),$("#"+c.nextLinkId).click(function(){c.paginator.next(),c.setLoading()})}}function Loader(a,b){var c=this;this.isSinglePaged=function(){return c.count>=c.total},this.computeCount=function(){0==c.total?c.count=c.loadCount:0==c.count?c.count=c.total:(c.count<c.loadCount&&(c.count=c.loadCount),c.count=Math.min(c.count,c.total))},this.setTotal=function(a){c.total=a,c.computeCount()},this.reset=function(){c.total=0,c.computeCount()},this.getMoreCount=function(){return Math.min(c.loadCount,c.total-c.count)},this.showMore=function(){c.count=c.count+c.loadCount,c.computeCount(),c.notify("countChanged")},this.showAll=function(){c.count=0,c.notify("countChanged")},multiExtendClass(Paginator,Listener,this),c.total=a,c.loadCount=b,c.computeCount()}function LoaderRenderer(a,b){var c=this,d=new I18n;d.setContext("loader"),this.render=function(){return c.loader.isSinglePaged()?"":"<table border='1' style='margin-top: 10px;' width='100%' class='noBordersTable' id='glShowPanel'><tr><td width='50%'><p class='glShowMore' id='glShowMore'>"+d.get("loaderMorePrefix")+" "+a.getMoreCount()+" "+d.get("loaderMoreSuffix",c.options.moreLabel)+"</p></td><td width='50%'><p class='glShowAll' id='glShowAll'>"+d.get("loaderShowAll")+"</p></td></tr><tr><td colspan='2' class='glPaginationStats' style='text-align: center !important;'>"+a.count+" "+d.get("loaderOf")+" "+a.total+"</td></tr></table>"},this.bindEvents=function(){$("#glShowMore").click(function(){$("#glShowPanel").empty().append("<p class='giLoadingMore'>"+d.get("loadingAlert")+"&nbsp;<img style='margin-bottom:-10px;' src='/img/icons/loading.gif'></p>"),c.loader.showMore()}),$("#glShowAll").click(function(){$("#glShowPanel").empty().append("<p class='giLoadingMore'>"+d.get("loadingAlert")+"&nbsp;<img style='margin-bottom:-10px;' src='/img/icons/loading.gif'></p>"),c.loader.showAll()})},c.loader=a,c.options=[],c.options.moreLabel=b}function I18n(){var a=this,b=null;this.setContext=function(a){b=contexts[a]},this.get=function(a,c){return b?isDef(b[a])?isDef(c)?b[a][c]:b[a]:isDef(contexts.shared[a])?isDef(c)?contexts.shared[a][c]:contexts.shared[a]:void 0:""},this.format=function(b){for(var c=a.get(b),d="",e=0,f="",g=0;g<c.length;g++){var h=c.charAt(g);"{"==h&&0==e?e=1:"{"==h&&1==e?e=2:"{"!=h&&"}"!=h&&2==e?f+=h:"}"==h&&2==e?(d+=arguments[parseInt(f)+1],e=1,f=""):"}"==h&&1==e?e=0:d+=h}return d},this.transliterate=function(a){if(!I18n.get("isLatin"))return a;var b=I18n.get("symbolMap");return a.replace("Гость","Guest").split("").map(function(a){return ifDef(b[a],a)}).join("")},this.getMonth=function(a){return contexts.months[a]},this.getMonthShort=function(a){return contexts.monthsShort[a]},this.getMonthBeta=function(a){return contexts.monthsBeta[a]}}function Queue(){var a=[],b=0;this.length=function(){return a.length-b},this.isEmpty=function(){return a.length-b==0},this.enqueue=function(b){a.push(b)},this.dequeue=function(){if(0==a.length)return void 0;var c=a[b];return b++,c},this.peek=function(){return a.length>0?a[b]:void 0}}var KEY_ESC=27,KEY_A=65,KEY_B=66,KEY_D=68,KEY_T=84,KEY_W=87,KEY_X=88,KEY_Y=89,KEY_Z=90,KEY_LEFT_ARROW=37,KEY_UP_ARROW=38,KEY_RIGHT_ARROW=39,KEY_DOWN_ARROW=40,KEY_F1=112,KEY_F2=113,KEY_F3=114,KEY_F8=119,KEY_F9=120,KEY_0=48,KEY_1=49,KEY_2=50,KEY_3=51,KEY_4=52,KEY_5=53,KEY_6=54,KEY_7=55,KEY_8=56,KEY_9=57;GameTimer.FREEZE_AFTER_SEC=15;var MIN_ACTUAL_ATTEMPT_LENGTH=3,HIDE_SINGLE_PANEL=0,HIDE_ALL_PANELS=1,OVER_FIELD_PANEL=0,BOTTOM_PANEL=1,PLAYED_GAME_COLOR="#FFE0EE",WON_GAME_COLOR="#FFFFE0",KEY_ENTER=13,KOSYNKA_GAME_VARIATION_ID=1,FREECELL_GAME_VARIATION_ID=2,CHESS_GAME_VARIATION_ID=3,SPIDER_4S_GAME_VARIATION_ID=4,SPIDER_1S_GAME_VARIATION_ID=5,SPIDER_2S_GAME_VARIATION_ID=6,SOKOBAN_GAME_VARIATION_ID=7;BottomSubPanel.maxId=0,function(a,b){setTimeout(function(){try{var c,d='<div id="btnScrollUp" style="position: fixed;  display: block;    bottom: 15px;    left: 15px;    padding-left: 5px;    padding-right: 5px;    font-size: 16pt;    border: 1px solid black;    border-radius: 5px;    cursor: pointer;">'+contexts.shared.btnUp+"</div>",e=!1,f=!1,g=.7*b.screen.height||100;$(b).bind("scroll",function(){b.scrollY>g?e?f||($(c).show(),f=!0):($(a.body).append(d),c=$("#btnScrollUp"),e=!0,f=!0,$(c).click(function(){b.scrollTo(0,0)})):e&&f&&($(c).hide(),f=!1)})}catch(h){console.log(h)}},1e3)}(document,window),setTimeout(function(){if(window._isVk||window._isVK)try{$("#changePassword").hide()}catch(a){console.log(a)}},1e3);var Template=function(){function a(a,c,d){isDef(c)&&c||(c={});var e="",f=!0;return d&&_.isFunction(d)||(f=!1),b(a,function(a,b){if(b)try{e=_.template(b,c)}catch(g){console.log(g)}f&&d(e)},f),f?void 0:e}function b(a,b,d){var e=c[a];!e||_.isUndefined(e)?$.ajax({url:"../templates/"+a,async:d}).done(function(d){return d?(e=d,c[a]=e,void b(null,e)):(console.log("ajax return nothing! "+a),void b("error",null))}).error(function(c){console.log("no template! "+a,c),b("error",null)}):b(null,e)}var c={};return{get:a}}(),ErrorReporter=function(){function a(){window.onerror=function(a,d,e){if(1==window._reportErrors&&"Error loading script"!=a&&e&&!(parseInt(e)<2)){if(d&&e){if(c[e+d])return;c[e+d]=!0}b({errorMessage:a,url:d,line:e})}},isDef(window._gameVariationId)||(window._gameVariationId=0)}function b(a){try{$.ajax({url:"/gw/error.php",type:"POST",data:{errorMessage:a.errorMessage,url:a.url,line:a.line,gameVariationId:window._gameVariationId}})}catch(b){console.log(b)}}a();var c={};return{sendError:function(a){isDef(a.errorMessage)||(a.errorMessage=a.message),isDef(a.url)||(a.url=""),isDef(a.line)||(a.line=""),b(a)}}}();!function(){function a(){console.log("showGameInfo"),d=$("<div />").html(e).appendTo("body").attr("id","logicGameStats"),d.find(".closeIcon").on("click",function(){d.hide()}),d.find(".logic-table-edit").blur(c),d.hide(),d.draggable(),b()}function b(){$.post("/admin/gameStats.php",{load:!0,gameVariationId:_gameVariationId},function(a){console.log(a),"null"!=a&&(a=JSON.parse(a),d.find("#logic-table-date").html(a.date),d.find("#logic-table-ss").html(a.ss),d.find("#logic-table-vk").html(a.vk),d.find("#logic-table-advert").html(a.advert)),d.show()})}function c(){var a={date:d.find("#logic-table-date").html(),ss:d.find("#logic-table-ss").html(),vk:d.find("#logic-table-vk").html(),advert:d.find("#logic-table-advert").html()};console.log(a),$.post("/admin/gameStats.php",{save:!0,gameVariationId:_gameVariationId,data:JSON.stringify(a)})}var d,e='<img class="closeIcon" src="//logic-games.spb.ru/v6-game-client/app/i/close.png"> <table> <tr><td>Дата выпуска</td>   <td id="logic-table-date" contenteditable class="logic-table-edit"></td></tr><tr> <td>Сервер</td>     <td id="logic-table-ss" contenteditable class="logic-table-edit"></td></tr> <tr> <td>Вконтакте</td>     <td id="logic-table-vk" contenteditable class="logic-table-edit"></td></tr> <tr> <td>Реклама</td> <td id="logic-table-advert" contenteditable class="logic-table-edit"></td></tr> </table>';try{$(document).ready(function(){setTimeout(function(){try{var b=window.cs||(window.controller?window.controller.getClientServer():null);b.isSuperUser()&&a()}catch(c){console.log(c)}},2e3)})}catch(f){console.log(f)}}(document,window);var Resizer=function(a){function b(){console.log("Resizer setNewIframeSize",d,a.height()),d=a.height(),window.VK.callMethod("resizeWindow",e,d)}a=a||"main-wrapper",a=$("#"+a);var c=window._isVk||window._isVK||window.isVk||window.isVK;if(console.log("Resizer setup",c,window.VK,a),a.length&&$&&c&&window.VK&&window.VK.callMethod){var d,e=$(document).width();e=e>1e3?1e3:e,b(),setInterval(function(){a.height()!=d&&b()},100)}};try{$(document).ready(function(){setTimeout(function(){try{Resizer()}catch(a){console.log(a)}},100)})}catch(e){console.log(e)}$(document).ready(function(){var a=document.getElementById("under-field")?"#under-field":"#field",b=$(a);if(window._lang&&!window._isFb&&!window._isVk){var c,d,e=$("<a>");"en"==window._lang?(c="ru",d="РУ"):(c="en",d="EN"),e.html(d).attr("href","?lang="+c).addClass("switchLocale"),b.append(e),e.css({top:b.height()+8,left:b.width()+20,position:"absolute"})}window._lang&&"ru"!=window._lang?$(".lg-vkgroup").hide():window._isVk||b.append($(".lg-vkgroup").css({top:b.height()-52,left:b.width()+19}))});var BEGIN_NEW_ATTEMPT=1,RESTORE_LAST_ATTEMPT=2,LOGOUT_GATEWAY="/gw/logout.php",UNKNOWN_REASON=0,NOT_LOGGED=1,GTW_UPDATE_USER_SETTINGS="/gw/shared/updateUserSettings.php",PM_PLAY_RANDOM=0,PM_PLAY_SUCC=1,GT_ALL=0,GT_EASY=1,GT_NORMAL=2,GT_HARD=3,GT_UNSOLVED=4,GT_UNPLAYED=5,PF_ALL=0,PF_NOTWON=1,PF_NOTPLAYED=2,CHECK_USERNAME_GATEWAY="/gw/checkUsername.php",REG_GATEWAY="/gw/registerNewUser.php",LOGIN_GATEWAY="/gw/login.php",RES_GATEWAY="/gw/restorePass.php",CNP_GATEWAY="/gw/changePass.php",GTW_HISTORY="/gw/shared/loadHistory.php",GTW_SAVE_COMMENT="/gw/shared/saveComment.php",GH_GAME_LIMIT=31999,GH_SORT_BY_GAME_ID=0,GH_SORT_BY_WIN_TIME_RANK=1,GH_SORT_BY_BEST_ATTEMPT_RANK=2,GH_SORT_BY_DATE=3,NOT_WON_STATUS=0,WIN_STATUS=1,GH_SHOW_ALL_FILTER=0,GH_SHOW_ONLY_FAV_FILTER=1,GH_SHOW_ONLY_UNSOLVED_FILTER=2,HISTORY_SHOW_SHORTCUTS_AFTER=35,DESC=!1,ASC=!0,HISTORY_PAGINATOR_COUNT=250,INBOX=0,OUTBOX=1,SHOW_MAIN_TAB=0,SHOW_SUBTAB=1;PlayerProfile.BOUND=!1,PlayerProfile.renderProfile=function(a,b){b=ifDef(b,!1);var c="<div class='playerProfile'><table class='playerProfileLayout'><tr>",d="";if(null==a.photoThumb&&(d=" profilePhotoBorder"),c+="<td style='width: 1%; text-align: left; padding-right: 10px;'><div class='profilePhotoFrame"+d+"'>"+(null==a.photoThumb?"<img class='profilePhoto' src='/images/nophoto-"+I18n.get("locale")+".png' />":"<a href='"+a.photo+"' rel='lightbox'><img class='profilePhoto' src='"+a.photoThumb+"' /></a>")+"</div></td>",c+="<td>"+PlayerProfile.renderProfilePI(a)+(b?"":"<div class='constantWidthBtn nonSelectable pdSendMsg' id='sendMsg"+a.playerId+"'>"+I18n.contextGet("profile","pdSendPMButtonLabel")+"</div>")+"</td>",c+="</tr>",!b){var e="undefined"==typeof controller?cs:controller.cs;e=!!e&&e.isSuperUser(),c+="<tr><td colspan='2'><div class='pdSendMsgResult' id='pdSendMsgResult"+a.playerId+"'></div><div class='pdSendMsgPanel' id='pdSendMsgPanel"+a.playerId+"'><div class='pdSendMsgPanelPadding'><h4>"+I18n.contextGet("profile","pdRecipientHeaderPrefix")+" &laquo;"+a.playerName+"&raquo;</h4><textarea id='pdMsg"+a.playerId+"' style='width: 100%'></textarea>"+(e?"<input type='checkbox' id='pdFromAdmin'>От Админа</input>":"")+"<div class='constantWidthBtn nonSelectable pdSendMsgBtn' id='pdSendMsgBtn"+a.playerId+"'>"+I18n.contextGet("profile","pdSendButtonLabel")+"</div><div class='clear'></div></div></div></td></tr>"}return c+="</table></div>"},PlayerProfile.renderProfilePI=function(a,b){var b=ifDef(b,!0),c="";a.birthDay>0&&a.birthMonth>0&&(c=a.birthDay+" "+I18n.contextGet("monthsBeta",a.birthMonth)),a.birthYear>0&&(""!=c&&(c+=" "),c+=a.birthYear);var d=a.about.replace(/\n/gi,"<br />");return'<table class="playerProfileTable" style=" width: 100%;word-wrap: break-word; table-layout: fixed; "><tr><td>'+I18n.contextGet("profile","birthdayLabel")+": </td><td>"+filterField(c)+"</td></tr><tr><td>"+I18n.contextGet("profile","fromwhereLabel")+": </td><td>"+filterField(a.fromwhere)+"</td></tr><tr><td>"+I18n.contextGet("profile","linkLabel")+": </td><td>"+filterLink(a.validLink,a.link)+"</td></tr>"+(b?"":'<tr><td title="Для восстановления пароля">'+I18n.get("email")+'</td><td title="Для восстановления пароля">'+filterField(a.mail)+"</td></tr>")+"<tr><td>"+I18n.contextGet("profile","aboutLabel")+": </td><td>"+filterField(d)+"</td></tr><tr><td>"+I18n.contextGet("profile","regDateLabel")+": </td><td>"+formatDateRu(a.regTimeTS)+"</td>"+(a.lastActiveTS?"</tr><tr><td>Последнее посещение сайта: </td><td>"+formatDateRu2(a.lastActiveTS)+"</td></tr>":"")+"</table>"};var GTW_USERNAME_FILTER="/gw/shared/usernameFilter.php",GTW_RATINGS="/gw/shared/loadRatingsBySolvedCount.php",GTW_PLAYER_DETAIL="/gw/shared/loadPlayerDetail.php",SHOW_DUP_USER_ROW_AFTER=20,MAX_VISIBLE_USERNAME_LENGTH=17,SHOW_SHORTCUTS_AFTER=35,OFFLINE_COLOR="#FFFFFF",ONLINE_COLOR="#D7FACF",INACTIVE_COLOR="#EFF9DB",RL_SHOW_ALL_RATINGS=0,RL_SHOW_ONLINE_RATINGS=1,RL_SHOW_GUEST_RATINGS=2,RL_SHOW_COMMON_RATING=3,RL_SORT_BY_SOLVED_COUNT=0,RL_SORT_BY_BA_RANK=1,RL_SORT_BY_WT_RANK=2,RL_SORT_BY_PLAYED_COUNT=3,RL_SORT_BY_SOLVED_RATIO=4,RL_SORT_BY_REG_DATE=5,RL_SORT_BY_TOTAL_GAME_TIME=6,RL_SORT_BY_AVERAGE_WIN_TIME=7,RL_SORT_BY_TOTAL_GAME_RATING=8,RL_SORT_BY_TOTAL_WIN_TIME=9,RL_SORT_BY_BEST_COUNT=10,RL_DEFAULT_LOAD_COUNT=500,rlFilter=RL_SHOW_ALL_RATINGS,rlSortBy=RL_SORT_BY_SOLVED_COUNT,rlOrder=!0,DESC=!1,ASC=!0,GWT_GAMELIST="/gw/shared/loadGameList.php",GWT_PLAYERLIST="/gw/shared/loadPlayerList.php",GL_SORT_BY_GAME_ID=0,GL_SORT_BY_GAME_RATING=1,GL_SORT_BY_TOTAL_WON=2,GL_SORT_BY_TOTAL_PLAYED=3,GL_SORT_BY_PLAYER_RATING=4,GL_SORT_BY_TOTAL_GAME_RATING=5,GL_SORT_BY_DIFFICULT=6,GL_ALL=0,GL_WON_ONLY=1,GL_PLAYED_ONLY=2,GL_DEFAULT_LOAD_COUNT=250,DESC=!1,ASC=!0,GTW_GAMEINFO="/gw/shared/loadGameInfo.php",GTW_SAVE_COMMENT="/gw/shared/saveComment.php",X_MARGINS=40,RatingRender=function(){function a(a){if(!a||!a.length)throw new Error("No columns to set!");Q=[];for(var b=0;b<a.length;b++)Q.push(new D(a[b]));V=null}function b(a){if(!a||!a.length)throw new Error("No tabs to set!");R=a,R[0].active=!0,E=R[0].id}function c(a){if(!a||!a.length)throw new Error("No tabs to set!");S=a,S[0].active=!0,F=S[0].id}function d(b){var c="",d="",e="",j="",l="";return isDef(b.tabs)&&b.tabs&&a(b.tabs),isDef(b.columns)&&b.columns&&a(b.columns),isDef(b.sort)&&b.sort&&x(y(b.sort.column),b.sort.order),l=f(),l+=g(),d=h(),isDef(b.infoUser)&&b.infoUser&&(V=b.infoUser),V&&(d+=i(V)),isDef(b.infoAllUsers)&&b.infoAllUsers&&(e=k(b.infoAllUsers)),c=Template.get("rating/table.html",{head:d,body:e}),b.infoAllUsers&&b.infoAllUsers.length>=T&&(j=Template.get("rating/div_show_more.html",{count:T})),Template.get("rating/div_main.html",{data:c+j,tabs:l})}function e(a){C(),isDef(a.infoAllUsers)&&a.infoAllUsers&&$(".rating-table > tbody:last").append(k(a.infoAllUsers)),a.infoAllUsers&&a.infoAllUsers.length>=T?$("#ratingShowMore").show():$("#ratingShowMore").hide(),m()}function f(){var a,b="";for(a=0;a<R.length;a++)b+=Template.get("rating/tab.html",{id:"tab_"+R[a].id,tabid:R[a].id,title:R[a].title,cclass:R[a].active?"rating_link_active":"rating_link_unactive"});return b}function g(){if(0==S.length)return"";var a,b="<br>";for(a=0;a<S.length;a++)b+=Template.get("rating/tab.html",{id:"stab_"+S[a].id,tabid:S[a].id,title:S[a].title,cclass:S[a].active?"rating_link_active":"rating_link_unactive"});return b}function h(){var a,b,c="",d="";
for(a=0;a<Q.length;a++)b=Q[a],c+=Template.get(b.isSorted()?"rating/th_sort.html":"rating/th.html",{title:"",data:b.title,id:null}),d+=b.id==H?Template.get("rating/th_rate.html",{}):b.id==I?Template.get("rating/th_name.html",{value:X}):Template.get(b.isSorted()?"rating/th_sort.html":"rating/th.html",{title:b.toptitle,id:b.id,data:null!=b.order?'<img src="'+M[b.order+1]+'">':""});return c=Template.get("rating/tr_head.html",{height:40,data:c}),d=Template.get("rating/tr_head.html",{height:30,data:d}),c+d}function i(a){"function"==typeof Y.onEach&&Y.onEach(a);var b,c,d="";for(b=0;b<Q.length;b++)c=Q[b],d+=c.id==H?Template.get("rating/td_user_rate.html?v=1"):c.id==I?Template.get("rating/td_user_name.html?v=1",a):j(a,c);return Template.get("rating/tr_user.html?v=1",{userid:a.userid,username:"",rank:"",data:d})}function j(a,b){var c,d="",e="";switch(b.isSorted()&&(G=b),b.id){case H:return Template.get("rating/td.html?v=1",{id:b.id,cclass:"",style:"",title:"",other:"",data:a.rank});case I:a.username=a.username.substr(0,20);var f="";return isDef(a.photo)&&a.photo&&("http"!=a.photo.substring(0,4)&&(a.photo="/images/profile/"+a.photo),f=Template.get("rating/div_phot.html",a)),Template.get("rating/td.html?v=1",{id:b.id,cclass:"",style:"",title:"",other:L+'="'+a.userid+'"',data:Template.get("rating/div_name.html?v=1",a)+f});default:return c=a[b.id],b.isDate&&("string"==typeof c&&(c=Date.parse(c.substr(0,10))),c=new Date-c<1728e5?P:formatDate(c/1e3)),d=(b.isClicked()?J:"")+(b.isGrey?K:""),b.sup&&isDef(a[b.id+"_sup"])&&(c=Template.get("rating/div_sup.html",{data:c,data_sup:a[b.id+"_sup"]?"+"+a[b.id+"_sup"]:""})),Template.get("rating/td.html?v=1",{id:b.id,cclass:""!=d?'class = "'+d+'"':"",style:e?'style = "'+e+'"':"",title:b.tooltip&&isDef(a[b.id+"_tooltip"])?'title="'+a[b.id+"_tooltip"]+'"':"",other:"",data:c})}}function k(a){for(var b="",c=0;c<a.length&&T>c;c++)a[c]&&(b+=l(a[c]));return b}function l(a){"function"==typeof Y.onEach&&Y.onEach(a,{sort:r(),filter:q(),tabid:E,subtabid:F,limit:s()});var b,c="";for(b=0;b<Q.length;b++)c+=j(a,Q[b]);return Template.get("rating/tr.html",{cclass:a.online&&"0"!=a.online?"0"!=a.active?O:N:"",style:"",title:"",other:"",data:c,userid:a.userid})}function m(){var a,b;for($("#rating_close_icon").click(A),$("#rating_close_btn").click(A),$("#jump-top").click(B),$("#ratingShowMore").click(p),$(".rating-profile").click(v),b=0;b<Q.length;b++)a=Q[b],null!=a.order&&$("#"+a.id).click(n),a.isClicked()&&$(".rating-table-clickcol").click(o);for(b=0;b<R.length;b++)$("#tab_"+R[b].id).click(t);for(b=0;b<S.length;b++)$("#stab_"+S[b].id).click(u);$("#rating-autocomplete").keydown(function(a){13==a.which&&(z(this.value),a.preventDefault())}),Y.autocomplete&&$("#rating-autocomplete").autocomplete({source:Y.autocomplete})}function n(a){var b=y(a.currentTarget.id);if(!b)throw new Error("No column with id: "+a.currentTarget.id);x(b,b.nextSort()),U=0,"function"==typeof Y.onColumnClick&&Y.onColumnClick({sort:r(),filter:q(),tabid:E,subtabid:F,limit:s(),column:b})}function o(a){console.log(a.currentTarget);var b=a.currentTarget.getAttribute("idcol"),c=y(b),d=a.currentTarget.parentNode.getAttribute("userid");c.click({userid:d,columnid:b,tabid:E,subtabid:F,filter:q(),column:c})}function p(){U+=T,"function"==typeof Y.onShowMore&&Y.onShowMore({sort:r(),filter:q(),tabid:E,subtabid:F,limit:s()})}function q(){return X=$("#rating-autocomplete").val()||"",X.trim()}function r(){if(!G||!G.isSorted())return null;var a={};return a[G.id]=G.order<0?"DESC":"ASC",a}function s(){return{offset:U,limit:T}}function t(a){var b,c=a.currentTarget.getAttribute("tabid");"admin"==c&&(window.location="/admin");for(var d=0;d<R.length;d++)R[d].id==c?(b=R[d],b.active=!0,$("#tab_"+b.id).removeClass("rating_link_unactive").addClass("rating_link_active"),E=b.id):(R[d].active=!1,$("#tab_"+R[d].id).removeClass("rating_link_active").addClass("rating_link_unactive"));U=0,"function"==typeof Y.onTabClicked&&Y.onTabClicked({sort:r(),filter:q(),tabid:E,subtabid:F,limit:s()})}function u(a){for(var b,c=a.currentTarget.getAttribute("tabid"),d=0;d<S.length;d++)S[d].id==c?(b=S[d],b.active=!0,$("#stab_"+b.id).removeClass("rating_link_unactive").addClass("rating_link_active"),F=b.id):(S[d].active=!1,$("#stab_"+S[d].id).removeClass("rating_link_active").addClass("rating_link_unactive"));U=0,"function"==typeof Y.onTabClicked&&Y.onTabClicked({sort:r(),filter:q(),tabid:E,subtabid:F,limit:s()})}function v(a){var b=a.currentTarget.getAttribute("userid"),c=a.currentTarget.getAttribute("username");"function"==typeof Y.onUserClick&&Y.onUserClick({userid:b,username:c,tabid:E,subtabid:F})}function w(a){for(var b=0;b<S.length;b++)S[b].id==a?(tab=S[b],tab.active=!0,$("#stab_"+tab.id).removeClass("rating_link_unactive").addClass("rating_link_active"),F=tab.id):(S[b].active=!1,$("#stab_"+S[b].id).removeClass("rating_link_active").addClass("rating_link_unactive"))}function x(a,b){for(var c=0;c<Q.length;c++)Q[c]==a?(a.order=b,G=a):null!=Q[c].order&&(Q[c].order=0)}function y(a){if(Q&&Q.length>0)for(var b=0;b<Q.length;b++)if(Q[b].id==a)return Q[b];return null}function z(){U=0,"function"==typeof Y.onFilter&&Y.onFilter({sort:r(),filter:q(),tabid:E,subtabid:F,limit:s()})}function A(){"function"==typeof Y.onClose&&Y.onClose()}function B(){$("html, body").animate({scrollTop:$(".rating-table").offset().top-50})}function C(){var a;for($("#rating_close_icon,#rating_close_btn,#jump-top,.rating-profile,.rating-table-clickcol,#ratingShowMore").unbind("click"),a=0;a<Q.length;a++)$("#"+Q[a].id).unbind("click");for(a=0;a<R.length;a++)$("#tab_"+R[a].id).unbind("click");for(a=0;a<S.length;a++)$("#stab_"+S[a].id).unbind("click");$("#rating-autocomplete").unbind("keydown")}function D(a){var b=this;this.id=a.id,this.title=a.title,this.toptitle=isDef(a.toptitle)?a.toptitle:this.title,this.order=isDef(a.order)?a.order:null,this.sup=isDef(a.sup)?a.sup:!1,this.tooltip=isDef(a.tooltip)?a.tooltip:!1,this.click=isDef(a.onClick)&&"function"==typeof a.onClick?a.onClick:null,this.isDate=isDef(a.isDate)?a.isDate:!1,this.isGrey=isDef(a.isGrey)?a.isGrey:!1,this.isSorted=function(){return null!=b.order&&0!==b.order},this.isClicked=function(){return!!b.click},this.nextSort=function(){if(null==b.order)return null;switch(b.order){case 0:return 1;case 1:return-1;case-1:return 1}return null}}var E,F,G,H="rank",I="username",J=" rating-table-clickcol ",K=" rating-table-greycol ",L="data-rating-userid",M=["/img/icons/sort-asc.png","/img/icons/sort-both.png","/img/icons/sort-desc.png"],N='class="rplayer-online"',O='class="rplayer-active"',P='<span style="color: #C42E21 !important;">новичок</span>',Q=[],R=[],S=[],T=500,U=0,V=null,W=null,X="",Y={onColumnClick:null,onClose:null,onFilter:null,onTabClicked:null,onUserClick:null,onShowMore:null,autocomplete:null};return{setDiv:function(a){a&&(W="string"==typeof a?$("#"+a):a)},render:function(a){if(!W)return d(a);if(!$(W))throw new Error("no div for table!");return $(W).html(d(a)),m(),!0},append:e,bindEvents:function(){m()},setColumns:a,setTabs:b,setSubTabs:c,onColumnClick:function(a){return"function"==typeof a&&(Y.onColumnClick=a),this},onTabClicked:function(a){return"function"==typeof a&&(Y.onTabClicked=a),this},onUserClick:function(a){return"function"==typeof a&&(Y.onUserClick=a),this},onClose:function(a){return"function"==typeof a&&(Y.onClose=a),this},onFilter:function(a){return"function"==typeof a&&(Y.onFilter=a),this},onEach:function(a){return"function"==typeof a&&(Y.onEach=a),this},onShowMore:function(a){return"function"==typeof a&&(Y.onShowMore=a),this},autocomplete:function(a){return"function"==typeof a&&(Y.autocomplete=a),this},unbind:function(){return C(),this},setCurrentSubTab:w}}(),LogicGame=function(){function a(b){var c,d=this,e=-2;d.globalAsync=!0,d.globalTimeout=15e3,this.isLogged=function(){return!d.isGuest()},this.getGameVariationId=function(){return c},this.sendBeacon=function(a,b,c){e++,(e>=a||-1==e)&&(e=0,$.ajax({url:"/gw/beacon.php",type:"POST",data:{nocache:(new Date).getTime(),sessionId:d.getSessionId(),userId:d.getUserId(),gameVariationId:d.getGameVariationId()},timeout:b,async:!0}).done(function(a){var b=parseJSON(a);null!=b&&"ok"==b.status&&isDef(c)&&c(!0,b)}).error(function(){isDef(c)&&c(!1)}))},multiExtendClass(a,ProfileClientServer,this),multiExtendClass(a,SharedClientServer,this),c=b,d.attemptLocalStorage=new AttemptLocalStorage(d)}function b(a){var d,f,g=this;g.gameURL=location.href.substr(0,location.href.lastIndexOf("/")+1);var h=27;this.getClientServer=function(){return d},this.setup=function(){jQuery(document).keydown(this.keyDown),g.ui=e=new c(this),g.cs=d,f=new Beacon(this,e);var a=$.timer(function(){f.sendBeacon()});a.set({time:1e3,autostart:!0})},this.keyDown=function(a){var b=a.which;b==h&&(g.notifyEsc(),e.hideAllActivePanels())},this.logout=function(){d.logout(function(a){a&&location.reload()})},this.setAboutToLogin=function(a){aboutToLogin=a},multiExtendClass(b,SharedController,this),d=a,g.cs=d}function c(a){var b,d,e=this,f=0;this.showRegPanel=function(){d.showRegMePanel()},multiExtendClass(c,SharedUI,this),e.setGameController(a),e.setupSharedUI();var g=a;e.gc=a,b=new GuestBookRenderer(g,this,null),d=new LoginRegisterManager(_isFreshUser,this,g,{showWelcomePanel:!0}),this.hidePanel=function(a){$(".buttonMenu.downmeny a").removeClass("on"),e.hideAllActivePanels(),a instanceof BottomSubPanel&&(a.fireOnClose(HIDE_SINGLE_PANEL),a.destroy())},this.setGuestUI=function(){$("#bbProfile").hide(),$("#bbLoginRegister").show(),e.showPanel({id:"welcomePanel",type:f})},this.setUserUI=function(){$("#bbProfile").show(),$("#bbLoginRegister").hide(),e.hidePanel("welcomePanel")},this.showGuestBook=function(){b.run()}}function d(){if(!_gameVariationId)throw new Error("_gameVariationId undefined");if(!_sessionId)throw new Error("_sessionId undefined");if(!_userId)throw new Error("_userId undefined");if(!_username)throw new Error("_username undefined");if(window.controller||window.cs||window.ui)throw new Error("client already initialized");var c=new a(_gameVariationId);c.setSessionId(_sessionId),c.setUser(_userId,_username,_isGuest),f=new b(c,null),f.setup(),window.controller=f,window.ui=e,h=!0,"undefined"!=typeof _isGuest&&(_isGuest?e.setGuestUI():e.setUserUI()),g&&g()}var e,f,g,h=!1;return{init:function(a){a&&"function"==typeof a&&(g=a),jQuery?jQuery(document).ready(d):setTimeout(d,1e3)},isSuperUser:function(){return f.cs.isSuperUser()},isInit:function(){return h},hidePanels:function(){e.hideAllActivePanels()},setupVKResizer:function(a){window.Resizer(a)},showGuestBook:function(){e.showGuestBook()}}}();I18n.get=function(a){return isDef(contexts.shared[a])?contexts.shared[a]:""},I18n.contextGet=function(a,b){return isDef(contexts[a])&&isDef(contexts[a][b])?contexts[a][b]:""},I18n.JANUARY=1,I18n.FEBRUARY=2,I18n.MARCH=3,I18n.APRIL=4,I18n.MAY=5,I18n.JUNE=6,I18n.JULY=7,I18n.AUGUST=8,I18n.SEPTEMBER=9,I18n.OCTOBER=10,I18n.NOVEMBER=11,I18n.DECEMBER=12;