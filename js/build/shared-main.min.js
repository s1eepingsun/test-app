/*! 2015-09-18 */
function AttemptLocalStorage(a){var b,c=this;this.load=function(){b=store.get("attemptDelayed_gVId"+c.cs.getGameVariationId()+"_uId"+c.cs.getUserId()),isDef(b)&&b||(b=[])},this.save=function(){store.set("attemptDelayed_gVId"+c.cs.getGameVariationId()+"_uId"+c.cs.getUserId(),b)},this.compareAttemptData=function(a,b){return a.gameId==b.gameId&&a.hash==b.hash||a.gameId==b.gameId&&a.history==b.history||a.gameId==b.gameId&&a.attemptId==b.attemptId},this.sync=function(a){if(!(a.isFresh()||a.isWon()&&-1==a.attemptId)){c.load();var d=!1;for(var e in b){var f=b[e];c.compareAttemptData(f,a.getFreshData())&&(b[e]=a.getFreshData(),d=!0)}d||b.push(a.getFreshData()),c.save()}},this.remove=function(a){c.load();var d=[];for(var e in b){var f=b[e];c.compareAttemptData(a,f)||d.push(f)}b=d,c.save()},this.reuploadAttempts=function(){c.load();for(var a in b){var d=b[a];isDef(d)&&c.cs.reuploadAttempt(d.gameId,null,d,{async:!1})}},c.cs=a}function BottomSubPanel(a){var b,c,d=this,e=null,f=null,g="",h=null;this.getId=function(){return c},this.render=function(){var a="<div class='bubblePanel bottomSubPanel bottomPanel _hackPaddingLayer' id='"+c+"'><img class='closeBottomSubPanelImg' id='closeBottomSubPanel"+b+"' alt='"+I18n.contextGet("ui","closeIconAltText")+"' src='/img/icons/icon_close.png' />"+g+"</div>";$("#bottomArea").append(a),$("#closeBottomSubPanel"+b).click(function(){ui.hidePanel(d)}),ui.showPanel(d)},this.renderContents=function(a){var d="<div id='"+c+"'><img class='closeBottomSubPanelImg' id='closeBottomSubPanel"+b+"' alt='"+I18n.contextGet("ui","closeIconAltText")+"' src='/img/icons/icon_close.png' />"+g+"</div>";$("#"+a).empty().append(d),$("#"+a).show(),$("#closeBottomSubPanel"+b).click(function(){null!=e&&e()})},this.generatePanelId=function(){b=BottomSubPanel.maxId,c="bottomSubPanel"+b,BottomSubPanel.maxId++,this.id=c},this.destroy=function(){$("#"+c).remove()},this.fillContents=function(a){g=a},this.onClose=function(a){isDef(a)&&(e=a)},this.onShow=function(a){f=a},this.fireOnShow=function(){null!=f&&f()},this.fireOnClose=function(a){null!=e&&e(a)},this.generatePanelId(),h=a}function Beacon(a,b){var c,d,e,f=this,g=0,h=!1,i=now(),j=new I18n;j.setContext("beacon"),this.setNetworkStatus=function(a){"offline"==a?($("#connOnline").hide(),$("#connProblem").hide(),$("#connOffline").show()):"problem"==a?($("#connOnline").hide(),$("#connOffline").hide(),$("#connProblem").show()):"online"==a&&($("#connOffline").hide(),$("#connProblem").hide(),$("#connOnline").show())},this.reportUserActivity=function(){i=now()},this.updateActivity=function(a,b,c){$("#activity").empty().append(j.format("activityString",a,b,c))},this.sendBeacon=function(){var a=60,b=5e3;g>0&&(b=15e3),e.sendBeacon(a,b,msToSec(i-now()),function(a,b){a?(f.updateActivity(b.guestCount,b.loggedCount,b.regCount),g=0,h=!1,b.unreadMsgCount>-1&&d.updateUnreadMsgCount(b.unreadMsgCount)):g++,0==g?(f.setNetworkStatus("online"),d.hideNotification()):3>g?f.setNetworkStatus("problem"):(f.setNetworkStatus("offline"),h||(h=!0,d.notifyUser(j.get("noConnectionNotice"),!0)))})},this.bindActivityTrackers=function(){$(window).mousemove(function(){f.reportUserActivity()}),$(window).click(function(){f.reportUserActivity()}),$(window).keydown(function(){f.reportUserActivity()}),$(window).bind("scroll",function(){f.reportUserActivity()})},c=a,d=b,e=c.getClientServer(),f.bindActivityTrackers()}function extendClass(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype}function multiExtendClass(a,b,c){var d=function(){};d.prototype=b.prototype,a.prototype=new d,a.prototype.constructor=a,a.superclass=b.prototype,a.superclass.constructor.apply(c),c.super=new Object;for(var e in c)c.super[e]=c[e]}function formatLargeGameTime(a){a=iDiv(a,1e3);var b=a%60,c=iDiv(a,60)%60,d=iDiv(a,3600)%24,e=iDiv(iDiv(a,3600),24),f="";return e>0&&(f=e+" "+I18n.contextGet("time","daysShortSuffix")+" "),f+d+" "+I18n.contextGet("time","hoursSuperShortSuffix")+" "+ext(c,2,"0")+" "+I18n.contextGet("time","minutesShortSuffix")+" "+ext(b,2,"0")+" "+I18n.contextGet("time","secondsShortSuffix")}function formatGameTimeMS(a,b){var b="undefined"==typeof b?!1:b;a=iDiv(a,1e3),a>86400&&(a=86400),0>a&&(a=-a),-1==a&&(a=0);var c=a%60,d=iDiv(a,60)%60,e=iDiv(a,3600);return b?0==d&&0==e?c+"&nbsp;"+I18n.contextGet("time","secondsShortSuffix"):(c>30&&d++,60==d&&(e++,d=0),0==e?d+"&nbsp;"+I18n.contextGet("time","minutesShortSuffix"):e+"&nbsp;"+I18n.contextGet("time","hoursSuperShortSuffix")+"&nbsp;"+d+"&nbsp;"+I18n.contextGet("time","minutesSuperShortSuffix")):0==e?d+":"+ext(""+c,2,"0"):e+":"+ext(""+d,2,"0")+":"+ext(""+c,2,"0")}function formatTime(a,b){var c=";",d=!1;isDef(b)&&isDef(b.separator)&&(c=b.separator),isDef(b)&&isDef(b.clarify)&&(d=b.clarify);var e=new Date(1e3*a),f=e.getHours(),g=e.getMinutes(),h=(e.getSeconds(),e.getDate()),i=e.getMonth()+1,j=(""+e.getFullYear()).substr(2,2),k=ext(h,2,"0")+"."+ext(i,2,"0")+"."+j,l=ext(""+f,2,"0")+":"+ext(""+g,2,"0");if(d&&e.toDateString()==(new Date).toDateString()&&(k=I18n.contextGet("time","today")),isDef(b)&&isDef(b.putTimeInBrackets))var m=k+" ("+l+")";else m=k+c+" "+l;return m}function formatDate(a){var b=new Date(1e3*a),c=b.getDate(),d=b.getMonth()+1,e=(""+b.getFullYear()).substr(2,2),f=ext(c,2,"0")+"."+ext(d,2,"0")+"."+e;return f}function formatDateRu2(a){var b=formatDateRu(a),c=formatDateRu(nowTS());return b==c?"сегодня":b}function formatDateRu(a){var b=new Date(1e3*a),c=b.getDate(),d=b.getMonth()+1,e=""+b.getFullYear(),f=c+" "+I18n.contextGet("monthsBeta",d)+" "+e;return f}function iDiv(a,b){var c=a%b,d=(a-c)/b;return d=d>=0?Math.floor(d):Math.ceil(d)}function isDef(a){return"undefined"!=typeof a}function ifDef(a,b){return isDef(a)?a:b}function trimLeadingZeros(a){for(;a.length>1&&"0"==a.charAt(0);)a=a.substring(1);return a}function boolToInt(a){return a?1:0}function bool2Int(a){return a?1:0}function parseJSON(a){try{return $.parseJSON(a)}catch(b){return null}}function ext(a,b,c){for(c="undefined"==typeof c?"&nbsp;":c,a=""+a;a.length<b;)a=c+a;return a}function genRnd(a,b){return"undefined"==typeof b?Math.floor(Math.random()*a):Math.floor(Math.random()*(b-a))+a}function now(){return(new Date).getTime()}function nowTS(){return iDiv((new Date).getTime(),1e3)}function msToSec(a){return iDiv(a,1e3)}function formatGame(a){return I18n.contextGet("games",a)}function arrayLast(a){return 0==a.length?null:a[a.length-1]}function Listener(){var a=this;a.listeners=new Array,this.addListener=function(b){a.listeners.push(b)},this.removeListener=function(b){for(var c in a.listeners)if(a.listeners[c]==b)return void a.listeners.splice(c,1)},this.notify=function(b){for(var c=0;c<a.listeners.length;c++){var d=a.listeners[c];isDef(d[b])&&d[b]()}}}function hasFunc(a){return"function"==typeof a}function last(a,b){return"undefined"==typeof b?a[a.length-1]:a[a.length-1+b]}function mergeObj(a,b){for(var c in b)a[c]=b[c]}function hash(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function sendMailInvite(){location.replace("mailto:?subject=Рекомендую сыграть&body="+location.href)}function vkAuthOpenAPI(){VK.init({apiId:3960668}),VK.Auth.getLoginStatus(function(a){a.session?location.reload():VK.Auth.login(function(a){a.session&&location.reload()})})}function setCookie(a,b,c,d,e,f){if(!a||!b)return!1;var g=a+"="+encodeURIComponent(b);return c&&(g+="; expires="+c.toGMTString()),d&&(g+="; path="+d),e&&(g+="; domain="+e),f&&(g+="; secure"),document.cookie=g,!0}function SafeSharedUI(){var a=new I18n;a.setContext("ui"),this.renderErrorReason=function(b,c){$(b).empty().append(c==NOT_LOGGED?"<p class='errorMsg'>"+a.get("notLoggedNotice")+"</p>":"<p class='errorMsg'>"+a.get("unknownLoadingErrorNotice")+"</p>")}}function SharedUI(){var a,b,c=this;c.activePanels=[],c.options={showHistoryLength:!1,showGameLabel:!1,showWinCount:!1},c.i18n=new I18n,c.i18n.setContext("ui"),this.setGameController=function(b){a=b},this.getGameController=function(){return a},this.getUserProfile=function(){return b},this.updateUnreadMsgCount=function(a){b.updateUnreadMsgCount(a)},this.hideNotification=function(){},this.notifyUser=function(){},this.alert=function(a){alert(a)},this.setupSharedUI=function(){b=new PlayerProfile(a,this),c.userProfile=b},this.setGuestUI=function(){$("#bbProfile").hide(),$("#bbLoginRegister").show(),c.historyRenderer.onLogout(),"undefined"!=typeof _hack_updateParametersUIOnLogout&&_hack_updateParametersUIOnLogout()},this.setUserUI=function(){$("#bbProfile").show(),$("#bbLoginRegister").hide(),c.historyRenderer.onLogin(),"undefined"!=typeof _hack_updateParametersUIOnLogin&&_hack_updateParametersUIOnLogin(),c.getUserProfile().show()},this.onRegistration=function(){c.hideAllActivePanels(),c.setUserUI()},this.setLoading=function(a){$(a).empty().append("<div style='padding-top: 10px; padding-left:5px; height:25px;'><span style='float: left; color:black;'>"+c.i18n.get("loadingNotice")+"&nbsp;</span><img style='float: left; margin-top: -12px;' src='/img/icons/loading.gif'></div>")},this.serverSortArrowsImg=function(a,b,c){var b=isDef(b)&&""!=b?" style='"+b+"' ":"",c=isDef(c)?" id='"+c+"' ":"";return a?" &nbsp;<img "+b+c+"src='/img/icons/sort-asc.png' alt=''/>":" &nbsp;<img "+b+c+"src='/img/icons/sort-desc.png' alt=''/>"},this.getOrderHint=function(a){return uiGetOrderHint(a)},this.hideHint=function(){$(".floatingHint").remove()},this.bindCloseIcon=function(a,b){$(a).click(function(){c.hidePanel(b)})},this.showHint=function(a,b){$("body").append("<p class='floatingHint' id='floatingHint'>"+b+"</p>"),$("#floatingHint").css("top",$(a).offset().top-53),$("#floatingHint").css("left",$(a).offset().left+25)},this.hasActiveInput=function(){return isDef($("*:focus").attr("id"))},this.updateGameStats=function(){var a=c.gc.getGameManager();if(a){var b=a.getGameId(),d="<span>"+b+"</span>",e=a.getGameInfo(),f="—";e.totalPlayed>0&&(f=(e.avgWinTime>0?formatGameTimeMS(e.avgWinTime):"—")+(c.options.showWinCount?" ("+e.totalWon+"/"+e.totalPlayed+")":"")),f="<span>"+c.i18n.get("ratingLabel")+" "+f+" </span>",c.options.showGameLabel&&(f="<span>"+e.label+"</span> / "+f);var g="";c.options.showHistoryLength&&(g="<span>"+c.i18n.get("historyLengthLabel")+" "+c.gc.getGameManager().getHistoryLength()+"</span>");var h=a.getGameTimer(),i=h.getTime(),j=formatGameTime(i),k=a.getTotalGameTime(),l=formatGameTime(k);if(h.isFrozen())var m="<span class='frozenTime'>"+c.i18n.get("attemptTimeLabel")+" "+j+"</span>",n="<span class='frozenTime'>"+c.i18n.get("gameTimeLabel")+" "+l+"</span>";else m="<span>"+c.i18n.get("attemptTimeLabel")+" "+j+"</span>",n="<span>"+c.i18n.get("gameTimeLabel")+" "+l+"</span>";$("#gameStatePanel").empty().append(d+" / "+f+" / "+(c.options.showHistoryLength?g+" / ":"")+m+" / "+n),$("#gameStatePanel").show()}else c.setGameLoading()},this.attemptsChanged=function(){c.refreshAttempts()},this.refreshAttempts=function(){var a=c.gc.getGameManager();if(a){var b=a.getAttempts(),d=a.getCurrentAttempt(),e=c.i18n.get("attemptsLabel")+": ";if(1==b.length&&b[0].isFresh())e+="—";else for(var f=b.length-1;f>=0;f--){var g=b[f],h="";g==d&&(h=" bigAttempt "),g.isWon()&&(h+=" wonAttempt "),e+="<span id='restoreAttempt"+f+"' class='restoreAttempt"+h+"'>"+(f+1)+"</span> "}$("#attemptsPanel").empty().append(e);for(var f=b.length-1;f>=0;f--)$("#restoreAttempt"+f).click(function(b){return function(){var d=c.gc.getGameManager().getCurrentAttempt();(b.isWon()||b!=d)&&a.restoreAttempt(b)}}(b[f]))}else c.setGameLoading()},this.setGameLoading=function(){$("#attemptsPanel").empty(),$("#gameStatePanel").empty().append("Загрузка игры...")},this.isGameAreaActive=function(){for(var a in c.activePanels){var b=c.activePanels[a];if(b.type==OVER_FIELD_PANEL)return!1}return!0},this.hideAllActivePanels=function(){var a=c.activePanels;c.activePanels=[];for(var b in a){var d=a[b];d.type==OVER_FIELD_PANEL&&$("#welcomeOverlay").hide(),isDef(d.onClose)&&d.onClose(),$("#"+d.id).hide(),d instanceof BottomSubPanel&&isDef(d.destroy)&&d.destroy()}},this.hidePanel=function(a){c.hideAllActivePanels(),a instanceof BottomSubPanel&&(a.fireOnClose(HIDE_SINGLE_PANEL),a.destroy())},this.showPanel=function(a){if(c.hideAllActivePanels(),isDef(a.type)&&a.type==OVER_FIELD_PANEL){var b=document.getElementById("game-field")?"#game-field":"#field";c.centerPanel("#"+a.id,b,"welcomePanel"==a.id),$("#welcomeOverlay").show()}c.activePanels.push(a),$("#"+a.id).show(),a instanceof BottomSubPanel&&a.fireOnShow()},this.centerPanel=function(a,b,c,d){isDef(d)&&d||$(a).css("position","absolute"),isDef(c)&&c||$(a).css("top",$(b).position().top+($(b).height()-$(a).height())/2),$(a).css("left",$(b).position().left+($(b).width()-$(a).width())/2)},multiExtendClass(SharedUI,SafeSharedUI,this),window._isFb||window._isVk?($(".profileLogoutPanel").hide(),$(".share42init").hide(),$("#welcomePanel").hide(),$("#inviteFriend").hide(),$("#showShared").hide(),$(".lg-workbaner").hide()):$(".lg-workbaner").show()}function uiShowHint(a,b){$("body").append("<p class='floatingHint' id='floatingHint'>"+b+"</p>"),$("#floatingHint").css("top",$(a).offset().top-53),$("#floatingHint").css("left",$(a).offset().left+25)}function uiHideHint(){$(".floatingHint").remove()}function uiGetOrderHint(a){return a?"<br /><span style='font-size: 6pt;'> ("+I18n.contextGet("ui","ascOrderHint")+")</span>":"<br /><span style='font-size: 6pt;'> ("+I18n.contextGet("ui","descOrderHint")+")</span>"}function uiSetLoading(a){$(a).empty().append("<div style='padding-top: 15px; padding-left:15px; height:30px;'><span style='float: left; color:#444; font-weight: normal;'>"+I18n.contextGet("ui","loadingNotice")+"...&nbsp;</span><img style='float: left; margin-top: -12px;' src='/img/icons/loading.gif'></div>")}function SharedGameManager(){var a=this;a.currentAttempt=null,a.silent=!1,this.getGameInfo=function(){return a.gameInfo},this.getGameId=function(){return a.gameId},this.getGame=function(){return a.g},this.getGameTimer=function(){return a.currentAttempt.getGameTimer()},this.getTotalGameTime=function(){var b=0;for(var c in a.attempts){var d=a.attempts[c];b+=d!=a.currentAttempt?d.getGameTime():d.getGameTimer().getTime()}return b},this.getHistory=function(){return a.currentAttempt.getHistory()},this.getEncodedHistory=function(){return a.currentAttempt.getEncodedHistory()},this.getAttempts=function(){return a.attempts},this.getCurrentAttempt=function(){return a.currentAttempt},this.getHistoryLength=function(){return a.currentAttempt.getHistory().length},this.applyEncodedHistory=function(b){a.g.notifyGoSilent(!0),a.serializer.applyEncodedHistory(a.g,b),null!=a.currentAttempt&&a.currentAttempt.isWon()&&a.rewind(),a.g.notifyGoSilent(!1)},this.removeAttempt=function(b){for(var c in a.attempts)if(a.attempts[c]==b)return a.attempts.splice(c,1),!0;return!1},this.canUndo=function(){return a.currentAttempt.getHistory().length>0},this.replay=function(){a.finishCurrentAttempt(),a.currentAttempt=new Attempt(a.serializer),a.currentAttempt.setGameId(a.gameId),a.attempts.push(a.currentAttempt),a.g.setupNewGame(),a.notifyAttemptsChange(),a.notifyGameStateUpdate()},this.isWon=function(){return null==a.currentAttempt?!0:a.currentAttempt.isWon()},this.hasUserActivity=function(){a.currentAttempt.getGameTimer().unfreeze()},this.finishCurrentAttempt=function(){var b=hasFunc(a.isGameValueless)?a.isGameValueless():!1;null==a.currentAttempt||a.currentAttempt.finish()&&(a.currentAttempt.isWon()||!b)?null==a.currentAttempt||a.currentAttempt.isWon()||this.notifyAttemptUpdated(a.currentAttempt):this.removeAttempt(a.currentAttempt),a.currentAttempt=null},this.restoreAttempt=function(b){a.finishCurrentAttempt(),a.currentAttempt=b,a.g.setupNewGame();var c=b.getEncodedHistory();a.applyEncodedHistory(c),a.notifyAttemptsChange(),a.notifyGameStateUpdate(),a.notifyAttemptRestored()},this.notifyGameStateUpdate=function(){for(var a=0;a<this.listeners.length;a++){var b=this.listeners[a];isDef(b.gameStateChanged)&&b.gameStateChanged()}this.notifyAttemptsChange()},this.notifyAttemptsChange=function(){for(var a=0;a<this.listeners.length;a++){var b=this.listeners[a];isDef(b.attemptsChanged)&&b.attemptsChanged()}},this.notifyAttemptUpdated=function(b){for(var c=0;c<this.listeners.length;c++){var d=this.listeners[c];isDef(d.attemptUpdated)&&d.attemptUpdated(a.gameId,b)}this.notifyAttemptsChange()},this.notifyAttemptRestored=function(){for(var a=0;a<this.listeners.length;a++){var b=this.listeners[a];isDef(b.attemptRestored)&&b.attemptRestored()}},this.addListener=function(a){this.listeners.push(a)},this.gameIsWon=function(){a.currentAttempt.isWon()||(a.currentAttempt.win(),this.notifyAttemptUpdated(a.currentAttempt),this.notifyAttemptsChange())},this.wentSilent=function(b){a.silent!=b&&(a.silent=b,a.silent||this.notifyGameStateUpdate())},this.setupSharedGameManager=function(){a.listeners=new Array}}function SharedController(){var a=this;a.i18n=new I18n,a.i18n.setContext("controller"),this.reloadPage=function(){window.location.href=a.gameURL},this.isGameLoaded=function(){return null!=a.gm},this.setupSharedController=function(){var b;$("#tbUndo").click(function(){a.isGameActive()&&a.gm.undo()}).mousedown(function(){clearInterval(b),b=setInterval(function(){clearInterval(b),b=setInterval(function(){a.isGameActive()?a.gm.undo():clearInterval(b)},50)},400)}).mouseup(function(){clearInterval(b)}).mouseout(function(){clearInterval(b)}),$("#tbRedo").click(function(){a.isGameActive()&&a.gm.redo()}).mousedown(function(){clearInterval(b),b=setInterval(function(){clearInterval(b),b=setInterval(function(){a.isGameActive()?a.gm.redo():clearInterval(b)},50)},400)}).mouseup(function(){clearInterval(b)}).mouseout(function(){clearInterval(b)}),$("#tbNewGame").click(function(){a.isGameActive()&&(a.isGameValueless()||confirm(a.i18n.get("startNewGamePrompt")))&&a.startNextGame()}),$("#tbReplay").click(function(){a.isGameActive()&&(a.isGameValueless()||confirm(a.i18n.get("replayGamePrompt")))&&a.replay()})},this.startNextGame=function(b){a.requestGame(-1,-1,b,BEGIN_NEW_ATTEMPT)},this.replay=function(){a.notifyNewAttemptStarted(),a.gm.replay()},this.attemptUpdated=function(b,c){isDef(a.__attemptUpdated)&&a.__attemptUpdated(b,c),c.isWon()?a.ui.showCongratulations(function(){a.cs.uploadAttempt(b,c,function(b,c){b&&isDef(c.bonus)&&a.ui.renderBonus(c.bonus)})}):a.cs.uploadAttempt(b,c)},this.notifyEsc=function(){for(var b=0;b<a.listeners.length;b++){var c=a.listeners[b];isDef(c.escKeyDown)&&c.escKeyDown()}},multiExtendClass(SharedController,Listener,this)}function ProfileClientServer(){var a=this;this.loadProfile=function(b,c){null==b&&(b=a.getUserId()),$.post("/gw/profile/loadProfile.php",{sessionId:a.getSessionId(),userId:a.getUserId(),playerId:b},function(b){a.setRecentData(b);var d=parseJSON(b);null!=d&&"ok"==d.status?c(!0,d.profile):c(!1)})},this.updateProfile=function(b){$("#profileForm").ajaxSubmit({data:{sessionId:a.getSessionId(),userId:a.getUserId(),preupload:0},success:function(c){a.setRecentData(c);var d=parseJSON(c);null!=d&&"ok"==d.status?b(!0,d):b(!1)}})},this.preuploadPhoto=function(b){$("#profileForm").ajaxSubmit({data:{sessionId:a.getSessionId(),userId:a.getUserId(),preupload:1},success:function(c){a.setRecentData(c);var d=parseJSON(c);null!=d&&"ok"==d.status?b(!0,d):b(!1)}})},this.loadConversations=function(b){$.post("/gw/profile/loadConversations.php",{sessionId:a.getSessionId(),userId:a.getUserId()},function(c){a.setRecentData(c);var d=parseJSON(c);null!=d&&"ok"==d.status?b(!0,d.conversations):b(!1)})},this.sendMessage=function(b,c,d,e,f){$.post("/gw/profile/sendMessage.php",{sessionId:a.getSessionId(),userId:a.getUserId(),gameVariationId:a.getGameVariationId(),recipient:b,msg:c,replyTo:d,fromAdmin:e},function(b){a.setRecentData(b);var c=parseJSON(b);null!=c&&"ok"==c.status?isDef(f)&&f(!0):isDef(f)&&f(!1)})},this.sendMassMsg=function(b,c,d){$.post("/gw/profile/sendMassMsg.php",{sessionId:a.getSessionId(),userId:a.getUserId(),gameVariationId:a.getGameVariationId(),text:b,recipientList:$.toJSON(c)},function(b){a.setRecentData(b);var c=parseJSON(b);null!=c&&"ok"==c.status?isDef(d)&&d(!0):isDef(d)&&d(!1)})},this.loadConversation=function(b,c){$.post("/gw/profile/loadConversation.php",{sessionId:a.getSessionId(),userId:a.getUserId(),opponent:b},function(b){a.setRecentData(b);var d=parseJSON(b);null!=d&&"ok"==d.status?isDef(c)&&c(!0,d):isDef(c)&&c(!1)})},this.loadRecipients=function(b){$.post("/gw/profile/loadRecipients.php",{sessionId:a.getSessionId(),userId:a.getUserId()},function(c){a.setRecentData(c);var d=parseJSON(c);null!=d&&"ok"==d.status?isDef(b)&&b(!0,d.recipients):isDef(b)&&b(!1)})},this.updateUserSettings=function(a,b){cs.sendRequest("/gw/profile/updateUserSettings.php",{isInvisible:boolToInt(a.isInvisible)},b)}}function SharedClientServer(){var a,b,c,d,e=this,f="",g=-2;this.setSessionId=function(b){a=b},this.getSessionId=function(){return a},this.setUser=function(a,e,f){b=a,c=e,d=f},this.getUserId=function(){return b},this.getUsername=function(){return c},this.isGuest=function(){return d},this.isLogged=function(){return!d},this.isSuperUser=function(){return 40==b||144==b||19729==b||18136==b||448039==b||80911==b||460981==b||708734==b||3172467==b||7123667==b||6720145==b},this.setRecentData=function(a){f=a},this.getRecentData=function(){return f},this.goSynchronous=function(){jQuery.ajaxSetup({async:!1})},this.sendRequest=function(a,b,c){isDef(b.sessionId)||(b.sessionId=e.getSessionId()),isDef(b.userId)||(b.userId=e.getUserId()),isDef(b.gameVariationId)||(b.gameVariationId=e.getGameVariationId()),$.post(a,b,function(a){e.setRecentData(a);var b=parseJSON(a);if(null!=b&&"ok"==b.status)isDef(c)&&(isDef(b.data)?c(!0,b.data):c(!0));else{var d=UNKNOWN_REASON;"notlogged"==b.status&&(d=NOT_LOGGED),isDef(c)&&c(!1,null,{reason:d})}})},this.logout=function(a){e.sendRequest(LOGOUT_GATEWAY,{},function(b,c){b?(e.setUser(c.userId,c.username,!0),isDef(a)&&a(!0)):isDef(a)&&a(!1)})},this.loadGameInfo=function(a,b){$.post("gw/loadGameInfo.php",{sessionId:e.getSessionId(),userId:e.getUserId(),gameId:a},function(a){e.setRecentData(a);var c=parseJSON(a);if("ok"==c.status){var d=parseInt(c.totalPlayed),f=parseInt(c.totalWon),g=parseInt(c.avgWinTime),h=c.bestAttemptTop,i=c.comment,j=c.fav;isDef(b)&&b(!0,d,f,g,h,i,j,c.playerList)}else isDef(b)&&b(!1)})},this.saveComment=function(a,b,c,d){e.isLogged()&&this.sendRequest("gw/saveComment.php",{gameId:a,comment:b,fav:c},d)},this.sendBeacon=function(a,b,c,d){g++,(g>=a||-1==g)&&(g=0,$.ajax({url:"/gw/beacon.php",type:"POST",data:{nocache:(new Date).getTime(),sessionId:e.getSessionId(),userId:e.getUserId(),gameVariationId:e.getGameVariationId(),lastActivityDelta:c},timeout:b,async:!0}).done(function(a){var b=parseJSON(a);null!=b&&"ok"==b.status&&isDef(d)&&d(!0,b)}).error(function(){isDef(d)&&d(!1)}))}}function GuestBookRenderer(a,b,c){var d,e,f,g=this,h={suppressScrollTop:!1,gameAreaHeight:null},i=new I18n;i.setContext("guestBook"),this.run=function(){$("#guestBookPanel").is(":visible")?e.hidePanel("guestBookPanel"):(f=d.getClientServer(),e.setLoading("#gbContents"),this.loadAndRender(!1),e.showPanel({id:"guestBookPanel",type:BOTTOM_PANEL}))},this.loadAndRender=function(a){a&&$("#gbLoadingImg").show(),f.sendRequest("/gw/guestbook/gbLoadBoard.php",{},function(b,c){$("#gbLoadingImg").hide(),b&&(g.render(c),a||g.scrollTop())})},this.scrollTop=function(){if(!g.options.suppressScrollTop){var a;a=g.options.gameAreaHeight?g.options.gameAreaHeight:$("#gameArea").height(),$("html, body").animate({scrollTop:$("#guestBookPanel").offset().top-iDiv(a,3)},"normal")}},this.render=function(a){var b=a.messages,c=[];if(b.length>0){var d="<table class='smartNoBordersTable' style='width: 100%; padding-top: 25px;'>";for(var e in b)b[e]._id=b.length-e,b[e].answerId?c.push(b[e]):d+=this.renderMessage(b[e],b.length-e);d+="</table>"}else d="<div class='gbNoMessagesAlert'>"+i.get("noMessagesAlert")+"</div>";var h="";f.isSuperUser()&&(h="<div style='margin-top: 3px; margin-right: 3px; float: left;'><input type='checkbox' id='gbIsAdminPost'>"+i.get("isAdminPostLabel")+"</a></div>");var j="<textarea id='gbPostText' class='gbPostTextArea' rows='3'></textarea><img src='/img/icons/loading.gif' id='gbPostLoadingIcon' alt='"+i.get("postLoadingAltText")+"'/>"+h+"<div id='gbPostBtn' class='constantWidthBtn'>"+i.get("postButtonLabel")+"</div><div class='clear'></div>",k="<h4>"+i.get("header")+"</h4>"+j+d;$("#gbContents").empty().append(k),g.renderAnswerMessages(c),g.bind(),f.isSuperUser()&&g.bindAdminEditables(b)},this.renderAnswerMessages=function(a){for(var b,c,d,e,f=a.length-1;f>=0;f--)b=a[f],d=$($(".smartNoBordersTable tr[data-id="+b.answerId+"] td")[0]),e=b.text.replace(/\n/gi,"<br />"),e="<span class='gbUsername'>"+b.username+"</span>&nbsp;&nbsp;&nbsp;&nbsp;<div class='gbAnswerText ' id='gbMsgTextTd"+b.msgId+"'><div>"+b.text.replace(/\n/gi,"<br />")+"</div></div>",c=$("<div>").html(e).addClass("gbAnswerMessage "+(b.byAdmin?"gbAdminMsg":"")),d.append(c),$(".gbAnswerButton[data-id="+b.answerId+"]").hide()},this.addAnswerBlock=function(a){var b=$(a.target).attr("data-id");$(".gbPostAnswer").remove();var c="";f.isSuperUser()&&(c="<div style='margin-top: 3px; margin-right: 3px; float: left;'><input type='checkbox' id='gbIsAdminAnswer' checked>"+i.get("isAdminPostLabel")+"</a></div>");var d="<textarea id='gbPostAnswerText' class='gbPostTextArea' rows='3'></textarea><img src='/img/icons/loading.gif' id='gbPostLoadingIcon' alt='"+i.get("postLoadingAltText")+"'/>"+c+"<div id='gbPostAnswerBtn' class='constantWidthBtn'>"+i.get("postButtonLabel")+"</div><div class='clear'></div>",e=$("<div>");e.addClass("gbPostAnswer"),e.html(d);var h=$($(".smartNoBordersTable tr[data-id="+b+"] td")[0]);h.append(e),$("#gbPostAnswerBtn").click(function(){var a=$.trim($("#gbPostAnswerText").val());0!=a.length&&(f.sendRequest("/gw/guestbook/gbPostMessage.php",{text:a,answerId:b,isAdminPost:bool2Int($("#gbIsAdminAnswer").is(":checked"))},function(a,b){$("#gbPostLoadingIcon").hide(),a&&g.render(b)}),$(".gbPostAnswer").remove(),$("#gbPostLoadingIcon").show())}),console.log($(a.target).attr("data-id"))},this.bindAdminEditables=function(a){for(var b in a){var c=a[b],d=c.msgId;$("#gbMsgTextTd"+d).dblclick(function(a){return function(){g.makeMessageEditable(a)}}(c))}},this.makeMessageEditable=function(a){var b="<textarea style='width: 100%' rows='5' id='gbEditAreaText"+a.msgId+"'>"+a.text+"</textarea><br/><input type='submit' value='"+i.get("saveChangesButtonLabel")+"' id='gbEditAreaSave"+a.msgId+"'></input><input type='submit' value='Удалить' id='gbEditAreaDelete"+a.msgId+"'></input><input type='submit' style='float: right;' value='Отмена' id='gbEditAreaCancel"+a.msgId+"'></input>";$("#gbMsgTextTd"+a.msgId).empty().append(b),$("#gbEditAreaSave"+a.msgId).click(function(){var b=$("#gbEditAreaText"+a.msgId).val();f.sendRequest("/gw/guestbook/gbEditMessage.php",{msgId:a.msgId,newText:b},function(a,b){a&&g.render(b)})}),$("#gbEditAreaDelete"+a.msgId).click(function(){confirm("Удалить сообщение =="+a.text+"== от "+a.username+"?")&&f.sendRequest("/gw/guestbook/gbDeleteMessage.php",{msgId:a.msgId},function(a,b){a&&g.render(b)})}),$("#gbEditAreaCancel"+a.msgId).click(function(){g.loadAndRender(!0)})},this.bind=function(){$("#gbPostBtn").click(function(){g.postMessage()}),$(".gbAnswerButton").click(g.addAnswerBlock)},g.postMessage=function(){var a=$.trim($("#gbPostText").val());0==a.length?alert(i.get("emptyMsgAlert")):($("#gbPostLoadingIcon").show(),f.sendRequest("/gw/guestbook/gbPostMessage.php",{text:a,isAdminPost:bool2Int($("#gbIsAdminPost").is(":checked"))},function(a,b){$("#gbPostLoadingIcon").hide(),a&&(g.render(b),g.scrollTop())}))},this.renderMessage=function(a){var b=(a.msgId,"");a.replyTS>0&&(b="<div class='gbReplyText gbAdminMsg'><b>"+i.get("adminUsername")+": </b>"+a.replyText+"</div>");var c=a.text.replace(/\n/gi,"<br />");c="<div class='gbMessageText "+(a.byAdmin?"gbAdminMsg":"")+"' id='gbMsgTextTd"+a.msgId+"'> <div>"+c+"</div>"+(f.isSuperUser()?"<span class='gbAnswerButton' data-id='"+a.msgId+"'>Ответить</span>":"")+"</div>";var d="<tr><td class='gbUsernameDateTd'><span class='gbUsername'>"+a.username+"</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class='gbDate'>"+formatDateRu(a.timestamp)+'</span><span class="gbMessageNumber">#'+a._id+"</span></td></tr><tr data-id='"+a.msgId+"'><td class='gbMsgTextTd' >"+c+b+"</td><td style='position: relative'></td></tr>";return d},this.bindAll=function(){$("#gbShow").click(function(){g.run()}),e.bindCloseIcon("#gbCloseIcon","guestBookPanel")},d=a,e=b,isDef(c)&&null!=c&&mergeObj(h,c),g.options=h,this.bindAll()}function LoginRegisterManager(a,b,c,d){var e,f,g,h=this,i={showWelcomePanel:!1},j=null,k=null,l=new I18n;l.setContext("loginRegister"),this.cleanUp=function(){$("#loginResult").empty(),$("#usernameAlert").empty(),$("#passwdAlert").empty(),$("#regUsername").val(""),$("#regPasswd").val(""),$("#regPasswdVerification").val("")},this.showRegMePanel=function(){$("#lrRegisterSection").show(),$("#lrLoginSection").hide(),$("#lrGuestSection").hide(),$("#restorePassPanel").hide(),$(".constantWidthTd").removeClass("rowWon"),$("#wpReg").addClass("rowWon"),$("#regUsername").focus()},this.showLoginBubblePanel=function(){$("#lrRegisterSection").hide(),$("#lrGuestSection").hide(),$("#restorePassPanel").hide(),$("#lrLoginSection").show(),$(".constantWidthTd").removeClass("rowWon"),$("#wpLogin").addClass("rowWon"),$("#loginUsername").focus()},this.showGuestAttentionPanel=function(){$("#lrRegisterSection").hide(),$("#lrLoginSection").hide(),$("#restorePassPanel").hide(),$("#lrGuestSection").show(),$(".constantWidthTd").removeClass("rowWon"),$("#wpClose").addClass("rowWon"),$("#loginUsername").focus()},this.doLogin=function(){var a=$("#loginUsername").val(),b=$("#loginPasswd").val();g.getClientServer().sendRequest(LOGIN_GATEWAY,{username:a,passwd:b},function(a,b){a?(g.getClientServer().setUser(b.userId,b.username,!1),g.setAboutToLogin(!0),$("#loginForm").trigger("submit")):h.showNoLoginPasswdMatch()})},this.showNoLoginPasswdMatch=function(){$("#loginResult").empty().append("<div class='lrRedAlert'>"+l.get("loginPasswdNoMatchNotice")+"</div>"),setTimeout(function(){$("#loginResult").empty()},2e3)},this.switchToRegister=function(){$("#usernameAlert").empty(),$("#passwdAlert").empty(),$("#regUsername").val(""),$("#regPasswd").val(""),$("#regPasswdVerification").val(""),$("#regUsername").focus(),h.showRegMePanel()},this.switchToLogin=function(){h.showLoginBubblePanel()},this.regValidateUsername=function(){var a=$("#regUsername").val();a.length>0&&a.length<3?h.setRegUsernameAlert(l.get("minUsernameLengthNotice"),!1):a.length>25?h.setRegUsernameAlert(l.get("maxUsernameLengthNotice"),!1):h.regHotVerifyUsername()},this.regValidatePasswd=function(){var a=$("#regPasswd").val(),b=$("#regPasswdVerification").val();a.length>0&&a.length<5?h.setRegPasswdAlert(l.get("minPasswdLengthNotice"),!1):a.length>25?h.setRegPasswdAlert(l.get("maxPasswdLengthNotice"),!1):""!=b?a!=b?h.setRegPasswdAlert(l.get("passwdsDontMatchNotice"),!1):h.setRegPasswdAlert(l.get("passwdsDoMatchNotice"),!0):h.setRegPasswdAlert("")},this.setRegPasswdAlert=function(a,b){if(""!=a){var c=b?"lrGreenAlert":"lrRedAlert";$("#passwdAlert").empty().append("<div class='"+c+"'>"+a+"</div>"),k=b}else $("#passwdAlert").empty(),k=!1},this.regHotVerifyUsername=function(){var a=$("#regUsername").val();a.length>=3&&a.length<=25&&g.getClientServer().sendRequest(CHECK_USERNAME_GATEWAY,{username:a},function(a,b){a&&(b.isAvailable?h.setRegUsernameAlert(l.get("usernameAvailableNotice"),!0):h.setRegUsernameAlert(l.get("usernameTakenNotice"),!1))})},this.setRegUsernameAlert=function(a,b){var c=b?"lrGreenAlert":"lrRedAlert";$("#usernameAlert").empty().append("<div id='usernameAlertInt' style='position: relative;' class='"+c+"'>"+a+"</div>"),j=b},this.doRegister=function(){var a=g.getClientServer(),b=$.trim($("#regUsername").val()),c=$("#regPasswd").val();h.regValidateUsername(),h.regValidatePasswd(),""==b&&h.setRegUsernameAlert(l.get("usernameRequiredNotice"),!1),""==c&&h.setRegPasswdAlert(l.get("passwdRequiredNotice"),!1),j&&k&&a.sendRequest(REG_GATEWAY,{username:b,passwd:c},function(b,c){b?(a.setUser(c.userId,c.username,!1),g.reloadPage?g.reloadPage():f.onRegistration()):($("#regResult").show(),$("#regResult").empty().append("<div class='lrRedAlert'>"+l.get("usernameTakenNotice")+"</div>"),$("#regResult").delay(2e3).fadeOut("fast"))
})},this.doRestorePass=function(){var a=g.getClientServer(),b=$.trim($("#rpUsername").val()),c=$.trim($("#rpMail").val());return b&&c?void a.sendRequest(RES_GATEWAY,{username:b,mail:c},function(a,b){"ok"==b.result?(alert("Новый пароль отправлен на указанный адрес электронной почты."),h.showLoginBubblePanel()):($("#rpResult").show(),$("#rpResult").empty().append("<div class='lrRedAlert'>Введённая пара имя пользователя/электронная почта не найдена.</div>"),$("#rpResult").delay(2e3).fadeOut("fast"))}):($("#rpResult").show(),$("#rpResult").empty().append("<div class='lrRedAlert'>Введённая пара имя пользователя/электронная почта не найдена.</div>"),void $("#rpResult").delay(2e3).fadeOut("fast"))},this.bindLoginRegisterButton=function(){$("#bbLoginRegister").bind("click",function(){$("#welcomePanel").is(":visible")?f.hidePanel("welcomePanel"):h.showWelcomePanel()})},this.bindAll=function(){this.bindLoginRegisterButton(),$("#loginCommit").click(function(){h.doLogin()}),$("#loginCancel").click(function(){f.hidePanel("loginRegisterPanel")}),$("#loginForm").bind("keypress",function(a){var b=a.which?a.which:a.keyCode;b==KEY_ENTER&&h.doLogin()}),$("#regForm").bind("keypress",function(a){var b=a.which?a.which:a.keyCode;b==KEY_ENTER&&h.doRegister()}),$("#switchToRegister").click(function(){h.switchToRegister()}),$("#regUsername").keyup(function(){h.regHotVerifyUsername()}),$("#regUsername").blur(function(){h.regValidateUsername()}),$("#regPasswdVerification").blur(function(){h.regValidatePasswd()}),$("#regPasswd").blur(function(){h.regValidatePasswd()}),$("#regForm").submit(function(){return h.doRegister(),!1}),$("#regMeBtn").click(function(){h.doRegister()}),$("#rpCommit").click(function(){h.doRestorePass()}),$("#restorePass").click(function(){$("#restorePassPanel").show(),$("#lrLoginSection").hide(),$("#lrGuestSection").hide(),$("#lrRegisterSection").hide()}),$("#rpCancel").click(function(){h.showLoginBubblePanel()}),$("#switchToLogin").click(function(){h.switchToLogin()}),$("#wpReg").click(function(){h.showRegMePanel()}),$("#wpLogin").click(function(){h.showLoginBubblePanel()}),$("#wpClose").click(function(){h.showGuestAttentionPanel()}),$("#wpVK").click(function(){vkAuthOpenAPI()}),$("#guestContinue").click(function(){f.hidePanel("welcomePanel")}),$("#closeRegMePanel, #lrCloseIcon").click(function(){f.hidePanel("loginRegisterPanel")}),$("#loginForm").submit(function(){var a=g.getClientServer();return a.isGuest()?!1:($("#hfSessionId").val(a.getSessionId()),$("#hfUserId").val(a.getUserId()),!0)})},this.showWelcomePanel=function(){var a=g.getClientServer();a.isGuest()&&($("#guestName").empty().append(l.transliterate(a.getUsername())),f.showPanel({id:"welcomePanel",type:OVER_FIELD_PANEL}),$("#lrLoginSection").hide(),$("#lrRegisterSection").hide(),$("#lrGuestSection").hide(),$("#restorePassPanel").hide(),$(".constantWidthTd").removeClass("rowWon"))},e=a,f=b,g=c,isDef(d)&&null!=d&&(i=d),this.bindAll(),isDef(i.showWelcomePanel)&&i.showWelcomePanel&&this.showWelcomePanel()}function trimMsg(a){return a=a.replace(/\n/gi," "),a.length>55?a.substr(0,50)+"...":a}function PlayerProfile(a,b){var c,d,e,f=this,g=0,h=!1,i=null,j=!1,k=new I18n;k.setContext("profile"),this.setUnreadMsgCount=function(a){g=a},this.getUnreadMsgCount=function(){return g},this.run=function(){c.getClientServer().isGuest()||($("#profilePanel").is(":visible")?d.hidePanel("profilePanel"):0==f.getUnreadMsgCount()?f.show():f.showInbox())},this.show=function(){f.setLoading(SHOW_MAIN_TAB),e.loadProfile(null,function(a,b){if($("#profilePIStatic").empty().append(PlayerProfile.renderProfilePI(b,!1)),$("#profilePIStaticLayout").show(),$("#profileEditBtn").show(),$("#profilePIEditable").hide(),j=!1,$("#profileSubTab").hide(),$("#profileSubTab").empty(),$("#profileMainTab").show(),h=!0,i=$("#profileLoadingIcon"),$("#profileLoadingIcon").hide(),a&&null!=b){$("#profileWhere").val(b.fromwhere),$("#profileLink").val(b.link),$("#profileMail").val(b.mail),$("#profileAbout").val(b.about),$("#profileBirthDay").val(b.birthDay),$("#profileBirthMonth").val(b.birthMonth),$("#profileBirthYear").val(b.birthYear),null!=b.photoThumb?($("#profilePhotoFrame").css("border","none"),$("#profilePhotoFrame").empty().append("<img class='profilePhoto'src='"+b.photoThumb+"'/>")):($("#profilePhotoFrame").css("border","1px solid #CCC"),$("#profilePhotoFrame").empty().append("<img class='profilePhoto'src='/images/nophoto-"+I18n.get("locale")+".png'/>")),$("#profileSideActivity").empty();var c;$("#profileSideActivity").append(c)}else $("#profileWhere").val(""),$("#profileLink").val(""),$("#profileMail").val(""),$("#profileAbout").val(""),$("#profileBirthDay").val(0),$("#profileBirthMonth").val(0),$("#profileBirthYear").val(0),$("#profilePhotoFrame").css("border","1px solid #CCC"),$("#profilePhotoFrame").empty().append("<img class='profilePhotoFrame'src='/images/nophoto-"+I18n.get("locale")+".png'/>"),$("#profileSideActivity").empty();$("#profileGoInvisible").attr("checked",!!b.isInvisible),$("#profileLoading").hide(),b.unreadMsgCount>0&&f.updateUnreadMsgCount(b.unreadMsgCount),$("#profileContents").show(),$("html, body").scrollTop($("#profilePanel").offset().top)})},this.save=function(){return $("#profileMail").val($.trim($("#profileMail").val())),""!=!$("#profileMail").val()||validateMail($("#profileMail").val())?($("#profileLoadingImg").show(),void e.updateProfile(function(a,b){$("#profileLoadingImg").hide(),a&&(j||null==b.thumbFilename||($("#profilePhotoFrame").css("border","none"),$("#profilePhotoFrame").empty().append("<img class='profilePhoto'src='"+b.thumbFilename+"'/>")),$("#profilePhotoField").val(""),isDef(b.profile)&&$("#profilePIStatic").empty().append(PlayerProfile.renderProfilePI(b.profile,!1)),$("#profilePIEditable").hide(),$("#profilePIStaticLayout").show(),$("#profileEditBtn").show())})):void alert("Адрес почты не содержит точку или @")},this.setLoading=function(){$("#profilePanel").is(":visible")?null!=i&&i.show():($("#profileUsername").empty().append(e.getUsername()),$("#profileLoading").show(),$("#profileContents").hide(),$("#profileUnreadMsgAlert").hide(),d.showPanel({id:"profilePanel"}),$("html, body").scrollTop($("#profilePanel").offset().top))},this.showInbox=function(){f.setLoading(SHOW_SUBTAB),e.loadConversations(function(a,b){var c="<div class='pmCP'>";if(c+="<h4 class='pmShowInbox nonSelectable' id='pmShowInbox'>"+k.get("inboxHeader")+"</h4>",c+="<h4 class='pmShowOutbox activeOption nonSelectable' id='pmSendMsg'>"+k.get("sendMsgMenuAction")+"</h4>",c+="</div>",c+="<img src='/img/icons/loading.gif' class='profileLoadingIcon' id='pmInboxLoadingIcon' />",c+="<div class='clear'></div>",0==b.length)c+="<p style='padding-left: 10px;'>"+k.get("noDialogsAlert")+"</p>";else{c+="<table class='standartTable' width='100%' style='margin-top: 12px;'>",c+="<tr><th width='10%'>"+k.get("opponentLabel")+"</th><th>"+k.get("msgTextLabel")+"</th><th width='10%'>"+k.get("sentDateTimeLabel")+"</th></tr>";for(var d in b){var g=b[d],h=g.hasNewMessages?"font-weight: bold;":"",j=g.ownMessage?" ownMessage":"";c+="<tr id='conversation"+g.opponent+"' style='"+h+"'><td style='text-align: center;' class='pmSenderNameTd'><p class='pmSenderName'>"+g.opponentName+"</p></td><td><p class='msgShort"+j+"'>"+trimMsg(g.msg)+"</p></td><td style='text-align: center; white-space: nowrap;'>"+formatTime(g.timestamp,{putTimeInBrackets:!0})+"</td></tr>"}c+="</table>"}var l=new BottomSubPanel;if(l.fillContents(c),l.onClose(function(){f.show()}),l.renderContents("profileSubTab"),$("#profileMainTab").hide(),$("html, body").scrollTop($("#profilePanel").offset().top-iDiv($("#gameArea").width(),3)),i=$("#pmInboxLoadingIcon"),$("#pmSendMsg").click(function(){f.showSendMsg()}),b.length>0)for(var d in b){var m=b[d];$("#conversation"+m.opponent).click(function(a){return function(){f.setLoading(SHOW_SUBTAB),e.loadConversation(a.opponent,function(b,c){f.updateUnreadMsgCount(c.unreadMsgCount),f.renderConversation(a.opponent,a.opponentName,c.conversation,function(){f.showInbox()})})}}(m))}})},this.openAdminDialog=function(){e.loadConversation(-1,function(a,b){f.updateUnreadMsgCount(b.unreadMsgCount),f.renderConversation(-1,"Админ",b.conversation,function(){f.showInbox()},!0)})},this.renderConversation=function(a,b,c,d,f){var g;g="<table class='pmDlgLayout'>";for(var h=c.length-1;h>=0;h--){var j=c[h];g+="<tr><td><p class='pmDlgSender'>"+j.senderName+"</p><p class='pmDlgText'>"+j.msg.replace(/\n/gi,"<br />")+"</p></td><td class='pmDlgSendDate'>"+formatDate(j.sentTS)+"</td></tr>"}g+="</table>";var l=new BottomSubPanel,m="<h4 style='float: left;'>"+k.get("conversationWithPrefix")+" "+b+"</h4>";m+="<img src='/img/icons/loading.gif' class='profileLoadingIcon' id='pmMsgLoadingIcon' />",m+="<div class='clear'></div>",m+="<div class='msgText' id='msgText'><div class='msgPadding'>"+g+"</div></div>",m+="<div class='clear'></div>",m+="<div class='pdSendMsgPanel' id='replyToPanel'><div class='pdSendMsgPanelPadding'><h4>"+k.get("msgRecipientPrefix")+" &laquo;"+b+"&raquo;</h4><textarea id='replyText' style='width: 100%'></textarea><div class='constantWidthBtn nonSelectable pdSendMsgBtn' id='sendReplyBtn'>"+k.get("sendReplyButtonLabel")+"</div><div class='clear'></div></div></div>",l.fillContents(m),l.onClose(d),l.renderContents("profileSubTab"),$("#profileMainTab").hide(),i=$("#pmMsgLoadingIcon"),$("html, body").scrollTop($("#profileSubTab").offset().top+$("#profileSubTab").height()),$("#replyToBtn").click(function(){$("#replyToBtn").hide(),$("#replyToPanel").show(),$("html, body").scrollTop($("#replyToPanel").offset().top),$("#replyText").focus()}),$("#sendReplyBtn").click(function(){var b=$("#replyText").val();b.length>0?e.sendMessage(a,b,0,0,function(){d()}):alert(k.get("emptyMsgAlert"))}),f&&($("#replyToBtn").hide(),$("#replyToPanel").show(),$("html, body").scrollTop($("#replyToPanel").offset().top),$("#replyText").focus())},this.showSendMsg=function(){f.setLoading(SHOW_SUBTAB);var a=new BottomSubPanel,b="<h4 style='float: left;'>"+k.get("sendPMHeader")+"</h4>";b+="<img src='/img/icons/loading.gif' class='profileLoadingIcon' id='pmSubPanelLoadingIcon' />",b+="<div class='clear'></div>",b+="<div style='margin-right: 4px;'>",b+="<textarea id='msgText' style='width: 100%; margin-top: 10px;'></textarea>",b+="</div>",b+="<div class='constantWidthBtn nonSelectable profileActionBtn' id='chooseRecipientsBtn'>"+k.get("selectRecipientsButtonLabel")+"</div>",b+="<div style='border: 1px dashed #CCC' id='pmRecipientList'></div>",b+="<div class='constantWidthBtn nonSelectable profileActionBtn' id='pmSendMsgBtn'>"+k.get("sendMsgButtonLabel")+"</div>",b+="<div class='clear'></div>",a.fillContents(b),a.onClose(function(){f.showInbox()}),a.renderContents("profileSubTab"),$("#profileMainTab").hide(),i=$("#pmSubPanelLoadingIcon"),$("#chooseRecipientsBtn").click(function(){$("#pmSubPanelLoadingIcon").show(),e.loadRecipients(function(a,b){if(a){$("#pmSubPanelLoadingIcon").hide(),$("#chooseRecipientsBtn").hide();for(var c in b){var d=b[c];$("#pmRecipientList").append("<div style='width: 25%; display: inline-block;'><input class='pmRcpCheckBox' type='checkbox' value='"+d.playerId+"'>"+d.username+"</div>")}$("#pmRecipientList").show(),$("#pmSendMsgBtn").show(),$("html, body").scrollTop($("#pmRecipientList").offset().top)}})}),$("#pmSendMsgBtn").click(function(){var a=[];$(".pmRcpCheckBox").each(function(){this.checked&&a.push(parseInt(this.value))});var b=$("#msgText").val();0==$.trim(b).length?alert(k.get("emptyMsgAlert")):0==a.length?alert(k.get("noRecipientAlert")):($("#pmSubPanelLoadingIcon").show(),e.sendMassMsg(b,a,function(){f.showInbox()}))})},this.bindAll=function(){$("#bbProfile").click(function(){f.run()}),$("#profileLogoutBtn").click(function(){setCookie("vk_app_3960668"," ",new Date(0),"/",".logic-games.spb.ru"),c.logout()}),$("#profileCloseImg").click(function(){d.hidePanel("profilePanel")}),$("#profileEditBtn").click(function(){$("#profilePIStaticLayout").hide(),$("#profilePIEditable").show()}),$("#profilePhotoField").change(function(){f.preuploadPhoto()}),$("#profileSaveBtn").click(function(){f.save()}),$("#profileDiscardChangesBtn").click(function(){f.show()}),$("#profileReadMsgBtn, #profileGoToInbox").click(function(){f.showInbox()}),$("#sendToAdmin").click(function(){f.openAdminDialog()}),$("#changePassword").click(function(){$("#cpOldPassword").val(""),$("#cpNewPassword1").val(""),$("#cpNewPassword2").val(""),d.showPanel({id:"changePassPanel",type:OVER_FIELD_PANEL})}),$("#cpCancel, #cpCloseIcon").click(function(){f.run()}),$("#cpCommit").click(function(){f.changePassword()}),$("#profileGoInvisible").click(function(){var a=$("#profileGoInvisible").is(":checked");$("#profileGoInvisible").attr("disabled","disabled"),$("#profileGoInvisibleLoadingImg").show(),e.updateUserSettings({isInvisible:a},function(){$("#profileGoInvisible").removeAttr("disabled"),$("#profileGoInvisibleLoadingImg").hide()})}),$("#shareBtn").click(function(){"block"==$(".share42init").css("display")?$(".share42init").hide():$(".share42init").show()})},this.preuploadPhoto=function(){$("#profileLoadingImg").show(),e.preuploadPhoto(function(a,b){$("#profileLoadingImg").hide(),a&&($("#profilePhotoFrame").css("border","none"),$("#profilePhotoFrame").empty().append("<img class='profilePhoto'src='"+b.thumbFilename+"'/>"),j=!0)})},this.bindActions=function(a){$("#sendMsg"+a.playerId).click(function(){$("#pdSendMsgResult"+a.playerId).hide(),$("#pdSendMsgPanel"+a.playerId).toggle("fast")}),$("#pdSendMsgBtn"+a.playerId).click(function(){var b=$("#pdMsg"+a.playerId).val();if(""!=b){var c=e.isSuperUser()&&$("#pdFromAdmin").is(":checked")?1:0;e.sendMessage(a.playerId,b,0,c,function(b){$("#pdSendMsgResult"+a.playerId).empty().append(k.get("msgSentSuccessfullyAlert")),$("#pdSendMsgResult"+a.playerId).show(),$("#pdSendMsgResult"+a.playerId).delay(2e3).fadeOut(),$("#pdSendMsgPanel"+a.playerId).hide(),$("#pdMsg"+a.playerId).val(""),$("#sendMsg"+a.playerId).show()})}$("#pdMsg"+a.playerId).val("")})},this.updateUnreadMsgCount=function(a){f.setUnreadMsgCount(a),e.isLogged()&&a>0?($("#bbProfileLabel").hide(),$("#bbUnreadMsgCount").empty().append(k.get("newMessagesLabel")+": "+a),$("#profileReadMsgBtn").empty().append(k.get("newMessagesLabel")+": "+a),$("#profileGoToInbox").hide(),$("#profileUnreadMsgAlert").show(),a>=10?$("#bbUnreadMsgCount").css("font-size","7pt"):$("#bbUnreadMsgCount").css("font-size","8pt")):($("#profileGoToInbox").show(),$("#bbProfileLabel").show(),$("#bbUnreadMsgCount").empty(),$("#profileUnreadMsgAlert").hide())},this.renderProfile=function(a){return PlayerProfile.renderProfile(a,c.getClientServer().isGuest())},this.changePassword=function(){var a=c.getClientServer(),b=$.trim($("#cpOldPassword").val()),d=$.trim($("#cpNewPassword1").val()),e=$.trim($("#cpNewPassword2").val()),g=null;return b&&d&&e?(d==b&&(g="Старый и новый пароль совпадают!"),d.length>0&&d.length<5?g="Минимальная длина 5 символов.":d.length>25?g="Максимальная длина 25 символов.":d!=e&&(g="Введённые пароли не совпадают")):g="Заполните все поля",g?($("#cpResult").show(),$("#cpResult").empty().append("<div class='lrRedAlert'>"+g+"</div>"),void $("#cpResult").delay(2e3).fadeOut("fast")):void a.sendRequest(CNP_GATEWAY,{old:b,"new":d},function(a,b){"ok"==b.result?(alert("Пароль успешно изменен"),f.run()):($("#cpResult").show(),$("#cpResult").empty().append("<div class='lrRedAlert'>"+b.result+"</div>"),$("#cpResult").delay(2e3).fadeOut("fast"))})},c=a,d=b,e=c.getClientServer(),f.cs=e,PlayerProfile.BOUND||(f.bindAll(),PlayerProfile.BOUND=!0)}function filterField(a){return""==a?"<span class='profileAbsentField'>"+I18n.contextGet("profile","emptyFieldStub")+"</span>":a}function filterLink(a,b){if(""==a)return filterField(b);if(a.length>32)var c=a.substr(0,32)+"...";else c=a;return"<a href='"+a+"' target=_blank>"+c+"</a>"}function validateMail(a){var b=/\S+@\S+\.\S+/;return a&&a.length>3&&b.test(a)}function I18n(){var a=this,b=null;this.setContext=function(a){b=contexts[a]},this.get=function(a,c){return b?isDef(b[a])?isDef(c)?b[a][c]:b[a]:isDef(contexts.shared[a])?isDef(c)?contexts.shared[a][c]:contexts.shared[a]:void 0:""},this.format=function(b){for(var c=a.get(b),d="",e=0,f="",g=0;g<c.length;g++){var h=c.charAt(g);"{"==h&&0==e?e=1:"{"==h&&1==e?e=2:"{"!=h&&"}"!=h&&2==e?f+=h:"}"==h&&2==e?(d+=arguments[parseInt(f)+1],e=1,f=""):"}"==h&&1==e?e=0:d+=h}return d},this.transliterate=function(a){if(!I18n.get("isLatin"))return a;var b=I18n.get("symbolMap");return a.replace("Гость","Guest").split("").map(function(a){return ifDef(b[a],a)}).join("")},this.getMonth=function(a){return contexts.months[a]},this.getMonthShort=function(a){return contexts.monthsShort[a]},this.getMonthBeta=function(a){return contexts.monthsBeta[a]}}var KEY_ESC=27,KEY_A=65,KEY_B=66,KEY_D=68,KEY_T=84,KEY_W=87,KEY_X=88,KEY_Y=89,KEY_Z=90,KEY_LEFT_ARROW=37,KEY_UP_ARROW=38,KEY_RIGHT_ARROW=39,KEY_DOWN_ARROW=40,KEY_F1=112,KEY_F2=113,KEY_F3=114,KEY_F8=119,KEY_F9=120,KEY_0=48,KEY_1=49,KEY_2=50,KEY_3=51,KEY_4=52,KEY_5=53,KEY_6=54,KEY_7=55,KEY_8=56,KEY_9=57,HIDE_SINGLE_PANEL=0,HIDE_ALL_PANELS=1,OVER_FIELD_PANEL=0,BOTTOM_PANEL=1,PLAYED_GAME_COLOR="#FFE0EE",WON_GAME_COLOR="#FFFFE0",KEY_ENTER=13,KOSYNKA_GAME_VARIATION_ID=1,FREECELL_GAME_VARIATION_ID=2,CHESS_GAME_VARIATION_ID=3,SPIDER_4S_GAME_VARIATION_ID=4,SPIDER_1S_GAME_VARIATION_ID=5,SPIDER_2S_GAME_VARIATION_ID=6,SOKOBAN_GAME_VARIATION_ID=7;BottomSubPanel.maxId=0,function(a,b){setTimeout(function(){try{var c,d='<div id="btnScrollUp" style="position: fixed;  display: block;    bottom: 15px;    left: 15px;    padding-left: 5px;    padding-right: 5px;    font-size: 16pt;    border: 1px solid black;    border-radius: 5px;    cursor: pointer;">'+contexts.shared.btnUp+"</div>",e=!1,f=!1,g=.7*b.screen.height||100;$(b).bind("scroll",function(){b.scrollY>g?e?f||($(c).show(),f=!0):($(a.body).append(d),c=$("#btnScrollUp"),e=!0,f=!0,$(c).click(function(){b.scrollTo(0,0)})):e&&f&&($(c).hide(),f=!1)})}catch(h){console.log(h)}},1e3)}(document,window),setTimeout(function(){if(window._isVk||window._isVK)try{$("#changePassword").hide()}catch(a){console.log(a)}},1e3);var Template=function(){function a(a,c,d){isDef(c)&&c||(c={});var e="",f=!0;return d&&_.isFunction(d)||(f=!1),b(a,function(a,b){if(b)try{e=_.template(b,c)}catch(g){console.log(g)}f&&d(e)},f),f?void 0:e}function b(a,b,d){var e=c[a];!e||_.isUndefined(e)?$.ajax({url:"../templates/"+a,async:d}).done(function(d){return d?(e=d,c[a]=e,void b(null,e)):(console.log("ajax return nothing! "+a),void b("error",null))}).error(function(c){console.log("no template! "+a,c),b("error",null)}):b(null,e)}var c={};return{get:a}}(),ErrorReporter=function(){function a(){window.onerror=function(a,d,e){if(1==window._reportErrors&&"Error loading script"!=a&&e&&!(parseInt(e)<2)){if(d&&e){if(c[e+d])return;c[e+d]=!0}b({errorMessage:a,url:d,line:e})}},isDef(window._gameVariationId)||(window._gameVariationId=0)}function b(a){try{$.ajax({url:"/gw/error.php",type:"POST",data:{errorMessage:a.errorMessage,url:a.url,line:a.line,gameVariationId:window._gameVariationId}})}catch(b){console.log(b)}}a();var c={};return{sendError:function(a){isDef(a.errorMessage)||(a.errorMessage=a.message),isDef(a.url)||(a.url=""),isDef(a.line)||(a.line=""),b(a)}}}();!function(){function a(){console.log("showGameInfo"),d=$("<div />").html(e).appendTo("body").attr("id","logicGameStats"),d.find(".closeIcon").on("click",function(){d.hide()}),d.find(".logic-table-edit").blur(c),d.hide(),d.draggable(),b()}function b(){$.post("/admin/gameStats.php",{load:!0,gameVariationId:_gameVariationId},function(a){console.log(a),"null"!=a&&(a=JSON.parse(a),d.find("#logic-table-date").html(a.date),d.find("#logic-table-ss").html(a.ss),d.find("#logic-table-vk").html(a.vk),d.find("#logic-table-advert").html(a.advert)),d.show()})}function c(){var a={date:d.find("#logic-table-date").html(),ss:d.find("#logic-table-ss").html(),vk:d.find("#logic-table-vk").html(),advert:d.find("#logic-table-advert").html()};console.log(a),$.post("/admin/gameStats.php",{save:!0,gameVariationId:_gameVariationId,data:JSON.stringify(a)})}var d,e='<img class="closeIcon" src="//logic-games.spb.ru/v6-game-client/app/i/close.png"> <table> <tr><td>Дата выпуска</td>   <td id="logic-table-date" contenteditable class="logic-table-edit"></td></tr><tr> <td>Сервер</td>     <td id="logic-table-ss" contenteditable class="logic-table-edit"></td></tr> <tr> <td>Вконтакте</td>     <td id="logic-table-vk" contenteditable class="logic-table-edit"></td></tr> <tr> <td>Реклама</td> <td id="logic-table-advert" contenteditable class="logic-table-edit"></td></tr> </table>';try{$(document).ready(function(){setTimeout(function(){try{var b=window.cs||(window.controller?window.controller.getClientServer():null);b.isSuperUser()&&a()}catch(c){console.log(c)}},2e3)})}catch(f){console.log(f)}}(document,window);var Resizer=function(a){function b(){console.log("Resizer setNewIframeSize",d,a.height()),d=a.height(),window.VK.callMethod("resizeWindow",e,d)}a=a||"main-wrapper",a=$("#"+a);var c=window._isVk||window._isVK||window.isVk||window.isVK;if(console.log("Resizer setup",c,window.VK,a),a.length&&$&&c&&window.VK&&window.VK.callMethod){var d,e=$(document).width();e=e>1e3?1e3:e,b(),setInterval(function(){a.height()!=d&&b()},100)}};try{$(document).ready(function(){setTimeout(function(){try{Resizer()}catch(a){console.log(a)}},100)})}catch(e){console.log(e)}$(document).ready(function(){var a=document.getElementById("under-field")?"#under-field":"#field",b=$(a);if(window._lang&&!window._isFb&&!window._isVk){var c,d,e=$("<a>");"en"==window._lang?(c="ru",d="РУ"):(c="en",d="EN"),e.html(d).attr("href","?lang="+c).addClass("switchLocale"),b.append(e),e.css({top:b.height()+8,left:b.width()+20,position:"absolute"})}window._lang&&"ru"!=window._lang?$(".lg-vkgroup").hide():window._isVk||b.append($(".lg-vkgroup").css({top:b.height()-52,left:b.width()+19}))});var BEGIN_NEW_ATTEMPT=1,RESTORE_LAST_ATTEMPT=2,LOGOUT_GATEWAY="/gw/logout.php",UNKNOWN_REASON=0,NOT_LOGGED=1,CHECK_USERNAME_GATEWAY="/gw/checkUsername.php",REG_GATEWAY="/gw/registerNewUser.php",LOGIN_GATEWAY="/gw/login.php",RES_GATEWAY="/gw/restorePass.php",CNP_GATEWAY="/gw/changePass.php",INBOX=0,OUTBOX=1,SHOW_MAIN_TAB=0,SHOW_SUBTAB=1;PlayerProfile.BOUND=!1,PlayerProfile.renderProfile=function(a,b){b=ifDef(b,!1);var c="<div class='playerProfile'><table class='playerProfileLayout'><tr>",d="";if(null==a.photoThumb&&(d=" profilePhotoBorder"),c+="<td style='width: 1%; text-align: left; padding-right: 10px;'><div class='profilePhotoFrame"+d+"'>"+(null==a.photoThumb?"<img class='profilePhoto' src='/images/nophoto-"+I18n.get("locale")+".png' />":"<a href='"+a.photo+"' rel='lightbox'><img class='profilePhoto' src='"+a.photoThumb+"' /></a>")+"</div></td>",c+="<td>"+PlayerProfile.renderProfilePI(a)+(b?"":"<div class='constantWidthBtn nonSelectable pdSendMsg' id='sendMsg"+a.playerId+"'>"+I18n.contextGet("profile","pdSendPMButtonLabel")+"</div>")+"</td>",c+="</tr>",!b){var e="undefined"==typeof controller?cs:controller.cs;e=!!e&&e.isSuperUser(),c+="<tr><td colspan='2'><div class='pdSendMsgResult' id='pdSendMsgResult"+a.playerId+"'></div><div class='pdSendMsgPanel' id='pdSendMsgPanel"+a.playerId+"'><div class='pdSendMsgPanelPadding'><h4>"+I18n.contextGet("profile","pdRecipientHeaderPrefix")+" &laquo;"+a.playerName+"&raquo;</h4><textarea id='pdMsg"+a.playerId+"' style='width: 100%'></textarea>"+(e?"<input type='checkbox' id='pdFromAdmin'>От Админа</input>":"")+"<div class='constantWidthBtn nonSelectable pdSendMsgBtn' id='pdSendMsgBtn"+a.playerId+"'>"+I18n.contextGet("profile","pdSendButtonLabel")+"</div><div class='clear'></div></div></div></td></tr>"}return c+="</table></div>"},PlayerProfile.renderProfilePI=function(a,b){var b=ifDef(b,!0),c="";a.birthDay>0&&a.birthMonth>0&&(c=a.birthDay+" "+I18n.contextGet("monthsBeta",a.birthMonth)),a.birthYear>0&&(""!=c&&(c+=" "),c+=a.birthYear);var d=a.about.replace(/\n/gi,"<br />");return'<table class="playerProfileTable" style=" width: 100%;word-wrap: break-word; table-layout: fixed; "><tr><td>'+I18n.contextGet("profile","birthdayLabel")+": </td><td>"+filterField(c)+"</td></tr><tr><td>"+I18n.contextGet("profile","fromwhereLabel")+": </td><td>"+filterField(a.fromwhere)+"</td></tr><tr><td>"+I18n.contextGet("profile","linkLabel")+": </td><td>"+filterLink(a.validLink,a.link)+"</td></tr>"+(b?"":'<tr><td title="Для восстановления пароля">'+I18n.get("email")+'</td><td title="Для восстановления пароля">'+filterField(a.mail)+"</td></tr>")+"<tr><td>"+I18n.contextGet("profile","aboutLabel")+": </td><td>"+filterField(d)+"</td></tr><tr><td>"+I18n.contextGet("profile","regDateLabel")+": </td><td>"+formatDateRu(a.regTimeTS)+"</td>"+(a.lastActiveTS?"</tr><tr><td>Последнее посещение сайта: </td><td>"+formatDateRu2(a.lastActiveTS)+"</td></tr>":"")+"</table>"};var LogicGame=function(){function a(b){var c,d=this,e=-2;d.globalAsync=!0,d.globalTimeout=15e3,this.isLogged=function(){return!d.isGuest()},this.getGameVariationId=function(){return c},this.sendBeacon=function(a,b,c){e++,(e>=a||-1==e)&&(e=0,$.ajax({url:"/gw/beacon.php",type:"POST",data:{nocache:(new Date).getTime(),sessionId:d.getSessionId(),userId:d.getUserId(),gameVariationId:d.getGameVariationId()},timeout:b,async:!0}).done(function(a){var b=parseJSON(a);null!=b&&"ok"==b.status&&isDef(c)&&c(!0,b)}).error(function(){isDef(c)&&c(!1)}))},multiExtendClass(a,ProfileClientServer,this),multiExtendClass(a,SharedClientServer,this),c=b,d.attemptLocalStorage=new AttemptLocalStorage(d)}function b(a){var d,f,g=this;g.gameURL=location.href.substr(0,location.href.lastIndexOf("/")+1);var h=27;this.getClientServer=function(){return d},this.setup=function(){jQuery(document).keydown(this.keyDown),g.ui=e=new c(this),g.cs=d,f=new Beacon(this,e);var a=$.timer(function(){f.sendBeacon()});a.set({time:1e3,autostart:!0})},this.keyDown=function(a){var b=a.which;b==h&&(g.notifyEsc(),e.hideAllActivePanels())},this.logout=function(){d.logout(function(a){a&&location.reload()})},this.setAboutToLogin=function(a){aboutToLogin=a},multiExtendClass(b,SharedController,this),d=a,g.cs=d}function c(a){var b,d,e=this,f=0;this.showRegPanel=function(){d.showRegMePanel()},multiExtendClass(c,SharedUI,this),e.setGameController(a),e.setupSharedUI();var g=a;e.gc=a,b=new GuestBookRenderer(g,this,null),d=new LoginRegisterManager(_isFreshUser,this,g,{showWelcomePanel:!0}),this.hidePanel=function(a){$(".buttonMenu.downmeny a").removeClass("on"),e.hideAllActivePanels(),a instanceof BottomSubPanel&&(a.fireOnClose(HIDE_SINGLE_PANEL),a.destroy())},this.setGuestUI=function(){$("#bbProfile").hide(),$("#bbLoginRegister").show(),e.showPanel({id:"welcomePanel",type:f})},this.setUserUI=function(){$("#bbProfile").show(),$("#bbLoginRegister").hide(),e.hidePanel("welcomePanel")},this.showGuestBook=function(){b.run()}}function d(){if(!_gameVariationId)throw new Error("_gameVariationId undefined");if(!_sessionId)throw new Error("_sessionId undefined");if(!_userId)throw new Error("_userId undefined");if(!_username)throw new Error("_username undefined");if(window.controller||window.cs||window.ui)throw new Error("client already initialized");var c=new a(_gameVariationId);c.setSessionId(_sessionId),c.setUser(_userId,_username,_isGuest),f=new b(c,null),f.setup(),window.controller=f,window.ui=e,h=!0,"undefined"!=typeof _isGuest&&(_isGuest?e.setGuestUI():e.setUserUI()),g&&g()}var e,f,g,h=!1;return{init:function(a){a&&"function"==typeof a&&(g=a),jQuery?jQuery(document).ready(d):setTimeout(d,1e3)},isSuperUser:function(){return f.cs.isSuperUser()},isInit:function(){return h},hidePanels:function(){e.hideAllActivePanels()},setupVKResizer:function(a){window.Resizer(a)},showGuestBook:function(){e.showGuestBook()}}}();I18n.get=function(a){return isDef(contexts.shared[a])?contexts.shared[a]:""},I18n.contextGet=function(a,b){return isDef(contexts[a])&&isDef(contexts[a][b])?contexts[a][b]:""},I18n.JANUARY=1,I18n.FEBRUARY=2,I18n.MARCH=3,I18n.APRIL=4,I18n.MAY=5,I18n.JUNE=6,I18n.JULY=7,I18n.AUGUST=8,I18n.SEPTEMBER=9,I18n.OCTOBER=10,I18n.NOVEMBER=11,I18n.DECEMBER=12;